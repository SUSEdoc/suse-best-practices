<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SAP Installation</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><style type="text/css">
body { background-image: url('static/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="home" href="index.html" title="SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - Setup Guide" /><link rel="up" href="index.html" title="SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - Setup Guide" /><link rel="prev" href="id-overview.html" title="Overview" /><link rel="next" href="id-implementing-the-cluster.html" title="Implementing the Cluster" /></head><body onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">SAP Installation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="id-overview.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="id-implementing-the-cluster.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-sap-installation"></a>SAP Installation</h2></div></div></div><p>The overall procedure to install the distributed SAP system is as follows:</p><div class="orderedlist"><p class="title"><strong>Tasks</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p>Plan Linux user and group number scheme</p></li><li class="listitem"><p>Install the ASCS instance for the central services</p></li><li class="listitem"><p>Install the ERS to get a replicated enqueue scenario</p></li><li class="listitem"><p>Prepare the ASCS and ERS installations for the cluster take-over</p></li><li class="listitem"><p>Install the database</p></li><li class="listitem"><p>Install the primary application server instance (PAS)</p></li><li class="listitem"><p>Install additional application server instances (AAS)</p></li></ol></div><p>The result will be a distributed SAP installation as illustrated here:</p><div class="figure"><a id="id1680"></a><p class="title"><strong>Figure 5. Distributed installation of the SAP system</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="NaN"><tr><td><img src="images/sles4sap_nw740_distInstall.svg" width="NaN" alt="SVG" /></td></tr></table></div></div></div><br class="figure-break" /><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-linux-user-and-group-number-scheme"></a>Linux User and Group Number Scheme</h3></div></div></div><p>Whenever asked by the SAP software provisioning manager (SWPM) which Linux User
IDs or Group IDs to use, refer to the following table as an example:</p><pre class="screen">Group sapinst      1001
Group sapsys       1002
Group dbhshm       1003

User  en2adm       2001
User  sapadm       2002
User  dbhadm       2003</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-ascs-on-valuga11"></a>Installing ASCS on valuga11</h3></div></div></div><p>Temporarily, as the local IP address, set the service IP address which you will later use in the
cluster, because the installer needs to be able to resolve and use it.
Make sure to use the correct virtual host name for each installation step.
If applicable, make sure to also mount file systems like <span class="emphasis"><em>/dev/disk/by-id/SUSE-Example-A-part2</em></span> and <span class="emphasis"><em>/var/lib/Landscape/</em></span>.</p><pre class="screen"># ip a a 192.168.1.112/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-A-part2 /usr/sap/EN2/ASCS00
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2as</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP
→ High-Availability System → ASCS Instance</p></li></ul></div></li><li class="listitem"><p>Use SID EN2</p></li><li class="listitem"><p>Use instance number 00</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>All passwords: use &lt;use-your-secure-pwd&gt;</p></li><li class="listitem"><p>Double-check during the parameter review, if virtual name <span class="strong"><strong>sapen2as</strong></span> is used</p></li><li class="listitem"><p>If you get an error during the installation about permissions, change the
ownership of the ASCS directory</p></li></ul></div><pre class="screen"># chown -R en2adm:sapsys /usr/sap/EN2/ASCS00</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-ers-on-valuga12"></a>Installing ERS on valuga12</h3></div></div></div><p>Temporarily, as the local IP address, set the service IP address which you will later use in the
cluster, because the installer needs to be able to resolve and use it.
Make sure to use the correct virtual host name for each installation step.</p><pre class="screen"># ip a a 192.168.1.113/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-A-part3 /usr/sap/EN2/ERS10
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2er</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP →
High-Availability System → ERS Instance</p></li></ul></div></li><li class="listitem"><p>Use instance number 10</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>Double-check during the parameter review that virtual name <span class="strong"><strong>sapen2er</strong></span> is used</p></li><li class="listitem"><p>If you get an error during the installation about permissions, change the
ownership of the ERS directory</p></li></ul></div><pre class="screen"># chown -R en2adm:sapsys /usr/sap/EN2/ERS10</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If you get a prompt to manually stop/start the ASCS instance, log in to
valuga11 as user en2adm and call 'sapcontrol'.</p></li></ul></div><pre class="screen"># sapcontrol -nr 00 -function Stop    # to stop the ASCS
# sapcontrol -nr 00 -function Start   # to start the ASCS</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-subsequent-steps-for-ascs-and-ers"></a>Subsequent Steps for ASCS and ERS</h3></div></div></div><p>After installation, you can perform several subsequent steps on the ASCS and ERS instances.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-stopping-ascs-and-ers"></a>Stopping ASCS and ERS</h4></div></div></div><p>To stop the ASCS and ERS instances, use the commands below.
On <span class="emphasis"><em>valuga11</em></span>, do the following:</p><pre class="screen"># su - en2adm
# sapcontrol -nr 00 -function Stop
# sapcontrol -nr 00 -function StopService</pre><p>On <span class="emphasis"><em>valuga12</em></span>, do the following:</p><pre class="screen"># su - en2adm
# sapcontrol -nr 10 -function Stop
# sapcontrol -nr 10 -function StopService</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-disabling-systemd-services-of-the-ascs-and-the-ers-sap-instance"></a>Disabling systemd services of the ASCS and the ERS SAP instance</h4></div></div></div><p>This is mandatory for giving control over the instance to the HA cluster.
See also manual pages ocf_suse_SAPStartSrv(7) and SAPStartSrv_basic_Cluster(7).</p><pre class="screen"># systemctl disable SAPEN2_00.service
# systemctl stop SAPEN2_00.service
# systemctl disable SAPEN2_10.service
# systemctl stop SAPEN2_10.service</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Stopping this instance services will stop the SAP instance as well.
Starting the instance services will not start the SAP instances.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Check the SAP systemd integration:</p></li></ul></div><pre class="screen"># systemctl list-unit-files | grep SAP
SAPEN2_10.service disabled
SAPEN2_10.service disabled</pre><p>The instance services are indeed disabled, as required.</p><pre class="screen"># systemctl list-unit-files | grep sap
saphostagent.service enabled
sapinit.service generated
saprouter.service disabled
saptune.service enabled</pre><p>The mandatory <code class="literal">saphostagent</code> service is enabled. This is the installation default.
Some more SAP related services might be enabled, e.g. the recommended <code class="literal">saptune</code>.</p><pre class="screen"># cat /usr/sap/sapservices
systemctl --no-ask-password start SAPEN2_00 # sapstartsrv pf=/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as
systemctl --no-ask-password start SAPEN2_10 # sapstartsrv pf=/usr/sap/EN2/SYS/profile/EN2_ERS10_sapen2er</pre><p>The <span class="emphasis"><em>sapservices</em></span> file is still there for compatibility. It shows native systemd commands, one per
line for each registered instance.
You will find a SystemV style example in the appendix.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-integrating-the-cluster-framework-using-sap-suse-cluster-connector"></a>Integrating the Cluster Framework Using <span class="emphasis"><em>sap-suse-cluster-connector</em></span></h4></div></div></div><p>Install the package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> version 3.1.0 from the SUSE
repositories:</p><pre class="screen"># zypper in sap-suse-cluster-connector</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> contains the version 3.x.x (SAP API 3).
The package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> with version 3.0.x implements the SUSE SAP API
version 3. New features like SAP Rolling Kernel Switch (RKS) and migration of ASCS are
only supported with this new version.
The package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> with version 3.1.x supports in addition the maintenance mode of
cluster resources triggered from SAP tools.</p></div><p>For the ERS and ASCS instances, edit the instance profiles
EN2_ASCS00_sapen2as and EN2_ERS10_sapen2er in the
profile directory <span class="emphasis"><em>/usr/sap/EN2/SYS/profile/</em></span>.</p><p>Tell the <span class="strong"><strong>sapstartsrv</strong></span> service to load the HA script connector library and
to use the connector <span class="strong"><strong>sap-suse-cluster-connector</strong></span>.</p><pre class="screen">service/halib = $(DIR_CT_RUN)/saphascriptco.so
service/halib_cluster_connector = /usr/bin/sap_suse_cluster_connector</pre><p>Add the user <span class="emphasis"><em>en2adm</em></span> to the unix user group <span class="emphasis"><em>haclient</em></span>.</p><pre class="screen"># usermod -a -G haclient en2adm</pre><p>See also manual pages sap_suse_cluster_connector(8), usermod(8) and groupmod(8).</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-adapting-sap-profiles-to-match-the-sap-s4-ha-clu-1-0-certification"></a>Adapting SAP Profiles to Match the SAP S/4-HA-CLU 1.0 Certification</h4></div></div></div><p>For the ASCS instance, change the start command from <span class="emphasis"><em>Restart_Program_xx</em></span> to
<span class="emphasis"><em>Start_Program_xx</em></span> for the enqueue server (Enqueue Server 2). This change tells the
SAP start framework <span class="strong"><strong>not</strong></span> to self-restart the enqueue process. Such a restart
would result in a loss of the locks.</p><p>File <span class="strong"><strong>/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as</strong></span></p><pre class="screen">Start_Program_01 = local $(_ENQ) pf=$(_PF)</pre><p>Optionally, you can limit the number of restarts of services (in the case of
ASCS, this limits the restart of the message server).</p><p>For the ERS instance, change the start command from <span class="emphasis"><em>Restart_Program_xx</em></span> to
<span class="emphasis"><em>Start_Program_xx</em></span> for the enqueue replication server (Enqueue Replicator 2).</p><p>File <span class="strong"><strong>/usr/sap/EN2/SYS/profile/EN2_ERS10_sapen2er</strong></span></p><pre class="screen">Start_Program_00 = local $(_ENQR) pf=$(_PF) NR=$(SCSID)</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-starting-ascs-and-ers"></a>Starting ASCS and ERS</h4></div></div></div><p>To start the ASCS and ERS instances, use the commands below.</p><p>On <span class="emphasis"><em>valuga11</em></span>, do the following:</p><pre class="screen"># su - en2adm
# sapcontrol -nr 00 -function StartService EN2
# sapcontrol -nr 00 -function Start</pre><p>On <span class="emphasis"><em>valuga12</em></span>, do the following</p><pre class="screen"># su - en2adm
# sapcontrol -nr 10 -function StartService EN2
# sapcontrol -nr 10 -function Start</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-database-on-valuga01"></a>Installing Database on valuga01</h3></div></div></div><p>The HANA DB has very strict HW requirements. The storage sizing depends on many
indicators. Check the supported configurations at
<a class="link" href="https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html" target="_top">SAP HANA Hardware Directory</a>
and <a class="link" href="https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html" target="_top">SAP HANA TDI</a>.</p><pre class="screen"># ip a a 192.168.1.114/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part1 /hana
# mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
# mount /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2db</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP →
High-Availability System → Database Instance</p></li></ul></div></li><li class="listitem"><p>Profile directory /sapmnt/EN2/profile</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>Database parameters : Database ID (DBSID) is DBH;
Database Host is sapen2db; Instance Number is 00</p></li><li class="listitem"><p>Database System ID enter Instance Number is 00; SAP Mount Directory is
/sapmnt/EN2/profile</p></li><li class="listitem"><p>Account parameters: change them in case of custom values needed</p></li><li class="listitem"><p>Clean-up: select <span class="strong"><strong>Yes</strong></span>, remove operating system users from the group <code class="literal">sapinst</code>.</p></li><li class="listitem"><p>Double-check during the parameter review, if virtual name <span class="strong"><strong>sapen2db</strong></span> is
used</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-install-the-primary-application-server-pas-on-valuga01"></a>Install the Primary Application Server (PAS) on valuga01</h3></div></div></div><pre class="screen"># ip a a 192.168.1.110/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2d1</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP →
High-Availability System → Primary Application Server Instance</p></li></ul></div></li><li class="listitem"><p>Use instance number 01</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>For this example setup we have used a default secure store key</p></li><li class="listitem"><p>Do not install Diagnostic Agent</p></li><li class="listitem"><p>No SLD</p></li><li class="listitem"><p>Double-check during the parameter review, if virtual name <span class="strong"><strong>sapen2d1</strong></span> is used</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-an-additional-application-server-aas-on-valuga01"></a>Installing an Additional Application Server (AAS) on valuga01</h3></div></div></div><pre class="screen"># ip a a 192.168.1.111/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2d2</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP →
High-Availability System → Additional Application Server Instance</p></li></ul></div></li><li class="listitem"><p>Use instance number 02</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>Do not install Diagnostic Agent</p></li><li class="listitem"><p>Double-check during the parameter review, if virtual name <span class="strong"><strong>sapen2d2</strong></span> is used</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="id-overview.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="id-implementing-the-cluster.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Overview </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Implementing the Cluster</td></tr></table></div></body></html>