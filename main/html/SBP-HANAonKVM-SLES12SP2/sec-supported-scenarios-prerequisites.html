<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Supported Scenarios and Prerequisites</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><style type="text/css">
body { background-image: url('static/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="home" href="index.html" title="SUSE Best Practices for SAP HANA on KVM" /><link rel="up" href="index.html" title="SUSE Best Practices for SAP HANA on KVM" /><link rel="prev" href="index.html" title="SUSE Best Practices for SAP HANA on KVM" /><link rel="next" href="sec-hypervisor.html" title="Hypervisor" /></head><body onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Supported Scenarios and Prerequisites</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="sec-hypervisor.html">Next</a></td></tr></table><hr /></div><div class="sect1"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="sec-supported-scenarios-prerequisites"></a>Supported Scenarios and Prerequisites</h2></div></div></div><p>
      <span class="strong"><strong>Follow this SUSE Best Practices for SAP HANA on KVM - SUSE Linux
        Enterprise Server for SAP Applications 12 SP2 document which describes the steps necessary
        to create a supported SAP HANA on KVM configuration. SUSE Linux Enterprise Server for SAP
        Applications must be used for both Hypervisor and Guest.</strong></span>
    </p><p>Inquiries about scenarios not listed here should be directed to
        <code class="email">&lt;<a class="email" href="mailto:saphana@suse.com">saphana@suse.com</a>&gt;</code></p><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec-supported-scenarios"></a>Supported Scenarios</h3></div></div></div><p>At the time of this publication the following configurations are supported for
        production use:</p><div class="table"><a id="Supported-Combinations"></a><p class="title"><strong>Table 1. Supported Combinations</strong></p><div class="table-contents"><table class="table" summary="Supported Combinations" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /></colgroup><thead><tr><th align="left" valign="top">CPU Architecture</th><th align="left" valign="top">SAP HANA scale-up (single VM)</th><th align="left" valign="top">SAP HANA scale-up (multi VM)</th><th align="left" valign="top">SAP HANA Scale-Out</th></tr></thead><tbody><tr><td align="left" valign="top">
                <p>Haswell (Intel v3)</p>
              </td><td align="left" valign="top">
                <p>- Hypervisor: SLES for SAP 12 SP2 - Guest: SLES for SAP 12 SP1 onward - Size:
                  max. 4 socket<sup>1</sup>, 2 TiB RAM</p>
              </td><td align="left" valign="top">
                <p>no</p>
              </td><td align="left" valign="top">
                <p>no</p>
              </td></tr></tbody></table></div></div><br class="table-break" /><p><sup>1</sup> Maximum 4 sockets using Intel standard chipsets on a single
        system board, for example Lenovo* x3850, HPE*/SGI* UV300 etc.</p><p>Check the following SAP Notes for the latest details of supported SAP HANA on KVM
        scenarios.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SAP Note 2284516 <span class="quote">“<span class="quote">SAP HANA virtualized on SUSE Linux Enterprise
              Hypervisors</span>”</span> (<a class="link" href="https://launchpad.support.sap.com/#/notes/2284516" target="_top">https://launchpad.support.sap.com/#/notes/2284516</a>)</p></li><li class="listitem"><p>SAP Note 2607144 <span class="quote">“<span class="quote">SAP HANA on KVM included with SLES for SAP Applications 12
              SP2 in production</span>”</span> (<a class="link" href="https://launchpad.support.sap.com/#/notes/2607144" target="_top">https://launchpad.support.sap.com/#/notes/2607144</a>)</p></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec-sizing"></a>Sizing</h3></div></div></div><p>It is recommended to reserve the following resources for the Hypervisor:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>7% RAM</p></li><li class="listitem"><p>1x Physical CPU core (2x Logical CPU/Hyperthreads) per Socket</p></li></ul></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec-memory-sizing"></a>Memory Sizing</h4></div></div></div><p>Since SAP HANA runs inside the VM, it is the RAM size of the VM which must be used as
          the basis for SAP HANA Memory sizing.</p></div><div class="sect3"><div class="titlepage"><div><div><h4 class="title"><a id="sec-cpu-sizing"></a>CPU Sizing</h4></div></div></div><p>In addition to the above mentioned CPU core reservation for the Hypervisor (see <a class="xref" href="sec-Guest-VM-XML-Configuration.html#sec-vCPU-and-vNUMA-Topology" title="vCPU and vNUMA Topology">the section called “vCPU and vNUMA Topology”</a> section for details), some artificial workload
          tests on Intel Haswell CPUs have shown an approximately 20% overhead when running SAP HANA
          on KVM. Therefore a thorough test of the configuration for the required workload is highly
          recommended before <span class="quote">“<span class="quote">go live</span>”</span>.</p><p>There are two main ways to deal with CPU sizing from a sizing perspective:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Follow the fixed core-to-memory ratios for SAP HANA as defined by SAP:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The certification of the SAP HANA Appliance hardware to be used for KVM
                  prescribes a fixed maximum amount of memory (RAM) which is allowed for each CPU
                  core, also known as <span class="quote">“<span class="quote">core-to-memory ratio</span>”</span>. The specific ratio also
                  depends on what workload the system will be used for, that is the Appliance Type:
                  OLTP (Scale-up: SoH/S4H) or OLAP (Scale-up: BWoH/BW4H/DM/SoH/S4H).</p></li><li class="listitem"><p>The relevant core-to-memory ratio required to size a VM can be easily
                  calculated as follows:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Go to the <span class="quote">“<span class="quote">SAP HANA Certified Hardware Directory</span>”</span>
                      <a class="link" href="https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/appliances.html" target="_top">https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/appliances.html</a>.</p></li><li class="listitem"><p>Select the required SAP HANA Appliance and Appliance Type (for example
                      Haswell for BWoH).</p></li><li class="listitem"><p>Look for the largest certified RAM size for the number of CPU Sockets on
                      the server (for example 2048 GiB on 4-Socket).</p></li><li class="listitem"><p>Look up the number of cores per CPU of this CPU Architecture used in SAP
                      HANA Appliances. The CPU model numbers are listed at: <a class="link" href="https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/index.html#details" target="_top">https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/index.html#details</a>
                      (for example 18).</p></li><li class="listitem"><p>Using the above values calculate the total number of cores on the
                      certified Appliance by multiplying number of sockets by number of cores (for
                      example 4x18=72).</p></li><li class="listitem"><p>Now divide the Appliance RAM by the total number of cores (not
                      hyperthreads) to give you the <span class="quote">“<span class="quote">core-to-memory</span>”</span> ratio. (for
                      example 2048 GiB/72 = approx. 28 GiB per core).</p></li></ul></div></li><li class="listitem"><p>Calculate the RAM size the VM needs to be compliant with the appropriate
                  core-to-memory ratio defined by SAP:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Take the total number of CPU cores (not hyperthreads) on the Hypervisor
                      and subtract one core per socket for the Hypervisor (for example
                      72-4=68).</p></li><li class="listitem"><p>Now take account of the Hypervisor overhead by multiplying the previous
                      value by a factor of <span class="quote">“<span class="quote">1-overhead</span>”</span> (for example 1 - 0.20% = factor
                      0.8, so 68*0.8=55 effective cores).</p></li><li class="listitem"><p>Multiply the resulting number of CPU cores for the VM by the SAP HANA
                      core-to-memory ratio to calculate to maximum VM RAM size limit by SAP for this
                      amount of CPU power (for example 55 effective cores * 28 GiB per core
                      = 1540 GiB Max VM RAM size for BWoH).</p></li><li class="listitem"><p>Now, calculate the maximum VM RAM size limit by SUSE by checking the <a class="xref" href="sec-supported-scenarios-prerequisites.html#Supported-Combinations" title="Table 1. Supported Combinations">Table 1, “Supported Combinations”</a> table in this document for the maximum
                      supported KVM Hypervisor RAM size for SAP HANA and then subtracting the 7%
                      memory overhead (for example 2048 GiB * 0.93 (the 7% RAM overhead) =
                      1904 GiB Max VM RAM size).</p></li></ul></div></li><li class="listitem"><p>Finally, the actual RAM size of the VM to be configured must not exceed the
                  LOWEST of the two above calculated SAP and SUSE <span class="quote">“<span class="quote">Max VM RAM size</span>”</span>
                  limits.</p></li><li class="listitem"><p>Conclusion:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Based on the example given above: From available CPU power in the VM, SAP
                      would allow a maximum RAM size of up to 1540 GiB for a VM running
                      OLAP/BWoH when following the predefined core-to-memory ratio.</p></li><li class="listitem"><p>Since OLTP/SoH has a much higher core-to-memory ratio
                      (43 GiB/core) SAP would allow a maximum of 2611 GiB, which
                      is well above the 1904 GiB limit for KVM in the example above.</p></li></ul></div></li><li class="listitem"><p>See the table <a class="xref" href="sec-supported-scenarios-prerequisites.html#SAP-HANA-core-to-memory-ratio-examples" title="Table 2. SAP HANA core-to-memory ratio examples">Table 2, “SAP HANA core-to-memory ratio examples”</a> below
                  for some current examples of SAP HANA core-to-memory ratios.</p></li></ul></div></li><li class="listitem"><p>Follow the SAP HANA TDI <span class="quote">“<span class="quote">Phase 5</span>”</span> rules as defined by SAP:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SAP HANA TDI Phase 5 rules allow customers to deviate from the above described
                  SAP HANA core-to-memory sizing ratios in certain scenarios. The KVM implementation
                  must still however adhere to the SUSE Best Practices for SAP HANA on KVM - SUSE
                  Linux Enterprise Server for SAP Applications 12 SP2. Details on SAP HANA TDI Phase
                  5 can be found in the following blog from SAP: <a class="link" href="https://blogs.saphana.com/2017/09/20/tdi-phase-5-new-opportunities-for-cost-optimization-of-sap-hana-hardware/" target="_top">https://blogs.saphana.com/2017/09/20/tdi-phase-5-new-opportunities-for-cost-optimization-of-sap-hana-hardware/</a>.</p></li><li class="listitem"><p>Since SAP HANA TDI Phase 5 rules use SAPS based sizing, SUSE recommends
                  applying the same overhead as measured with SAP HANA on KVM for the respective KVM
                  Version/CPU Architecture. SAPS values for servers can be requested from the
                  respective hardware vendor.</p></li><li class="listitem"><p>The following SAP HANA sizing documentation should also be useful</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>SAP Best Practice <span class="quote">“<span class="quote">Sizing Approaches for SAP HANA</span>”</span>: <a class="link" href="https://websmp203.sap-ag.de/~sapidb/011000358700000050632013E" target="_top">https://websmp203.sap-ag.de/~sapidb/011000358700000050632013E</a></p></li><li class="listitem"><p>Sizing SAP HANA on help.sap.com: <a class="link" href="https://help.sap.com/doc/eb3777d5495d46c5b2fa773206bbfb46/2.0.02/en-US/d4a122a7bb57101493e3f5ca08e6b039.html" target="_top">https://help.sap.com/doc/eb3777d5495d46c5b2fa773206bbfb46/2.0.02/en-US/d4a122a7bb57101493e3f5ca08e6b039.html</a></p></li><li class="listitem"><p>SAP Sizing at: <a class="link" href="http://sap.com/sizing" target="_top">http://sap.com/sizing</a></p></li></ul></div></li></ul></div></li></ol></div><div class="table"><a id="SAP-HANA-core-to-memory-ratio-examples"></a><p class="title"><strong>Table 2. SAP HANA core-to-memory ratio examples</strong></p><div class="table-contents"><table class="table" summary="SAP HANA core-to-memory ratio examples" border="1"><colgroup><col class="col_1" /><col class="col_2" /><col class="col_3" /><col class="col_4" /><col class="col_5" /><col class="col_6" /></colgroup><thead><tr><th align="left" valign="top">CPU Architecture</th><th align="left" valign="top">Appliance Type</th><th align="left" valign="top">Max Memory Size</th><th align="left" valign="top">Sockets</th><th align="left" valign="top">Cores per Socket</th><th align="left" valign="top">SAP HANA core-to-memory ratio</th></tr></thead><tbody><tr><td align="left" valign="top">
                  <p>Haswell (Intel v3)</p>
                </td><td align="left" valign="top">
                  <p>OLTP</p>
                </td><td align="left" valign="top">
                  <p>3072 GiB</p>
                </td><td align="left" valign="top">
                  <p>4</p>
                </td><td align="left" valign="top">
                  <p>18</p>
                </td><td align="left" valign="top">
                  <p>43 GiB/core</p>
                </td></tr><tr><td align="left" valign="top">
                  <p>Haswell (Intel v3)</p>
                </td><td align="left" valign="top">
                  <p>OLAP</p>
                </td><td align="left" valign="top">
                  <p>2048 GiB</p>
                </td><td align="left" valign="top">
                  <p>4</p>
                </td><td align="left" valign="top">
                  <p>18</p>
                </td><td align="left" valign="top">
                  <p>28 GiB/core</p>
                </td></tr></tbody></table></div></div><br class="table-break" /></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec-kvm-hypervisor-version"></a>KVM Hypervisor Version</h3></div></div></div><p>The Hypervisor must be configured according to this <span class="quote">“<span class="quote">SUSE Best Practices for SAP
          HANA on KVM - SUSE Linux Enterprise Server for SAP Applications 12 SP2</span>”</span> guide and
        fulfill the following minimal requirements:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SUSE Linux Enterprise Server for SAP Applications 12 SP2 (<span class="quote">“<span class="quote">Unlimited Virtual
              Machines</span>”</span> subscription)</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>kernel (Only major version 4.4, minimum package version 4.4.49-92.11)</p></li><li class="listitem"><p>libvirt (Only major version 2.0, minimum package version 2.0.0-27.12.1)</p></li><li class="listitem"><p>qemu (Only major version 2.6, minimum package version 2.6.2-41.9.1)</p></li></ul></div></li></ul></div></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec-hypervisor-hardware"></a>Hypervisor Hardware</h3></div></div></div><p>Use SAP HANA certified servers and storage as per SAP HANA Hardware Directory at: <a class="link" href="https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/appliances.html" target="_top">https://www.sap.com/dmc/exp/2014-09-02-hana-hardware/enEN/appliances.html</a></p></div><div class="sect2"><div class="titlepage"><div><div><h3 class="title"><a id="sec-guest-vm"></a>Guest VM</h3></div></div></div><p>The guest VM must:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Run SUSE Linux Enterprise Server for SAP Applications 12 SP1 or later.</p></li><li class="listitem"><p>Be a SUSE Linux Enterprise Server Supported VM Guest as per Section 7.1
              <span class="quote">“<span class="quote">Supported VM Guests</span>”</span> of the SUSE Virtualization Guide (<a class="link" href="https://documentation.suse.com/sles/12-SP4/html/SLES-all/cha-virt-support.html#virt-support-guests" target="_top">https://documentation.suse.com/sles/12-SP4/html/SLES-all/cha-virt-support.html#virt-support-guests</a>).</p></li><li class="listitem"><p>Comply with KVM limits as per SUSE Linux Enterprise Server 12 SP2 release notes
              <a class="link" href="https://www.suse.com/releasenotes/x86_64/SUSE-SLES/12-SP2/#TechInfo.KVM" target="_top">https://www.suse.com/releasenotes/x86_64/SUSE-SLES/12-SP2/#TechInfo.KVM</a>.</p></li><li class="listitem"><p>Fulfill the SAP HANA HWCCT storage KPI’s as per SAP Note 1943937
              <span class="quote">“<span class="quote">Hardware Configuration Check Tool - Central Note</span>”</span> (<a class="link" href="https://launchpad.support.sap.com/" target="_top">https://launchpad.support.sap.com/</a>notes/1943937)
            and SAP Note 2501817 <span class="quote">“<span class="quote">HWCCT 1.0 (≥220)</span>”</span> (<a class="link" href="https://launchpad.support.sap.com/" target="_top">https://launchpad.support.sap.com/</a>notes/2501817). Refer to <a class="xref" href="sec-Guest-VM-XML-Configuration.html#sec-storage" title="Storage">the section called “Storage”</a> for storage configuration details.</p></li><li class="listitem"><p>Be configured according to this SUSE Best Practices for SAP HANA on KVM - SUSE Linux
            Enterprise Server for SAP Applications 12 SP2 document.</p></li></ul></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="sec-hypervisor.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">SUSE Best Practices for SAP HANA on KVM  </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Hypervisor</td></tr></table></div></body></html>