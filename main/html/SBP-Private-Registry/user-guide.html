<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>User Guide</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><style type="text/css">
body { background-image: url('static/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="home" href="index.html" title="SUSE Private Registry Powered by Harbor 2.1" /><link rel="up" href="index.html" title="SUSE Private Registry Powered by Harbor 2.1" /><link rel="prev" href="administration.html" title="Administration" /><link rel="next" href="id-appendix.html" title="Appendix" /></head><body onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">User Guide</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="administration.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="id-appendix.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="user-guide"></a>User Guide</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-accessing-landing-page"></a>Accessing Landing Page</h3></div></div></div><p>After logging in, a harbor installation lands on the Projects page. Project pages are the individual "tenants" or "organisations" that the SUSE Private Registry can host.
For each one of those, Access Control, Security Policies, Webhooks or Accounts can be defined.
Access (push/pull) and other event logs can be accessed. A Project can be populated by replicating another registry, like for example <code class="literal">registry.suse.com</code>.
Here’s how an example harbor installation with mirroring itself from <code class="literal">registry.suse.com</code> would look like:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="80%"><tr><td><img src="images/registry-harbor-landingpage.png" width="100%" alt="registry harbor landingpage" /></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-using-docker-for-managing-images"></a>Using docker for managing images</h3></div></div></div><p>Assume there’s a "hello-world" image in your current local docker registry:</p><pre class="screen">&gt; docker images
REPOSITORY                                                                        TAG                  IMAGE ID            CREATED             SIZE
hello-world                                                                       latest               bf756fb1ae65        6 months ago        13.3kB</pre><p>Let’s assume the value of <code class="literal">&lt;core_fqdn&gt;</code> is <code class="literal">core.harbor.domain</code>.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to new Harbor based Docker registry. Use the correct administrator password, refer to: <a class="xref" href="id-deployment-of-suse-private-registry.html#install-passwords">[install-passwords]</a>.</p><pre class="screen">docker login core.harbor.domain -u admin</pre></li><li class="listitem"><p>Tag an existing image:</p><pre class="screen">docker tag hello-world core.harbor.domain/library/hello-world:latest</pre><p>Note the "library" part. That’s a project you will be pushing the image to.
Look how to manage projects in the <a class="link" href="https://goharbor.io/docs/2.1.0/working-with-projects/" target="_top">upstream documentation</a>.</p></li><li class="listitem"><p>Push the image to your Harbor registry:</p><pre class="screen">&gt; docker push core.harbor.domain/library/hello-world:latest
The push refers to repository [core.harbor.domain/library/hello-world]
9c27e219663c: Pushed
latest: digest: sha256:90659bf80b44ce6be8234e6ff90a1ac34acbeb826903b02cfa0da11c82cbc042 size: 525</pre><p>Now go to Harbor web UI and you can see the new image is stored under library project as library/hello-world</p></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-manage-helm-charts-with-suse-private-registry"></a>Manage Helm Charts with SUSE Private Registry</h3></div></div></div><p>Helm Charts in SUSE Private Registry <span class="strong"><strong>requires Helm v3</strong></span>, which is not a default option for SUSE CaaS Platform 4.5.
Helm v3 is a client only solution so you only need it on the machine that you launch the installation from.
Read about installing of Helm v3 in the <a class="link" href="https://documentation.suse.com/suse-caasp/4.5/html/caasp-admin/_software_management.html#helm-tiller-install" target="_top">SUSE CaaS Platform Administration Guide</a>.
In order to use helm, you need to Log into OCI-compatible registry of Harbor:</p><pre class="screen">&gt; helm registry login core.harbor.domain
Username: admin
Password:
Login succeeded</pre><p>After logging in, run the helm chart save command to save a chart directory that prepares the artifact for pushing:</p><pre class="screen">helm chart save my-chart core.harbor.domain/library/my-chart</pre><p>Now you can push the chart to the Private Registry:</p><pre class="screen">helm chart push core.harbor.domain/library/my-chart:version</pre><p>Go to the Helm web UI and you can see the chart located under library project.</p><p>Read more in the <a class="link" href="https://goharbor.io/docs/2.1.0/working-with-projects/working-with-images/managing-helm-charts" target="_top">upstream documentation</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-using-suse-private-registry-in-the-kubernetes-cluster"></a>Using SUSE Private Registry in the Kubernetes Cluster</h3></div></div></div><p>You can set up your Kubernetes Cluster to use your newly deployed SUSE Private Registry as a source of Images.
Read more about using SUSE <a class="link" href="https://kubernetes.io/docs/concepts/containers/images/#using-a-private-registry" target="_top">Private Registry for 4</a> cluster.
Following setup is based on <a class="link" href="https://kubernetes.io/docs/concepts/containers/images/#specifying-imagepullsecrets-on-a-pod" target="_top">Specifying ImagePullSecrets on a Pod</a> section.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Copy your generated CA certificate to all nodes of Kubernetes cluster so that container daemons trust it when pulling images from the private registry.
It’s possible to install them to the configuration directory specific to the container engine you are using, e.g. <code class="literal">/etc/docker/certs.d/</code> for docker.</p><p>Or copy them system-wide - repeat this for all your Kubernetes nodes:</p><pre class="screen">scp harbor.ca root@$kubernetes_node:
ssh root@$kubernetes_node
cp harbor.ca /usr/share/pki/trust/anchors/
update-ca-certificates
systemctl restart crio</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Notice that example above is restarting CRI-Oo service which is the container engine used by SUSE CaaS Platform.</p></div></li><li class="listitem"><p>Create a Secret of <code class="literal">docker-registry</code> type. Use the right own values for docker-server and docker-password, so that they match your environment:</p><pre class="screen">kubectl create secret docker-registry registrycred --docker-server=core.harbor.domain --docker-username=admin --docker-password=Harbor12345</pre><p>Now, you can create pods which reference newly created registrycred secret by adding an imagePullSecrets section to a Pod definition. Like this:</p><pre class="screen">apiVersion: v1
kind: Pod
metadata:
  name: foo
spec:
  containers:
  - name: foo
    image: core.harbor.domain/library/hello-world:latest
  imagePullSecrets:
  - name: registrycred</pre></li><li class="listitem"><p>Save the code above into some yaml file, e.g. <code class="literal">hello-pod.yaml</code> and create the new pod that pulls the image from your private registry:</p><pre class="screen">kubectl apply -f hello-pod.yaml</pre></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>It is possible to add <code class="literal">ImagePullSecrets</code> to a service account, so it is not necessary to pass it to each Pod.
Read about it in the <a class="link" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#add-imagepullsecrets-to-a-service-account" target="_top">upstream documentation</a>.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-vulnerability-scanning"></a>Vulnerability Scanning</h3></div></div></div><p>SUSE Private Registry provides static analysis of vulnerabilities in images through the Open Source project Trivy.
<span class="strong"><strong>No other scanners are supported.</strong></span></p><p><span class="strong"><strong>Trivy is enabled by default</strong></span> when deploying the Helm chart and can be disabled by editing the <code class="literal">harbor-values.yaml</code> before deployment:</p><pre class="screen">trivy:
  # enabled the flag to enable Trivy scanner
  enabled: true</pre><p>Log in to the Harbor interface with an account that has at least project administrator privileges.
To see the vulnerabilities detected in repository artifacts, click the <span class="strong"><strong>Repositories</strong></span> tab and then click on a repository.
For each artifact in the repository, the <span class="strong"><strong>Vulnerabilities</strong></span> column displays the vulnerability scanning status and related information.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="80%"><tr><td><img src="images/registry-harbor-vulnerability-scanning.png" width="100%" alt="registry harbor vulnerability scanning" /></td></tr></table></div></div><p>To run a vulnerability scan, select the artifacts to scan and then click the Scan button.
You can optionally select the checkbox at the top to select all artifacts in the repository.</p><p>Read more about vulnerability scanning in the <a class="link" href="https://goharbor.io/docs/2.1.0/administration/vulnerability-scanning/scan-individual-artifact" target="_top">upstream documentation</a>.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-image-signing"></a>Image Signing</h3></div></div></div><p>By default, <code class="literal">Notary</code>, the solution for managing the content trust is installed and enabled when Harbor is installed using the Helm chart.
This allows users to store signed images in SUSE Private Registry, and in turn they have the option to use only signed images from the client applications.</p><p>To use command line tools together with the <code class="literal">Notary</code> signing support in Harbor:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Enable Docker Content Trust</p><p>Set these environment variables on your client:</p><pre class="screen">export DOCKER_CONTENT_TRUST=1
export DOCKER_CONTENT_TRUST_SERVER=https://&lt;notary_fqdn&gt;</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>When <code class="literal">DOCKER_CONTENT_TRUST</code> variable is set to 1, you cannot pull unsigned images from any sources.
So for the time you want to pull some unsigned image (so you can push it signed into your local registry), it’s necessary to unset the variable, or set its value to 0.</p></div></li><li class="listitem"><p>Make sure your certificates are correctly installed on your system. Refer to: <a class="xref" href="install-tls-security.html" title="Transport Layer Security (TLS) Setup">the section called “Transport Layer Security (TLS) Setup”</a>.</p></li><li class="listitem"><p>Push a signed Image to the private registry</p><pre class="screen">&gt; export DOCKER_CONTENT_TRUST_SERVER=https://notary.harbor.domain
&gt; export DOCKER_CONTENT_TRUST=1
&gt; docker push core.harbor.domain/library/alpine:latest
The push refers to repository [core.harbor.domain/library/alpine]
50644c29ef5a: Pushed
latest: digest: sha256:a15790640a6690aa1730c38cf0a440e2aa44aaca9b0e8931a9f2b0d7cc90fd65 size: 528
Signing and pushing trust metadata
You are about to create a new root signing key passphrase. This passphrase
will be used to protect the most sensitive key in your signing system. Please
choose a long, complex passphrase and be careful to keep the password and the
key file itself secure and backed up. It is highly recommended that you use a
password manager to generate the passphrase and keep it safe. There will be no
way to recover this key. You can find the key in your config directory.
Enter passphrase for new root key with ID a69b97e:
Repeat passphrase for new root key with ID a69b97e:
Enter passphrase for new repository key with ID 5419081:
Repeat passphrase for new repository key with ID 5419081:
Finished initializing "core.harbor.domain/library/alpine"
Successfully signed core.harbor.domain/library/alpine:latest</pre><p>You will be asked for the passhprases for a new root and new repository key. The root key only need to be set once.</p></li><li class="listitem"><p>Log into Harbor Portal UI, browse to the image you have just pushed and you will see an icon indicating that the image is signed</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="80%"><tr><td><img src="images/registry-harbor-notary-signed-image.png" width="100%" alt="registry harbor notary signed image" /></td></tr></table></div></div></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-using-suse-private-registry-as-a-proxy-cache"></a>Using SUSE Private Registry as a Proxy Cache</h3></div></div></div><p>You can set up SUSE Private Registry to act as a caching proxy for other private or public registries. When used with Docker Hub for example, this can greatly reduce the impact that <a class="link" href="https://www.docker.com/pricing" target="_top">Docker Hub’s rate limiting policy</a> can have on your workload.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Currently, the proxy cache feature can only be used with Docker Hub and other Harbor registries.</p></div><p>Log in to the Harbor interface with an account that has administrator privileges.
First, you need to configure the remote registry as a registry endpoint under the <span class="strong"><strong>Registries</strong></span> tab.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="80%"><tr><td><img src="images/registry-harbor-add-registry-endpoint.png" width="100%" alt="registry harbor add registry endpoint" /></td></tr></table></div></div><p>The proxy cache feature can be enabled at project level, when a new project is created. Enabling the <span class="strong"><strong>Proxy Cache</strong></span> box and selecting the previously created registry endpointcauses the project to act as a caching proxy for all images pulled from the project.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="80%"><tr><td><img src="images/registry-harbor-add-proxy-cache-project.png" width="100%" alt="registry harbor add proxy cache project" /></td></tr></table></div></div><p>Read more about the proxy cache feature in the <a class="link" href="https://goharbor.io/docs/2.1.0/administration/configure-proxy-cache/" target="_top">upstream documentation</a>.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="administration.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="id-appendix.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Administration </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Appendix</td></tr></table></div></body></html>