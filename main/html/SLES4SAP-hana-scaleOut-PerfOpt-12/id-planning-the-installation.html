<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Planning the installation</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><style type="text/css">
body { background-image: url('static/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="home" href="index.html" title="SAP HANA System Replication Scale-Out - Performance Optimized Scenario" /><link rel="up" href="index.html" title="SAP HANA System Replication Scale-Out - Performance Optimized Scenario" /><link rel="prev" href="id-scope-of-this-documentation.html" title="Scope of this documentation" /><link rel="next" href="id-setting-up-the-operating-system.html" title="Setting up the operating system" /></head><body onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Planning the installation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="id-scope-of-this-documentation.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="id-setting-up-the-operating-system.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-planning-the-installation"></a>Planning the installation</h2></div></div></div><p><a id="Planning"></a> Planning the installation is essential for a successful SAP HANA cluster setup.</p><div class="figure"><a id="id1457"></a><p class="title"><strong>Figure 3. Planning <a class="xref" href="id-setting-up-the-operating-system.html#OsSetup">[OsSetup]</a> <a class="xref" href="id-installing-the-sap-hana-databases-on-both-sites.html#SAPHanaInst">[SAPHanaInst]</a> <a class="xref" href="id-setting-up-the-sap-hana-system-replication.html#SAPHanaHsr">[SAPHanaHsr]</a> <a class="xref" href="id-integrating-sap-hana-with-the-cluster.html#Integration">[Integration]</a> <a class="xref" href="id-configuring-the-cluster-and-sap-hana-resources.html#Cluster">[Cluster]</a> <a class="xref" href="id-testing-the-cluster.html#Testing">[Testing]</a></strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase1.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase1" /></td></tr></table></div></div></div><br class="figure-break" /><p>What you need before you start:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Software from SUSE: SUSE Linux Enterprise Server for SAP Applications installation media and a valid subscription
for getting updates</p></li><li class="listitem"><p>Software from SAP: SAP HANA installation media</p></li><li class="listitem"><p>Physical or virtual systems including disks and NFS storage pools (see below)</p></li><li class="listitem"><p>Filled parameter sheet (see below)</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-minimum-lab-requirements-and-prerequisites"></a>Minimum lab requirements and prerequisites</h3></div></div></div><p>This section defines some minimum requirements to install SAP HANA scale-out.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The minimum lab requirements mentioned here are no SAP sizing information.
These data are provided only to rebuild the described cluster in a lab for test purposes.
Even for such tests the requirements can increase depending on your test scenario.
For productive systems ask your hardware vendor or use the official SAP sizing
tools and services.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Refer to SAP HANA TDI documentation for allowed storage
configuration and file systems.</p></div><div class="figure"><a id="id1487"></a><p class="title"><strong>Figure 4. Simplified NFS share structure of a 2+1:2+1 SAP HANA system replication</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-NFSPool-2+1.svg" width="100%" alt="SAPHanaSR ScaleOut NFSPool 2+1" /></td></tr></table></div></div></div><br class="figure-break" /><p>Requirements with 3 SAP instances per site (2+1 : 2+1) - with a
majority maker:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>6 VMs with each 32 GB RAM, 50 GB disk space</p></li><li class="listitem"><p>1 VM with 2 GB RAM, 50 GB disk space</p></li><li class="listitem"><p>1 shared disk for SBD with 10 MB disk space</p></li><li class="listitem"><p>2 NFS pools (one per site) with a capacity of each 96 GB</p></li><li class="listitem"><p>1 additional IP address for takeover</p></li></ul></div><div class="figure"><a id="id1506"></a><p class="title"><strong>Figure 5. Simplified NFS share structure of a 3+2:3+2 SAP HANA system replication</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-NFSPool-3+2.svg" width="100%" alt="SAPHanaSR ScaleOut NFSPool 3+2" /></td></tr></table></div></div></div><br class="figure-break" /><p>Requirements with 5 SAP HANA instances per site (3+2 : 3+2) -
with a majority maker:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>10 VMs with each 32 GB RAM, 50 GB disk space</p></li><li class="listitem"><p>1 VM with 2 GB RAM, 50 GB disk space</p></li><li class="listitem"><p>1 shared disk for SBD with 10 MB disk space</p></li><li class="listitem"><p>2 NFS pools (one per site) with a capacity of each 132 GB</p></li><li class="listitem"><p>1 additional IP address for takeover</p></li></ul></div><p>The SBD based fencing needs up to 3 shared block devices.</p><div class="figure"><a id="id1526"></a><p class="title"><strong>Figure 6. Additionally to the NFS shares: All cluster nodes need to have access to the SBD block devices</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-SBDs-3+2.svg" width="100%" alt="SAPHanaSR ScaleOut SBDs 3+2" /></td></tr></table></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-parameter-sheet"></a>Parameter sheet</h3></div></div></div><p>The cluster organizing two SAP HANA 'swarms' is quite complex. The installation
should be planned properly. You should have all needed parameters like SID, IP
addresses and much more already in place. It is a good practice to first fill out
the parameter sheet and then begin with the installation.</p><div class="table"><a id="id1536"></a><p class="title"><strong>Table 1. Parameter sheet to prepare the NFS based setup</strong></p><div class="table-contents"><table class="table" summary="Parameter sheet to prepare the NFS based setup" border="1" width="85%"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="center" valign="top">Parameter</th><th align="center" valign="top">Value</th></tr></thead><tbody><tr><td align="left" valign="top"><p>Path to SLES for SAP media</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>SMT server or SCC account</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Path to SAP HANA media</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>S-User for SAP marketplace</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Node names site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Node names site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Node name majority maker</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>IP addresses of all cluster nodes</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>SID</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Instance number</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Service IP address</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>HANA site name site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>HANA site name site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS server site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "shared" site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "data" site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "log" site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS server site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "shared" site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "data" site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "log" site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>SBD STONITH block device(s)</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Watchdog driver</p></td><td align="left" valign="top"> </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-scale-out-scenario-and-resource-agents"></a>Scale-out scenario and resource agents</h3></div></div></div><p>To automate the failover, the High Availability Extension built into
<span class="emphasis"><em>SUSE Linux Enterprise Server for SAP Applications</em></span> is used. Two resource agents have been created to handle the scenario.</p><p>The first is the <span class="strong"><strong>SAPHanaController</strong></span> resource agent (RA), which checks and
manages the SAP HANA database instances. This RA is configured as a
master/slave resource.</p><p>The master assumes responsibility for the active master name server of the
SAP HANA database running in primary mode. All other instances are
represented by the slave mode.</p><div class="figure"><a id="id1645"></a><p class="title"><strong>Figure 7. Cluster resource agents and master/slave status mapping</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Cluster-Resources02.svg" width="100%" alt="SAPHanaSR ScaleOut Cluster Resources02" /></td></tr></table></div></div></div><br class="figure-break" /><p>The second resource agent is <span class="strong"><strong>SAPHanaTopology</strong></span>. This RA has been created to make configuring the cluster as simple as possible.
It runs on all nodes (beside the majority maker)
of a SUSE Linux Enterprise High Availability Extension 12 cluster. It gathers information about the statuses and
configurations of the SAP HANA system replication. It is designed as a normal
(stateless) clone resource.</p><p>SAP HANA system replication for scale-out is supported in the following
scenarios or use cases:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Performance optimized, single container (A &gt; B)</span></dt><dd><p>This scenario and setup is described in this document. In the performance
optimized scenario an SAP HANA RDBMS on site "A" is synchronizing with an
SAP HANA RDBMS on a second site "B". As the SAP HANA RDBMS on the second site
is configured to preload the tables the takeover time is typically very short.</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Performance optimized, multi-tenancy also named MDC (%A &gt; %B)</span></dt><dd><p>Multi-tenancy is supported for all of the above scenarios and use cases. This scenario
is supported since SAP HANA 1 SPS12. The setup and configuration from a cluster
point of view is the same for multi-tenancy and single containers. Thus you can use
the above documents for both types of scenarios.</p></dd></dl></div><p>Multi-tenancy is the default installation type for SAP HANA 2.0.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-the-concept-of-the-performance-optimized-scenario"></a>The concept of the Performance Optimized Scenario</h3></div></div></div><p>In case of failure of the primary SAP HANA on site 1 the cluster first tries to
start the takeover process. This allows to use the already loaded data at the
secondary site. Typically the takeover is much faster than the local restart.</p><p>A site is noticed as "down" or "on error", if the <span class="strong"><strong>LandscapeHostConfiguration
status</strong></span> reflects this (return code 1). This happens when worker nodes are going
down without any SAP HANA standby nodes left. Standby nodes are designed to perform a host
auto-failover for the worker functionality.</p><p>Without any additional intervention the resource agent will wait for the SAP
internal HA cluster to repair the situation locally. An additional intervention
could be a custom python hook using the SAP provider <span class="strong"><strong>srServiceStateChanged()</strong></span>
available since SAP HANA 2.0 SPS01.</p><p>To achieve an automation of this resource handling process, use the
SAP HANA resource agents included in the <span class="emphasis"><em>SAPHanaSR-ScaleOut</em></span> RPM package delivered with
SUSE Linux Enterprise Server for SAP Applications.</p><p>You can configure the level of automation by setting the parameter
<span class="emphasis"><em>AUTOMATED_REGISTER</em></span>. If automated registration is activated the cluster will
also automatically register a former failed primary to get the new secondary.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-important-prerequisites"></a>Important prerequisites</h3></div></div></div><p>Read the SAP Notes and papers first.</p><p>The <span class="emphasis"><em>SAPHanaSR-ScaleOut</em></span> resource agent software package
supports scale-out (multiple-box to multiple-box) system replication with the
following configurations and parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The cluster must include a valid STONITH method.</p></li><li class="listitem"><p>As the STONITH mechanism SBD is recommended.</p></li><li class="listitem"><p>Both sites are either in the same network segment (layer 2) to allow an easy
takeover of an IP Address, or you need a technique like overlay IP addresses in
virtual private clouds.</p></li><li class="listitem"><p>Technical users and groups, such as <span class="emphasis"><em>&lt;sid&gt;adm</em></span> are defined <span class="strong"><strong>locally</strong></span> in the
Linux system.</p></li><li class="listitem"><p>Name resolution of the cluster nodes and the virtual IP address should be done
<span class="strong"><strong>locally</strong></span> on <span class="strong"><strong>all</strong></span> cluster nodes to not depend on DNS services (as it
can fail, too).</p></li><li class="listitem"><p>Time synchronization between the cluster nodes using reliable time services
like NTP.</p></li><li class="listitem"><p>Both SAP HANA sites have the same SAP Identifier (SID) and instance number.</p></li><li class="listitem"><p>The SAP HANA scale-out system must have only <span class="strong"><strong>one</strong></span> active master name server per
site. It should have up to three master name server candidates (SAP HANA
nodes with a configured role 'master&lt;N&gt;').</p></li><li class="listitem"><p>The SAP HANA scale-out system must have only <span class="strong"><strong>one</strong></span> failover group.</p></li><li class="listitem"><p>The cluster described in this document does not manage any service IP address
for a read-enabled secondary site.</p></li><li class="listitem"><p>There is only one SAP HANA system replication like from site "A" to site "B" but no
third site "C" (also called multi-tier or multi-target).</p></li><li class="listitem"><p>The setup implements the performance optimized scenario but not the cost
optimized scenario.</p></li><li class="listitem"><p>The <span class="emphasis"><em>saphostagent</em></span> must be running. <span class="emphasis"><em>saphostagent</em></span> is needed to translate between
the system node names and SAP host names used during the installation of SAP HANA.</p></li><li class="listitem"><p>The replication mode should be either 'sync' or 'syncmem'.</p></li><li class="listitem"><p>All SAP HANA instances controlled by the cluster must not be activated via
<span class="emphasis"><em>sapinit</em></span> autostart.</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>Automated registration of a failed primary after takeover is possible. But as a
good starting configuration for projects, it is recommended to switch <span class="strong"><strong>off</strong></span> the
automated registration of a failed primary, therefore the
<code class="literal">AUTOMATED_REGISTER="false"</code> is the <span class="strong"><strong>default</strong></span>.</p><p>In this case, you need to register a failed primary after a takeover manually.
Use SAP tools like SAP HANA Cockpit or <span class="strong"><strong>hdbnsutil</strong></span>.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Automated start of SAP HANA instances during system boot must be switched
<span class="strong"><strong>off</strong></span>.</p></li><li class="listitem"><p>You need at least SAPHanaSR-ScaleOut version 0.161, SUSE Linux Enterprise Server for SAP Applications 12 SP2 and
SAP HANA 1.0 SPS12 (121) or SAP HANA 2.0 SPS 2 for all mentioned setups.</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>You must implement a valid STONITH method. Without a valid STONITH
method, the complete cluster is unsupported and will not work properly.</p></div><p>This setup-guide focuses on the performance optimized setup as it is the
only supported scenario at the point of writing this guide.</p><p>If you need to implement a different scenario, it is strongly recommended to define
a Proof-of-Concept (PoC) with SUSE. This PoC will focus on testing the existing
solution in your scenario. The limitation of most of the above items is mostly
due to testing limits.</p></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="id-scope-of-this-documentation.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="id-setting-up-the-operating-system.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Scope of this documentation </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Setting up the operating system</td></tr></table></div></body></html>