<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Infrastructure Preparation</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><style type="text/css">
body { background-image: url('static/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="home" href="index.html" title="SAP HANA High Availability Cross-Zone Solution on Alibaba Cloud" /><link rel="up" href="index.html" title="SAP HANA High Availability Cross-Zone Solution on Alibaba Cloud" /><link rel="prev" href="index.html" title="SAP HANA High Availability Cross-Zone Solution on Alibaba Cloud" /><link rel="next" href="id-software-preparation.html" title="Software Preparation" /></head><body onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Infrastructure Preparation</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="index.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="id-software-preparation.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-infrastructure-preparation"></a>Infrastructure Preparation</h2></div></div></div><p>The next sections contain information about how to prepare the infrastructure.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-infrastructure-list"></a>Infrastructure List</h3></div></div></div><p>To set up your infrastructure, the following components are required:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>1 Virtual Private Cloud (VPC) network;
<a class="link" href="https://www.alibabacloud.com/product/vpc" target="_top">Virtual Private Cloud</a></p></li><li class="listitem"><p>2 Elastic Compute Service (ECS) instances in different zones of the same VPC;
<a class="link" href="https://www.alibabacloud.com/product/ecs" target="_top">Elastic Compute Service</a></p></li><li class="listitem"><p>2 Elastic Network Interfaces (ENI) - one for each ECS instance;
<a class="link" href="https://www.alibabacloud.com/help/doc-detail/58496.htm" target="_top">Elastic network interfaces</a></p></li><li class="listitem"><p>Alibaba Cloud specific Virtual IP Resource Agent and STONITH device;</p></li><li class="listitem"><p>NAT Gateway and SNAT entry;
<a class="link" href="https://www.alibabacloud.com/help/product/44413.htm" target="_top">NAT Gateway</a></p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-creating-vpc"></a>Creating VPC</h3></div></div></div><p>First, create a VPC via <span class="strong"><strong>Console→Virtual Private Cloud→VPCs→Create VPC</strong></span>.
In this example, a VPC named <span class="strong"><strong>suse_hana_ha</strong></span> in the Region <span class="strong"><strong>EU Central 1 (Frankfurt)</strong></span> has been created:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="46%"><tr><td><img src="images/Alicloud_VPC.png" width="100%" alt="vpc" /></td></tr></table></div></div><p>There should be at least two VSwitches (subnets) defined within the VPC network. Each VSwitch should be bound to a different Zone. In this example, the following two VSwitches (subnets) are defined:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Switch1 192.168.0.0/24  Zone A, for SAP HANA Primary Node;</p></li><li class="listitem"><p>Switch2 192.168.1.0/24  Zone B, for SAP HANA Secondary Node;</p></li></ul></div><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="45%"><tr><td><img src="images/Alicloud_vswitch.png" width="100%" alt="vswitch" /></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-creating-ecs-instances"></a>Creating ECS Instances</h3></div></div></div><p>Two ECS instances are created in different Zones of the same VPC via <span class="strong"><strong>Console→Elastic Compute Service ECS→Instances→Create Instance</strong></span>. Choose the "SUSE Linux Enterprise Server for SAP Applications" image from the Image Market place.</p><p>In this example, two ECS instances (hostname: <span class="emphasis"><em>hana0</em></span> and <span class="emphasis"><em>hana1</em></span>) are created in the Region <span class="strong"><strong>EU Central 1</strong></span>, Zone A and Zone B, within the VPC: <span class="strong"><strong>suse_hana_ha</strong></span>, with SUSE Linux Enterprise Server for SAP Applications 12 SP2 image from the Image Market Place. Host <span class="emphasis"><em>hana0</em></span> is the primary SAP HANA database node, and <span class="emphasis"><em>hana1</em></span> is the secondary SAP HANA database node.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="45%"><tr><td><img src="images/Alicloud_instance.png" width="100%" alt="instance" /></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-creating-enis-and-binding-to-ecs-instances"></a>Creating ENIs and Binding to ECS Instances</h3></div></div></div><p>Create two ENIs via <span class="strong"><strong>Console→ Elastic Compute Service ECS→Network and Security→ENI</strong></span>, and attach one for each ECS instance, for HANA System Replication purposes. Configure the IP addresses of the ENIs to the subnet for HANA System Replication only.</p><p>In this example, the ENIs are attached to the ECS instances hana0 and hana1. In addition, the IP addresses are configured as 192.168.0.83 and 192.168.1.246 within the same VSwitches of <span class="emphasis"><em>hana0</em></span> and <span class="emphasis"><em>hana1</em></span>, and put into the VPC: <span class="strong"><strong>suse_hana_ha</strong></span></p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="50%"><tr><td><img src="images/Alicloud_ENI.png" width="100%" alt="ENI" /></td></tr></table></div></div><p>Meanwhile, within the Guest OS, <span class="emphasis"><em>/etc/hosts</em></span> should also be configured.</p><p>According to the example at hand, run the following two commands on both sites:</p><pre class="screen">echo "192.168.0.82 hana0 hana0" &gt;&gt; /etc/hosts

echo "192.168.1.245 hana1 hana1" &gt;&gt; /etc/hosts</pre><p>The output looks as follows:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="80%"><tr><td><img src="images/Alicloud_hosts.png" width="100%" alt="hosts" /></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-creating-nat-gateway-and-configure-snat-entry"></a>Creating NAT Gateway and configure SNAT entry</h3></div></div></div><p>Now create an NAT Gateway attached to the given VPC. In the example at hand, an NAT Gateway named <span class="strong"><strong>suse_hana_ha_GW</strong></span> has been created:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="53%"><tr><td><img src="images/Alicloud_NAT_GW.png" width="100%" alt="NATGW" /></td></tr></table></div></div><p>After having creating the NAT Gateway, you need to create a corresponding SNAT entry to allow ECS instances within the VPC to access public addresses on the Internet.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>An Alibaba Cloud specific STONITH device and Virtual IP Resource Agent are mandatory for the cluster. They need to access Alibaba Cloud OpenAPI through a public domain.</p></div><p>In the example at hand, two SNAT entries have been created, for ECS instances located in a different network range:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="50%"><tr><td><img src="images/Alicloud_SNAT.png" width="100%" alt="SNAT" /></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-creating-stonith-device-and-virtual-ip-resource-agent"></a>Creating STONITH Device and Virtual IP Resource Agent</h3></div></div></div><p>Download the STONITH fencing software with the following command:</p><pre class="screen">wget http://sap-automation-cn-beijing.oss-cn-beijing.aliyuncs.com/software/aliyun-pacemaker_new.zip</pre><p>For an HA solution, a fencing device is an essential requirement. Alibaba Cloud provides its own STONITH device, which allows the servers in the HA cluster to shut down the node that is not responsive. The STONITH device leverages Alibaba Cloud OpenAPI underneath the ECS instance, which is similar to a physical reset / shutdown in an on-premise environment.</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="75%"><tr><td><img src="images/Alicloud_image017.png" width="100%" alt="aliyunpacemaker" /></td></tr></table></div></div><p>Extract the package and install the software.</p><pre class="screen">tar –xvf aliyun-ecs-pacemaker.tar.gz
./install</pre><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="99%"><tr><td><img src="images/Alicloud_image019.png" width="100%" alt="installpacemaker" /></td></tr></table></div></div><p>Install Alibaba Cloud OpenAPI SDK.</p><pre class="screen">pip install aliyun-python-sdk-ecs aliyun-python-sdk-vpc aliyuncli</pre><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="73%"><tr><td><img src="images/Alicloud_image021.png" width="100%" alt="SDKInstall" /></td></tr></table></div></div><p>Configure Alibaba Cloud OpenAPI SDK and Client.</p><pre class="screen">aliyuncli configure</pre><p>Get your Access Key as shown below:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="45%"><tr><td><img src="images/Alicloud_image025.png" width="100%" alt="AccessKey" /></td></tr></table></div></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="index.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="id-software-preparation.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">SAP HANA High Availability Cross-Zone Solution on Alibaba Cloud </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Software Preparation</td></tr></table></div></body></html>