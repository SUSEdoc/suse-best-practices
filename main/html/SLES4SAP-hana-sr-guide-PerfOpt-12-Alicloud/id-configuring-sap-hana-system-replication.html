<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Configuring SAP HANA System Replication</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><style type="text/css">
body { background-image: url('static/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style><link rel="home" href="index.html" title="SAP HANA High Availability Cross-Zone Solution on Alibaba Cloud" /><link rel="up" href="index.html" title="SAP HANA High Availability Cross-Zone Solution on Alibaba Cloud" /><link rel="prev" href="id-software-preparation.html" title="Software Preparation" /><link rel="next" href="id-configuring-high-availability-extension-for-sap-hana.html" title="Configuring High Availability Extension for SAP HANA" /></head><body onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Configuring SAP HANA System Replication</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="id-software-preparation.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="id-configuring-high-availability-extension-for-sap-hana.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-configuring-sap-hana-system-replication"></a>Configuring SAP HANA System Replication</h2></div></div></div><p>The following sections detail how to configure SAP HANA System Replication.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-backing-up-sap-hana-on-primary-ecs-instance"></a>Backing up SAP HANA on Primary ECS Instance</h3></div></div></div><p>To do a backup on SAP HANA, you can either use SAP HANA studio or <span class="emphasis"><em>hdbsql</em></span> as the client command tool.</p><p>The backup command is</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For HANA 1 single container mode:</p></li></ul></div><pre class="screen">BACKUP DATA USING FILE('COMPLETE_DATA_BACKUP');</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For HANA 2 with multitenant as default mode (You should back up systemDB and all tenantDB as shown below in the example):</p></li></ul></div><pre class="screen">BACKUP DATA for &lt;DATABASE&gt; using FILE('COMPLETE_DATA_BACKUP')</pre><p>Command line example:</p><pre class="screen">BACKUP DATA for SYSTEMDB using FILE('COMPLETE_DATA_BACKUP')</pre><pre class="screen">BACKUP DATA for JL0 using FILE('COMPLETE_DATA_BACKUP')</pre><p>In this example for HDB Studio, the SAP HANA database backup is executed on both ECS instances as shown below:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="55%"><tr><td><img src="images/Alicloud_backup.png" width="100%" alt="backup" /></td></tr></table></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-configuring-sap-hana-system-replication-on-primary-node"></a>Configuring SAP HANA System Replication on Primary Node</h3></div></div></div><p>Log on to the primary node with: <code class="literal">su - &lt;sid&gt;adm</code>.
<span class="strong"><strong>[sidadm]</strong></span> should be replaced by your SAP HANA database SID. In our example it is <code class="literal">su - jl0adm</code>;</p><p>Stop HANA with: <code class="literal">HDB stop</code>.</p><p>Change the following file content:</p><pre class="screen">vi /hana/shared/&lt;SID&gt;/global/hdb/custom/config/global.ini</pre><p>Add the following content:</p><pre class="screen">[system_replication_hostname_resolution]
&lt;IP&gt; = &lt;HOSTNAME&gt;</pre><p><span class="strong"><strong>[IP]</strong></span> should be the address of the ENI (heartbeat IP address for SAP HANA system replication) attached to the Secondary node;</p><p><span class="strong"><strong>[HOSTNAME]</strong></span> should be the hostname of the Secondary node;</p><p>In the example at hand, the configuration is as follows:</p><pre class="screen">[system_replication_hostname_resolution]

192.168.1.246 = hana1</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-configuring-sap-hana-system-replication-on-secondary-node"></a>Configuring SAP HANA System Replication on Secondary Node</h3></div></div></div><p>Perform the same steps as outlined above for the Primary node on the Secondary node. However, do not forget to use here the IP and hostname of the Primary node instead of the Secondary node.</p><p>In the example at hand, the configuration is as follows:</p><pre class="screen">[system_replication_hostname_resolution]

192.168.0.83 = hana0</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-enable-sap-hana-system-replication-on-primary-node"></a>Enable SAP HANA System Replication on Primary Node</h3></div></div></div><p>Log on to the primary node with: <code class="literal">su - &lt;sid&gt;adm</code>;</p><p>Start HANA with: <code class="literal">HDB start</code>;</p><p>Enable System Replication with:</p><pre class="screen">hdbnsutil -sr_enable --name= [primary location name]</pre><p><span class="strong"><strong>[primary location name]</strong></span> should be replaced by the location of your primary SAP HANA node.</p><p>For the example at hand, the following command is used:</p><pre class="screen">hdbnsutil -sr_enable --name=hana0</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>All of the above operations are done on the Primary node.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-register-the-secondary-node-to-the-primary-sap-hana-node"></a>Register the Secondary Node to the Primary SAP HANA Node</h3></div></div></div><p>Log on to the secondary node with: <code class="literal">su - &lt;sid&gt;adm</code>;</p><p>Stop SAP HANA with:  <code class="literal">HDB stop</code>;</p><p>Register the Secondary SAP HANA node to the Primary SAP HANA node by running the following command:</p><pre class="screen">hdbnsutil -sr_register --remoteHost=[location of primary Node] --remoteInstance=[instance number of primary node] --replicationMode=sync --name=[location of the secondary node] --operationMode=logreplay</pre><p>For the example at hand, the following command is used:</p><pre class="screen">hdbnsutil -sr_register --name=hana1 --remoteHost=hana0 --remoteInstance=00 --replicationMode=sync --operationMode=logreplay</pre><p>Start SAP HANA with: <code class="literal">HDB start</code>;</p><p>Verify the System Replication Status with the following command:</p><pre class="screen">hdbnsutil -sr_state</pre><p>In the example at hand, the following status is displayed on the secondary SAP HANA node <span class="emphasis"><em>hana1</em></span>:</p><div class="informalfigure"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="120%"><tr><td><img src="images/Alicloud_replicationState.png" width="100%" alt="HSRStatus" /></td></tr></table></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>All of the above operations are done on the Secondary node.</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="id-software-preparation.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="id-configuring-high-availability-extension-for-sap-hana.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Software Preparation </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Configuring High Availability Extension for SAP HANA</td></tr></table></div></body></html>