<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SAP HANA System Replication Scale-Out - Performance Optimized Scenario</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><meta name="description" content="SUSE® Linux Enterprise Server for SAP Applications is optimized in various ways for SAP* applications. This guide provides detailed information about how to install and customize SUSE Linux Enterprise Server for SAP Applications for SAP HANA Scale-Out system replication automation in the performance optimized scenario. It is based on SUSE Linux Enterprise Server for SAP Applications 12 SP2. The concept however can also be used with SUSE Linux Enterprise Server for SAP Applications 12 SP3 or newer. Disclaimer: Documents published as part of the SUSE Best Practices series have been contributed voluntarily by SUSE employees and third parties. They are meant to serve as examples of how particular actions can be performed. They have been compiled with utmost attention to detail. However, this does not guarantee complete accuracy. SUSE cannot verify that actions described in these documents do what is claimed or whether actions described have unintended consequences. SUSE LLC, its affiliates, the authors, and the translators may not be held liable for possible errors or the consequences thereof." /><style type="text/css">
body { background-image: url('static/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style></head><body onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div xml:lang="en" class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id1337"></a>SAP HANA System Replication Scale-Out - Performance Optimized Scenario</h2></div><div><h3 class="subtitle"><em></em></h3></div><div><div class="author"><h3 class="author"><span class="firstname">Fabian</span> <span class="surname">Herschel, Distinguished Architect SAP, SUSE</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Bernd</span> <span class="surname">Schubert, SAP Solution Architect, SUSE</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Lars</span> <span class="surname">Pinne, System Engineer, SUSE</span></h3></div></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><p>SUSE® Linux Enterprise Server for SAP Applications is
            optimized in various ways for SAP* applications. This guide
            provides detailed information about how to install and customize
            SUSE Linux Enterprise Server for SAP Applications for SAP
            HANA Scale-Out system replication automation in the performance
            optimized scenario. It is based on SUSE Linux Enterprise Server for
            SAP Applications 12 SP2. The concept however can also be used with
            SUSE Linux Enterprise Server for SAP Applications 12 SP3 or
            newer.</p><p><span class="strong"><strong>Disclaimer: </strong></span>
            Documents published as part of the SUSE Best Practices series have been contributed voluntarily
            by SUSE employees and third parties. They are meant to serve as examples of how particular
            actions can be performed. They have been compiled with utmost attention to detail.
            However, this does not guarantee complete accuracy. SUSE cannot verify that actions described
            in these documents do what is claimed or whether actions described have unintended consequences.
            SUSE LLC, its affiliates, the authors, and the translators may not be held liable for possible errors
            or the consequences thereof.</p></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#id-about-this-guide">About this guide</a></span></dt><dd><dl><dt><span class="section"><a href="#id-introduction">Introduction</a></span></dt><dt><span class="section"><a href="#id-additional-documentation-and-resources">Additional documentation and resources</a></span></dt><dt><span class="section"><a href="#id-feedback">Feedback</a></span></dt></dl></dd><dt><span class="section"><a href="#id-scope-of-this-documentation">Scope of this documentation</a></span></dt><dt><span class="section"><a href="#id-planning-the-installation">Planning the installation</a></span></dt><dd><dl><dt><span class="section"><a href="#id-minimum-lab-requirements-and-prerequisites">Minimum lab requirements and prerequisites</a></span></dt><dt><span class="section"><a href="#id-parameter-sheet">Parameter sheet</a></span></dt><dt><span class="section"><a href="#id-scale-out-scenario-and-resource-agents">Scale-out scenario and resource agents</a></span></dt><dt><span class="section"><a href="#id-the-concept-of-the-performance-optimized-scenario">The concept of the Performance Optimized Scenario</a></span></dt><dt><span class="section"><a href="#id-important-prerequisites">Important prerequisites</a></span></dt></dl></dd><dt><span class="section"><a href="#id-setting-up-the-operating-system">Setting up the operating system</a></span></dt><dd><dl><dt><span class="section"><a href="#id-installing-suse-linux-enterprise-server-for-sap-applications">Installing SUSE Linux Enterprise Server for SAP Applications</a></span></dt><dt><span class="section"><a href="#id-configuring-suse-linux-enterprise-server-for-sap-applications-to-run-sap-hana">Configuring SUSE Linux Enterprise Server for SAP Applications to run SAP HANA</a></span></dt></dl></dd><dt><span class="section"><a href="#id-installing-the-sap-hana-databases-on-both-sites">Installing the SAP HANA databases on both sites</a></span></dt><dd><dl><dt><span class="section"><a href="#id-preparation">Preparation</a></span></dt><dt><span class="section"><a href="#id-installation">Installation</a></span></dt><dt><span class="section"><a href="#id-checks">Checks</a></span></dt></dl></dd><dt><span class="section"><a href="#id-setting-up-the-sap-hana-system-replication">Setting up the SAP HANA system replication</a></span></dt><dd><dl><dt><span class="section"><a href="#id-backing-up-the-primary-database">Backing up the primary database</a></span></dt><dt><span class="section"><a href="#id-enabling-the-primary-database">Enabling the primary database</a></span></dt><dt><span class="section"><a href="#id-registering-the-secondary-database">Registering the secondary database</a></span></dt><dt><span class="section"><a href="#id-verifying-the-system-replication">Verifying the system replication</a></span></dt></dl></dd><dt><span class="section"><a href="#id-integrating-sap-hana-with-the-cluster">Integrating SAP HANA with the cluster</a></span></dt><dd><dl><dt><span class="section"><a href="#id-implementing-the-python-hook-saphanasr">Implementing the Python hook SAPHanaSR</a></span></dt><dt><span class="section"><a href="#id-configuring-the-system-replication-operation-mode">Configuring the system replication operation mode</a></span></dt><dt><span class="section"><a href="#id-allowing-sidadm-to-access-the-cluster">Allowing &lt;sid&gt;adm to access the cluster</a></span></dt><dt><span class="section"><a href="#id-starting-sap-hana">Starting SAP HANA</a></span></dt><dt><span class="section"><a href="#id-testing-the-hook-integration">Testing the hook integration</a></span></dt></dl></dd><dt><span class="section"><a href="#id-configuring-the-cluster-and-sap-hana-resources">Configuring the cluster and SAP HANA resources</a></span></dt><dd><dl><dt><span class="section"><a href="#id-installing-the-cluster-packages">Installing the cluster packages</a></span></dt><dt><span class="section"><a href="#id-configuring-the-basic-cluster">Configuring the basic cluster</a></span></dt><dt><span class="section"><a href="#id-configuring-cluster-properties-and-resources">Configuring cluster properties and resources</a></span></dt><dt><span class="section"><a href="#id-final-steps">Final Steps</a></span></dt></dl></dd><dt><span class="section"><a href="#id-testing-the-cluster">Testing the cluster</a></span></dt><dd><dl><dt><span class="section"><a href="#id-generic-cluster-tests">Generic cluster tests</a></span></dt><dt><span class="section"><a href="#id-tests-on-the-primary-site">Tests on the primary site</a></span></dt><dt><span class="section"><a href="#id-tests-on-the-secondary-site">Tests on the secondary site</a></span></dt></dl></dd><dt><span class="section"><a href="#id-administration">Administration</a></span></dt><dd><dl><dt><span class="section"><a href="#id-dos-and-donts">Dos and don’ts</a></span></dt><dt><span class="section"><a href="#id-monitoring-and-tools">Monitoring and tools</a></span></dt></dl></dd><dt><span class="section"><a href="#id-useful-links-manuals-and-sap-notes">Useful links, manuals, and SAP Notes</a></span></dt><dd><dl><dt><span class="section"><a href="#id-suse-best-practices-and-more">SUSE Best Practices and more</a></span></dt><dt><span class="section"><a href="#id-suse-product-documentation">SUSE product documentation</a></span></dt><dt><span class="section"><a href="#id-sap-product-documentation">SAP product documentation</a></span></dt><dt><span class="section"><a href="#id-sap-notes">SAP Notes</a></span></dt></dl></dd><dt><span class="section"><a href="#id-legal-notice">Legal notice</a></span></dt><dt><span class="section"><a href="#id-gnu-free-documentation-license">GNU Free Documentation License</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-about-this-guide"></a>About this guide</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-introduction"></a>Introduction</h3></div></div></div><p>SUSE® Linux Enterprise Server for SAP Applications is optimized in various
ways for SAP* applications. This guide provides detailed information about
installing and customizing <span class="emphasis"><em>SUSE Linux Enterprise Server for SAP Applications</em></span>
for SAP HANA scale-out system replication automation in the performance
optimized scenario.</p><p>High availability is an important aspect of running your mission-critical
SAP HANA servers.</p><p>The SAP HANA scale-out system replication is a synchronization of all data in
SAP HANA to a second SAP HANA system. The SAP HANA itself replicates all of
its data to a secondary SAP HANA instance. It is an out-of-the-box, standard
feature.</p><p>The recovery time objective (RTO) is minimized through the data replication at
regular intervals. SAP HANA supports asynchronous and synchronous modes. The document
at hand describes the synchronous replication from memory into memory of the second
system. This is the only method that allows the cluster to make a
decision based on coded algorithms.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-additional-documentation-and-resources"></a>Additional documentation and resources</h3></div></div></div><p>Chapters in this manual contain links to additional documentation resources that
are either available on the system or on the Internet.</p><p>For the latest SUSE product documentation updates, see <a class="link" href="https://documentation.suse.com" target="_top">https://documentation.suse.com</a>.</p><p>Find white-papers, best-practices guides, and other resources at the</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SUSE Linux Enterprise Server for SAP Applications resource library:
<a class="link" href="https://www.suse.com/products/sles-for-sap/resource-library/" target="_top">https://www.suse.com/products/sles-for-sap/resource-library/</a></p></li><li class="listitem"><p>SUSE Best Practices Web page:
<a class="link" href="https://documentation.suse.com/sbp/sap/" target="_top">https://documentation.suse.com/sbp/sap/</a></p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-feedback"></a>Feedback</h3></div></div></div><p>Several feedback channels are available:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Bugs and Enhancement Requests</span></dt><dd><p>For services and support options available for your product, refer to <a class="link" href="http://www.suse.com/support/" target="_top">http://www.suse.com/support/</a>.</p></dd></dl></div><p>To report bugs for a product component, go to <a class="link" href="https://scc.suse.com/support/" target="_top">https://scc.suse.com/support/</a> requests, log in, and select <span class="emphasis"><em>Submit New SR</em></span> (Service Request).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Mail</span></dt><dd><p>For feedback on the documentation of this product, you can send a mail to <a class="link" href="mailto:doc-team@suse.com" target="_top">doc-team@suse.com</a>. Make sure to include the document title, the product version and the publication date of the documentation. To report errors or suggest enhancements, provide a concise description of the problem and refer to the respective section number and page (or URL).</p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-scope-of-this-documentation"></a>Scope of this documentation</h2></div></div></div><p>This document describes how to set up an automation of an SAP HANA scale-out
system replication cluster installed on two sites based on SUSE Linux Enterprise Server for SAP Applications 12 SP2.
This concept can also be used with SUSE Linux Enterprise Server for SAP Applications 12 SP3 or newer.</p><p>To give a better overview the installation and setup is subdivided into
seven steps.</p><div class="figure"><a id="id1338"></a><p class="title"><strong>Figure 1. <a class="xref" href="#Planning">[Planning]</a> <a class="xref" href="#OsSetup">[OsSetup]</a> <a class="xref" href="#SAPHanaInst">[SAPHanaInst]</a> <a class="xref" href="#SAPHanaHsr">[SAPHanaHsr]</a> <a class="xref" href="#Integration">[Integration]</a> <a class="xref" href="#Cluster">[Cluster]</a> <a class="xref" href="#Testing">[Testing]</a></strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase0.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase0" /></td></tr></table></div></div></div><br class="figure-break" /><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Planning (section <a class="xref" href="#Planning">[Planning]</a>)</p></li><li class="listitem"><p>OS setup (section <a class="xref" href="#OsSetup">[OsSetup]</a>)</p></li><li class="listitem"><p>SAP HANA installation (section <a class="xref" href="#SAPHanaInst">[SAPHanaInst]</a>)</p></li><li class="listitem"><p>SAP HANA system replication configuration (section <a class="xref" href="#SAPHanaHsr">[SAPHanaHsr]</a>)</p></li><li class="listitem"><p>SAP HANA cluster integration (section <a class="xref" href="#Integration">[Integration]</a>)</p></li><li class="listitem"><p>SLES for SAP cluster configuration (section <a class="xref" href="#Cluster">[Cluster]</a>)</p></li><li class="listitem"><p>Testing (section <a class="xref" href="#Testing">[Testing]</a>)</p></li></ul></div><p>After the setup process you will have a SUSE Linux Enterprise Server for SAP Applications cluster controlling
two 'swarms' of SAP HANA scale-out in a system replication configuration. The architecture
is named the 'performance optimized scenario'.</p><div class="figure"><a id="id1446"></a><p class="title"><strong>Figure 2. Cluster with SAP HANA SR - performance optimized</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Cluster.svg" width="100%" alt="SAPHanaSR ScaleOut Cluster" /></td></tr></table></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-planning-the-installation"></a>Planning the installation</h2></div></div></div><p><a id="Planning"></a> Planning the installation is essential for a successful SAP HANA cluster setup.</p><div class="figure"><a id="id1457"></a><p class="title"><strong>Figure 3. Planning <a class="xref" href="#OsSetup">[OsSetup]</a> <a class="xref" href="#SAPHanaInst">[SAPHanaInst]</a> <a class="xref" href="#SAPHanaHsr">[SAPHanaHsr]</a> <a class="xref" href="#Integration">[Integration]</a> <a class="xref" href="#Cluster">[Cluster]</a> <a class="xref" href="#Testing">[Testing]</a></strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase1.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase1" /></td></tr></table></div></div></div><br class="figure-break" /><p>What you need before you start:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Software from SUSE: SUSE Linux Enterprise Server for SAP Applications installation media and a valid subscription
for getting updates</p></li><li class="listitem"><p>Software from SAP: SAP HANA installation media</p></li><li class="listitem"><p>Physical or virtual systems including disks and NFS storage pools (see below)</p></li><li class="listitem"><p>Filled parameter sheet (see below)</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-minimum-lab-requirements-and-prerequisites"></a>Minimum lab requirements and prerequisites</h3></div></div></div><p>This section defines some minimum requirements to install SAP HANA scale-out.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The minimum lab requirements mentioned here are no SAP sizing information.
These data are provided only to rebuild the described cluster in a lab for test purposes.
Even for such tests the requirements can increase depending on your test scenario.
For productive systems ask your hardware vendor or use the official SAP sizing
tools and services.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Refer to SAP HANA TDI documentation for allowed storage
configuration and file systems.</p></div><div class="figure"><a id="id1487"></a><p class="title"><strong>Figure 4. Simplified NFS share structure of a 2+1:2+1 SAP HANA system replication</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-NFSPool-2+1.svg" width="100%" alt="SAPHanaSR ScaleOut NFSPool 2+1" /></td></tr></table></div></div></div><br class="figure-break" /><p>Requirements with 3 SAP instances per site (2+1 : 2+1) - with a
majority maker:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>6 VMs with each 32 GB RAM, 50 GB disk space</p></li><li class="listitem"><p>1 VM with 2 GB RAM, 50 GB disk space</p></li><li class="listitem"><p>1 shared disk for SBD with 10 MB disk space</p></li><li class="listitem"><p>2 NFS pools (one per site) with a capacity of each 96 GB</p></li><li class="listitem"><p>1 additional IP address for takeover</p></li></ul></div><div class="figure"><a id="id1506"></a><p class="title"><strong>Figure 5. Simplified NFS share structure of a 3+2:3+2 SAP HANA system replication</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-NFSPool-3+2.svg" width="100%" alt="SAPHanaSR ScaleOut NFSPool 3+2" /></td></tr></table></div></div></div><br class="figure-break" /><p>Requirements with 5 SAP HANA instances per site (3+2 : 3+2) -
with a majority maker:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>10 VMs with each 32 GB RAM, 50 GB disk space</p></li><li class="listitem"><p>1 VM with 2 GB RAM, 50 GB disk space</p></li><li class="listitem"><p>1 shared disk for SBD with 10 MB disk space</p></li><li class="listitem"><p>2 NFS pools (one per site) with a capacity of each 132 GB</p></li><li class="listitem"><p>1 additional IP address for takeover</p></li></ul></div><p>The SBD based fencing needs up to 3 shared block devices.</p><div class="figure"><a id="id1526"></a><p class="title"><strong>Figure 6. Additionally to the NFS shares: All cluster nodes need to have access to the SBD block devices</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-SBDs-3+2.svg" width="100%" alt="SAPHanaSR ScaleOut SBDs 3+2" /></td></tr></table></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-parameter-sheet"></a>Parameter sheet</h3></div></div></div><p>The cluster organizing two SAP HANA 'swarms' is quite complex. The installation
should be planned properly. You should have all needed parameters like SID, IP
addresses and much more already in place. It is a good practice to first fill out
the parameter sheet and then begin with the installation.</p><div class="table"><a id="id1536"></a><p class="title"><strong>Table 1. Parameter sheet to prepare the NFS based setup</strong></p><div class="table-contents"><table class="table" summary="Parameter sheet to prepare the NFS based setup" border="1" width="85%"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="center" valign="top">Parameter</th><th align="center" valign="top">Value</th></tr></thead><tbody><tr><td align="left" valign="top"><p>Path to SLES for SAP media</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>SMT server or SCC account</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Path to SAP HANA media</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>S-User for SAP marketplace</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Node names site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Node names site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Node name majority maker</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>IP addresses of all cluster nodes</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>SID</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Instance number</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Service IP address</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>HANA site name site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>HANA site name site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS server site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "shared" site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "data" site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "log" site 1</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS server site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "shared" site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "data" site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>NFS share "log" site 2</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>SBD STONITH block device(s)</p></td><td align="left" valign="top"> </td></tr><tr><td align="left" valign="top"><p>Watchdog driver</p></td><td align="left" valign="top"> </td></tr></tbody></table></div></div><br class="table-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-scale-out-scenario-and-resource-agents"></a>Scale-out scenario and resource agents</h3></div></div></div><p>To automate the failover, the High Availability Extension built into
<span class="emphasis"><em>SUSE Linux Enterprise Server for SAP Applications</em></span> is used. Two resource agents have been created to handle the scenario.</p><p>The first is the <span class="strong"><strong>SAPHanaController</strong></span> resource agent (RA), which checks and
manages the SAP HANA database instances. This RA is configured as a
master/slave resource.</p><p>The master assumes responsibility for the active master name server of the
SAP HANA database running in primary mode. All other instances are
represented by the slave mode.</p><div class="figure"><a id="id1645"></a><p class="title"><strong>Figure 7. Cluster resource agents and master/slave status mapping</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Cluster-Resources02.svg" width="100%" alt="SAPHanaSR ScaleOut Cluster Resources02" /></td></tr></table></div></div></div><br class="figure-break" /><p>The second resource agent is <span class="strong"><strong>SAPHanaTopology</strong></span>. This RA has been created to make configuring the cluster as simple as possible.
It runs on all nodes (beside the majority maker)
of a SUSE Linux Enterprise High Availability Extension 12 cluster. It gathers information about the statuses and
configurations of the SAP HANA system replication. It is designed as a normal
(stateless) clone resource.</p><p>SAP HANA system replication for scale-out is supported in the following
scenarios or use cases:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Performance optimized, single container (A &gt; B)</span></dt><dd><p>This scenario and setup is described in this document. In the performance
optimized scenario an SAP HANA RDBMS on site "A" is synchronizing with an
SAP HANA RDBMS on a second site "B". As the SAP HANA RDBMS on the second site
is configured to preload the tables the takeover time is typically very short.</p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Performance optimized, multi-tenancy also named MDC (%A &gt; %B)</span></dt><dd><p>Multi-tenancy is supported for all of the above scenarios and use cases. This scenario
is supported since SAP HANA 1 SPS12. The setup and configuration from a cluster
point of view is the same for multi-tenancy and single containers. Thus you can use
the above documents for both types of scenarios.</p></dd></dl></div><p>Multi-tenancy is the default installation type for SAP HANA 2.0.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-the-concept-of-the-performance-optimized-scenario"></a>The concept of the Performance Optimized Scenario</h3></div></div></div><p>In case of failure of the primary SAP HANA on site 1 the cluster first tries to
start the takeover process. This allows to use the already loaded data at the
secondary site. Typically the takeover is much faster than the local restart.</p><p>A site is noticed as "down" or "on error", if the <span class="strong"><strong>LandscapeHostConfiguration
status</strong></span> reflects this (return code 1). This happens when worker nodes are going
down without any SAP HANA standby nodes left. Standby nodes are designed to perform a host
auto-failover for the worker functionality.</p><p>Without any additional intervention the resource agent will wait for the SAP
internal HA cluster to repair the situation locally. An additional intervention
could be a custom python hook using the SAP provider <span class="strong"><strong>srServiceStateChanged()</strong></span>
available since SAP HANA 2.0 SPS01.</p><p>To achieve an automation of this resource handling process, use the
SAP HANA resource agents included in the <span class="emphasis"><em>SAPHanaSR-ScaleOut</em></span> RPM package delivered with
SUSE Linux Enterprise Server for SAP Applications.</p><p>You can configure the level of automation by setting the parameter
<span class="emphasis"><em>AUTOMATED_REGISTER</em></span>. If automated registration is activated the cluster will
also automatically register a former failed primary to get the new secondary.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-important-prerequisites"></a>Important prerequisites</h3></div></div></div><p>Read the SAP Notes and papers first.</p><p>The <span class="emphasis"><em>SAPHanaSR-ScaleOut</em></span> resource agent software package
supports scale-out (multiple-box to multiple-box) system replication with the
following configurations and parameters:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The cluster must include a valid STONITH method.</p></li><li class="listitem"><p>As the STONITH mechanism SBD is recommended.</p></li><li class="listitem"><p>Both sites are either in the same network segment (layer 2) to allow an easy
takeover of an IP Address, or you need a technique like overlay IP addresses in
virtual private clouds.</p></li><li class="listitem"><p>Technical users and groups, such as <span class="emphasis"><em>&lt;sid&gt;adm</em></span> are defined <span class="strong"><strong>locally</strong></span> in the
Linux system.</p></li><li class="listitem"><p>Name resolution of the cluster nodes and the virtual IP address should be done
<span class="strong"><strong>locally</strong></span> on <span class="strong"><strong>all</strong></span> cluster nodes to not depend on DNS services (as it
can fail, too).</p></li><li class="listitem"><p>Time synchronization between the cluster nodes using reliable time services
like NTP.</p></li><li class="listitem"><p>Both SAP HANA sites have the same SAP Identifier (SID) and instance number.</p></li><li class="listitem"><p>The SAP HANA scale-out system must have only <span class="strong"><strong>one</strong></span> active master name server per
site. It should have up to three master name server candidates (SAP HANA
nodes with a configured role 'master&lt;N&gt;').</p></li><li class="listitem"><p>The SAP HANA scale-out system must have only <span class="strong"><strong>one</strong></span> failover group.</p></li><li class="listitem"><p>The cluster described in this document does not manage any service IP address
for a read-enabled secondary site.</p></li><li class="listitem"><p>There is only one SAP HANA system replication like from site "A" to site "B" but no
third site "C" (also called multi-tier or multi-target).</p></li><li class="listitem"><p>The setup implements the performance optimized scenario but not the cost
optimized scenario.</p></li><li class="listitem"><p>The <span class="emphasis"><em>saphostagent</em></span> must be running. <span class="emphasis"><em>saphostagent</em></span> is needed to translate between
the system node names and SAP host names used during the installation of SAP HANA.</p></li><li class="listitem"><p>The replication mode should be either 'sync' or 'syncmem'.</p></li><li class="listitem"><p>All SAP HANA instances controlled by the cluster must not be activated via
<span class="emphasis"><em>sapinit</em></span> autostart.</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>Automated registration of a failed primary after takeover is possible. But as a
good starting configuration for projects, it is recommended to switch <span class="strong"><strong>off</strong></span> the
automated registration of a failed primary, therefore the
<code class="literal">AUTOMATED_REGISTER="false"</code> is the <span class="strong"><strong>default</strong></span>.</p><p>In this case, you need to register a failed primary after a takeover manually.
Use SAP tools like SAP HANA Cockpit or <span class="strong"><strong>hdbnsutil</strong></span>.</p></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Automated start of SAP HANA instances during system boot must be switched
<span class="strong"><strong>off</strong></span>.</p></li><li class="listitem"><p>You need at least SAPHanaSR-ScaleOut version 0.161, SUSE Linux Enterprise Server for SAP Applications 12 SP2 and
SAP HANA 1.0 SPS12 (121) or SAP HANA 2.0 SPS 2 for all mentioned setups.</p></li></ul></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>You must implement a valid STONITH method. Without a valid STONITH
method, the complete cluster is unsupported and will not work properly.</p></div><p>This setup-guide focuses on the performance optimized setup as it is the
only supported scenario at the point of writing this guide.</p><p>If you need to implement a different scenario, it is strongly recommended to define
a Proof-of-Concept (PoC) with SUSE. This PoC will focus on testing the existing
solution in your scenario. The limitation of most of the above items is mostly
due to testing limits.</p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-setting-up-the-operating-system"></a>Setting up the operating system</h2></div></div></div><p><a id="OsSetup"></a>This section includes information you should consider during the
installation of the operating system.</p><div class="figure"><a id="id1743"></a><p class="title"><strong>Figure 8. <a class="xref" href="#Planning">[Planning]</a> OsSetup <a class="xref" href="#SAPHanaInst">[SAPHanaInst]</a> <a class="xref" href="#SAPHanaHsr">[SAPHanaHsr]</a> <a class="xref" href="#Integration">[Integration]</a> <a class="xref" href="#Cluster">[Cluster]</a> <a class="xref" href="#Testing">[Testing]</a></strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase2.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase2" /></td></tr></table></div></div></div><br class="figure-break" /><p>In this document, first SUSE Linux Enterprise Server for SAP Applications is installed and configured. Then the SAP HANA
database including the system replication is set up. Finally the
automation with the cluster is set up and configured.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-suse-linux-enterprise-server-for-sap-applications"></a>Installing SUSE Linux Enterprise Server for SAP Applications</h3></div></div></div><p>Multiple installation guides are already existing, with different reasons to set up the server in a certain way.
Below it is outlined where this information can be found.
In addition, you will find important details you should consider to get a system which is well prepared to deliver SAP HANA.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-installing-the-base-operating-system"></a>Installing the base operating system</h4></div></div></div><p>Depending on your infrastructure and the hardware used, you need to adapt the installation.
All supported installation methods and minimum requirement are described in the <span class="emphasis"><em>Deployment Guide</em></span>
(<a class="link" href="https://documentation.suse.com/sles/12-SP5/html/SLES-all/book-sle-deployment.html" target="_top">https://documentation.suse.com/sles/12-SP5/html/SLES-all/book-sle-deployment.html</a>).
In case of automated installations you can find further information in the <span class="emphasis"><em>AutoYaST Guide</em></span>
(<a class="link" href="https://documentation.suse.com/sles/12-SP5/html/SLES-all/book-autoyast.html" target="_top">https://documentation.suse.com/sles/12-SP5/html/SLES-all/book-autoyast.html</a>).
The major installation guide for SUSE Linux Enterprise Server for SAP Applications to fit all requirements for SAP HANA is described in the
SAP notes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>1984787 SUSE LINUX Enterprise Server 12: Installation notes and</p></li><li class="listitem"><p>2205917 SAP HANA DB: Recommended OS settings for SLES 12 / SLES for SAP Applications 12.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-installing-additional-software"></a>Installing additional software</h4></div></div></div><p>SUSE delivers with SUSE Linux Enterprise Server for SAP Applications special resource agents for SAP HANA. With the pattern <span class="emphasis"><em>sap-hana</em></span> the resource
agent for SAP HANA <span class="strong"><strong>ScaleUP</strong></span> is installed. For the <span class="strong"><strong>ScaleOut</strong></span> scenario you need a special resource agent.
Follow the instructions below on each node if you have installed the systems based on SAP note 1984787.
The pattern <span class="emphasis"><em>High Availability</em></span> summarizes all tools recommended to be installed on <span class="strong"><strong>all</strong></span> nodes, including the
<span class="emphasis"><em>majority maker</em></span>.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>remove package: patterns-sap-hana, SAPHanaSR, yast2-sap-ha</p></li><li class="listitem"><p>install package: SAPHanaSR-ScaleOut, SAPHanaSR-ScaleOut-doc</p></li><li class="listitem"><p>install pattern: ha_sles</p></li></ul></div><p>To do so, for example, use Zypper:</p><div class="example"><a id="id1789"></a><p class="title"><strong>Example 1. Uninstall the SAPHanaSR agent for ScaleUP</strong></p><div class="example-contents"><p>As user root, type:</p><pre class="screen">zypper remove SAPHanaSR</pre><p>If the package is installed, you will get an output like this:</p><pre class="screen">Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following 3 packages are going to be REMOVED:
  patterns-sap-hana SAPHanaSR yast2-sap-ha

The following pattern is going to be REMOVED:
  sap-hana

3 packages to remove.
After the operation, 494.2 KiB will be freed.
Continue? [y/n/...? shows all options] (y): y
(1/3) Removing patterns-sap-hana-12.3-6.8.2.x86_64 ..............................[done]
(2/3) Removing yast2-sap-ha-1.0.0-2.5.12.noarch .................................[done]
(3/3) Removing SAPHanaSR-0.152.21-1.1.noarch ....................................[done]</pre></div></div><br class="example-break" /><div class="example"><a id="id1795"></a><p class="title"><strong>Example 2. Installation of the SAPHanaSR agent for ScaleOut</strong></p><div class="example-contents"><p>As user root, type:</p><pre class="screen">zypper in SAPHanaSR-ScaleOut SAPHanaSR-ScaleOut-doc</pre><p>If the package is not installed yet, you should get an output like the below:</p><pre class="screen">Refreshing service 'Advanced_Systems_Management_Module_12_x86_64'.
Refreshing service 'SUSE_Linux_Enterprise_Server_for_SAP_Applications_12_SP3_x86_64'.
Loading repository data...
Reading installed packages...
Resolving package dependencies...

The following 2 NEW packages are going to be installed:
  SAPHanaSR-ScaleOut SAPHanaSR-ScaleOut-doc

2 new packages to install.
Overall download size: 539.1 KiB. Already cached: 0 B. After the operation, additional 763.1 KiB will be used.
Continue? [y/n/...? shows all options] (y): y
Retrieving package SAPHanaSR-ScaleOut-0.161.1-1.1.noarch                                                                            (1/2),  48.7 KiB (211.8 KiB unpacked)
Retrieving: SAPHanaSR-ScaleOut-0.161.1-1.1.noarch.rpm ....................................[done]
Retrieving package SAPHanaSR-ScaleOut-doc-0.161.1-1.1.noarch                                                                        (2/2), 490.4 KiB (551.3 KiB unpacked)
Retrieving: SAPHanaSR-ScaleOut-doc-0.161.1-1.1.noarch.rpm ................................[done (48.0 KiB/s)]
Checking for file conflicts: .............................................................[done]
(1/2) Installing: SAPHanaSR-ScaleOut-0.161.1-1.1.noarch ..................................[done]
(2/2) Installing: SAPHanaSR-ScaleOut-doc-0.161.1-1.1.noarch ..............................[done]</pre><p>Install the tools for High Availability on all nodes.</p><pre class="screen">zypper in --type pattern ha_sles</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-getting-the-latest-updates"></a>Getting the latest updates</h4></div></div></div><p>If you have installed the packages before, make sure to deploy the newest updates on <span class="strong"><strong>all</strong></span> machines
to have the latest versions of the resource agents and other packages. A prerequisite is a valid
subscription for SUSE Linux Enterprise Server for SAP Applications. There are multiple ways to get updates via SUSE Manager, the
Subscription Management Tool (SMT), or via a direct connection to the SUSE Customer Center (SCC).</p><p>Depending on your company or customer rules, use <code class="literal">zypper update</code> or <code class="literal">zypper patch</code>.</p><div class="example"><a id="id1810"></a><p class="title"><strong>Example 3. Software update must be triggered from each node</strong></p><div class="example-contents"><p>The command <code class="literal">zypper patch</code> will install all available needed patches.
As user root, type:</p><pre class="screen">zypper patch</pre><p>The command <code class="literal">zypper update</code> will update all or specified installed packages with newer versions, if possible.
As user root, type:</p><pre class="screen">zypper update</pre></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-configuring-suse-linux-enterprise-server-for-sap-applications-to-run-sap-hana"></a>Configuring SUSE Linux Enterprise Server for SAP Applications to run SAP HANA</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-tuning-or-modifying"></a>Tuning or modifying</h4></div></div></div><p>Operating system tuning are described in SAP note 1275776 and 2205917.
The SAP note 1275776 explains three ways to implementing the settings.</p><div class="example"><a id="id1823"></a><p class="title"><strong>Example 4. Using saptune (preferred)</strong></p><div class="example-contents"><pre class="screen">saptune solution apply HANA</pre></div></div><br class="example-break" /><p>The SAP note 2205917 covers the following modifications:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SUSE Linux Enterprise Server 12 GA (no SP) and SUSE Linux Enterprise Server 12 SP1 Linux kernel upgrade</p></li><li class="listitem"><p>SUSE Linux Enterprise Server 12 SP2 Linux kernel upgrade</p></li><li class="listitem"><p>SUSE Linux Enterprise Server 12 SP3 Linux kernel upgrade</p></li><li class="listitem"><p>SUSE Linux Enterprise Server 12 SP4 Linux kernel upgrade</p></li><li class="listitem"><p>Additional 3rd-party kernel modules</p></li><li class="listitem"><p>Configure tuned to use profile "sap-hana" (applies to Intel-based systems only)</p></li><li class="listitem"><p>Increase UserTasksMax</p></li><li class="listitem"><p>Turn off NUMA balancing</p></li><li class="listitem"><p>Disable transparent hugepages</p></li><li class="listitem"><p>Configure C-States for lower latency in Linux (applies to Intel-based systems only)</p></li><li class="listitem"><p>CPU Frequency/Voltage scaling (applies to Intel-based systems only)</p></li><li class="listitem"><p>Energy Performance Bias (EPB, applies to Intel-based systems only)</p></li><li class="listitem"><p>Turn off kernel samepage merging (KSM)</p></li><li class="listitem"><p>IBM EnergyScale for POWER8 Processor-Based Systems (applies to IBM Power systems only)</p></li><li class="listitem"><p>Linux page cache limit</p></li><li class="listitem"><p>Network settings</p></li><li class="listitem"><p>Intel Cluster-On-Die (COD) / sub-NUMA clustering technology</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-enabling-ssh-access-via-public-key-optional"></a>Enabling SSH access via public key (optional)</h4></div></div></div><p>Public key authentication provides SSH users access to their servers without entering their passwords.
SSH keys are also more secure than passwords, because the private key used to secure the connection
is never shared. Private keys can also be encrypted. Their encrypted contents cannot easily be read.
For the document at hand, a very simple but useful setup is used. This setup is based on
only one ssh-key pair which enables SSH access to all cluster nodes.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Follow your company security policy to set up access to the systems.</p></div><div class="example"><a id="id1867"></a><p class="title"><strong>Example 5. SSH key creation and exchange</strong></p><div class="example-contents"><p>As user root create an SSH key on one node.</p><pre class="screen">ssh-keygen -t rsa</pre><p>The ssh-key generation asks for missing parameters.</p><pre class="screen">Generating public/private rsa key pair.
Enter file in which to save the key (/root/.ssh/id_rsa):
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in /root/.ssh/id_rsa.
Your public key has been saved in /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:ip/8kdTbYZNuuEUAdsaYOAErkwnkAPBR7d2SQIpIZCU root@&lt;host1&gt;
The key's randomart image is:
+---[RSA 2048]----+
|XEooo+ooo+o      |
|=+.= o=.o+.      |
|..B o. + o.      |
|   o  . +... .   |
|        S.. *    |
|     . o . B o   |
|    . . o o =    |
|     o . . +     |
|      +.. .      |
+----[SHA256]-----+</pre><p>After the <code class="literal">ssh-keygen</code> is set up, you will have two new files under <code class="literal">/root/.ssh/</code> .</p><pre class="screen">ls /root/.ssh/
id_rsa  id_rsa.pub</pre><p>Collect the public host keys from all other node. For the document at hand, the <span class="emphasis"><em>ssh-keyscan</em></span> command is used.</p><pre class="screen">ssh-keyscan</pre><p>The SSH host key is automatically collected and stored in the file <code class="literal">/root/.ssh/known_host</code> during the first SSH
connection. To avoid to confirm the first login with "yes", which accepts the host key, collect and store
them beforehand.</p><pre class="screen">ssh-keyscan -t ecdsa-sha2-nistp256 &lt;host1&gt;,&lt;host1 ip&gt; &gt;&gt;.ssh/known_hosts
ssh-keyscan -t ecdsa-sha2-nistp256 &lt;host2&gt;,&lt;host2 ip&gt; &gt;&gt;.ssh/known_hosts
ssh-keyscan -t ecdsa-sha2-nistp256 &lt;host3&gt;,&lt;host3 ip&gt; &gt;&gt;.ssh/known_hosts
...</pre><p>After collecting all host keys store them in a file named <code class="literal">authorized_keys</code>. Push the entire
directory <code class="literal">/root/.ssh/</code> from the first node to all further cluster members.</p><pre class="screen">rsync -ay /root/.ssh/ &lt;host2&gt;:/root/.ssh/
rsync -ay /root/.ssh/ &lt;host3&gt;:/root/.ssh/
rsync -ay /root/.ssh/ &lt;host4&gt;:/root/.ssh/
....</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-setting-up-disk-layout-for-sap-hana"></a>Setting up disk layout for SAP HANA</h4></div></div></div><p>An SAP certified storage system with a validated storage
API is generally recommended. This is a prerequisite of a stable and reliable scale-out installation.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>/hana/shared/&lt;SID&gt;</p></li><li class="listitem"><p>/hana/data/&lt;SID&gt;</p></li><li class="listitem"><p>/hana/log/&lt;SID&gt;</p></li></ul></div><p>Create the mount directories on all SAP HANA nodes.</p><pre class="screen">mkdir -p /hana/shared/&lt;SID&gt;
mkdir -p /hana/data/&lt;SID&gt;
mkdir -p /hana/log/&lt;SID&gt;
mkdir -p /usr/sap</pre><p>The SAP HANA installation needs a special storage setup. The NFS setup used for this guide must be
reboot-persistent. You can achieve this with entries in the <code class="literal">/etc/fstab</code>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>NFS version 4 is required in the setup at hand.</p></div><div class="example"><a id="id1903"></a><p class="title"><strong>Example 6. Create permanent mount entries for all NFS pools</strong></p><div class="example-contents"><p>Create <span class="emphasis"><em>/etc/fstab</em></span> entries for the three NFS pools.</p><pre class="screen">&lt;nfs1&gt;  /hana/data/&lt;SID&gt;      nfs4  defaults  0 0
&lt;nfs2&gt;  /hana/shared/&lt;SID&gt;    nfs4  defaults  0 0
&lt;nfs3&gt; /hana/log/&lt;SID&gt;        nfs4  defaults  0 0</pre><p>In the sample environment those lines are as follows:</p><pre class="screen">/exports/HA1_WDF1/shared  /hana/data/HA1      nfs4  defaults  0 0
/exports/HA1_WDF1/data  /hana/shared/HA1    nfs4  defaults  0 0
/exports/HA1_WDF1/log /hana/log/HA1        nfs4  defaults  0 0</pre></div></div><br class="example-break" /><p>Mount all NFS shares.</p><pre class="screen">mount -a</pre><p>Create other directories (optional).</p><pre class="screen">mkdir -p /sapsoftware</pre><p>File systems</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">/hana/shared/&lt;SID&gt;</span></dt><dd><p>The mount directory is used for shared files between all hosts in an SAP HANA
system. This directory needs to be accessible to each of the servers in the
SAP HANA cluster.</p></dd><dt><span class="term">/hana/log/&lt;SID&gt;</span></dt><dd><p>The default path to the log directory depends on the system ID of the SAP HANA
host.</p></dd><dt><span class="term">/hana/data/&lt;SID&gt;</span></dt><dd><p>The default path to the data directory depends on the system ID of the SAP HANA
host.</p></dd><dt><span class="term">/usr/sap</span></dt><dd><p>This is the path to the local SAP system instance directories. It is possible
to join this location with the Linux installation.</p></dd><dt><span class="term">/sapsoftware</span></dt><dd><p>(optional)
Space for copying the SAP install software media. This NFS pool is mounted on both sites and contains
the SAP HANA installation media and installation parameter files.</p></dd></dl></div><p>Set up host name resolution for all machines.</p><p>You can either use a DNS server or modify the <span class="emphasis"><em>/etc/hosts</em></span> on <span class="strong"><strong>all</strong></span> nodes.</p><p>With maintaining the <code class="literal">/etc/hosts</code> file, you minimize the impact of a failing
DNS service. Replace the IP address and the host name in the following commands.</p><pre class="screen">vi /etc/hosts</pre><p>Insert the following lines to <code class="literal">/etc/hosts</code>. Change the IP address and host name
to match your environment.</p><pre class="screen"><span class="strong"><strong><span class="emphasis"><em>192.168.201.151</em></span></strong></span> <span class="emphasis"><em><span class="strong"><strong>suse01</strong></span></em></span>
<span class="strong"><strong><span class="emphasis"><em>192.168.201.152</em></span></strong></span> <span class="emphasis"><em><span class="strong"><strong>suse02</strong></span></em></span>
...</pre><p>Enable NTP service on all nodes.</p><p>Simply enable an <span class="strong"><strong>ntp service</strong></span> on all node in the cluster to have proper time
synchronization.</p><pre class="screen">yast2 ntp-client</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-installing-the-sap-hana-databases-on-both-sites"></a>Installing the SAP HANA databases on both sites</h2></div></div></div><p><a id="SAPHanaInst"></a>The infrastructure is set up. Now install the SAP HANA database on
both sites. In a cluster a machine is also called a <span class="emphasis"><em>node</em></span>.</p><div class="figure"><a id="id1963"></a><p class="title"><strong>Figure 9. <a class="xref" href="#Planning">[Planning]</a> <a class="xref" href="#OsSetup">[OsSetup]</a> SAPHanaInst <a class="xref" href="#SAPHanaHsr">[SAPHanaHsr]</a> <a class="xref" href="#Integration">[Integration]</a> <a class="xref" href="#Cluster">[Cluster]</a> <a class="xref" href="#Testing">[Testing]</a></strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase3.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase3" /></td></tr></table></div></div></div><br class="figure-break" /><p>In the example at hand, to make it easier to follow the documentation, the
machines (or nodes) are named <span class="emphasis"><em>suse01</em></span>, …​ <span class="emphasis"><em>suseXX</em></span>. The nodes with odd numbers
(suse01, suse03, suse05, …​) will be part of site "A" (WDF1) and the nodes with even numbers
(suse02, suse04, suse06, …​) will be part of site "B"(ROT1) .</p><p>The following users are automatically created during the SAP HANA installation:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">&lt;sid&gt;adm</span></dt><dd><p>The user&lt;sid&gt;adm is the operating system user required for administrative
tasks, such as starting and stopping the system.</p></dd><dt><span class="term">sapadm</span></dt><dd><p>The SAP Host Agent  administrator.</p></dd><dt><span class="term">SYSTEM</span></dt><dd><p>The SAP HANA database superuser.</p></dd></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-preparation"></a>Preparation</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Read the SAP Installation and Setup Manuals available at the SAP Marketplace.</p></li><li class="listitem"><p>Download the SAP HANA Software from SAP Marketplace.</p></li><li class="listitem"><p>Mount the file systems to install SAP HANA database software and database
content (data and log).</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installation"></a>Installation</h3></div></div></div><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Mount /hana/shared from the nfs server.</p><pre class="screen">for system in suse0{1,2,3,4,5,6}; do
    ssh $system mount -a
done</pre></li><li class="listitem"><p>Install the SAP HANA Database as described in the SAP HANA Server
Installation Guide on <span class="strong"><strong>all</strong></span> machines (two sites) except the majority maker.
Both databases need to have same SID and instance number.
You can use either the graphical
user interface or the command line installer <span class="emphasis"><em>hdblcm</em></span>. The command line installer
can be used in an interactive or batch mode.</p><div class="example"><a id="id2012"></a><p class="title"><strong>Example 7. Using hdblcm in interactive mode</strong></p><div class="example-contents"><pre class="screen"># &lt;path_to_sap_media&gt;/hdblcm</pre></div></div><br class="example-break" /><p>Alternatively you can also use the batch mode of <span class="emphasis"><em>hdblcm</em></span>. This can either be
done by specifying all needed parameters via the command line or by using a
parameter file.</p><p>In the example at hand the command line parameters are used. In the batch mode you
need to provide an XML password file (here &lt;path&gt;/hana_passwords). A template of this
password file can be created with the following command:</p><div class="example"><a id="id2018"></a><p class="title"><strong>Example 8. Creating a password file</strong></p><div class="example-contents"><pre class="screen">&lt;path_to_sap_media&gt;/hdblcm --dump_configfile_template=templateFile</pre></div></div><br class="example-break" /><p>This command creates two files:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>templateFile</em></span> is the template for a parameter file.</p></li><li class="listitem"><p><span class="emphasis"><em>templateFile.xml</em></span> is the XML template used to provide several hana_passwords
to the hdblcm installer.</p></li></ul></div><p>The XML password file looks as follows:</p><div class="example"><a id="id2030"></a><p class="title"><strong>Example 9. The XML password template</strong></p><div class="example-contents"><pre class="screen">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- Replace the 3 asterisks with the password --&gt;
&lt;Passwords&gt;
    &lt;root_password&gt;&lt;![CDATA[***]]&gt;&lt;/root_password&gt;
    &lt;sapadm_password&gt;&lt;![CDATA[***]]&gt;&lt;/sapadm_password&gt;
    &lt;master_password&gt;&lt;![CDATA[***]]&gt;&lt;/master_password&gt;
    &lt;sapadm_password&gt;&lt;![CDATA[***]]&gt;&lt;/sapadm_password&gt;
    &lt;password&gt;&lt;![CDATA[***]]&gt;&lt;/password&gt;
    &lt;system_user_password&gt;&lt;![CDATA[***]]&gt;&lt;/system_user_password&gt;
    &lt;streaming_cluster_manager_password&gt;&lt;![CDATA[***]]&gt;&lt;/streaming_cluster_manager_password&gt;
    &lt;ase_user_password&gt;&lt;![CDATA[***]]&gt;&lt;/ase_user_password&gt;
    &lt;org_manager_password&gt;&lt;![CDATA[***]]&gt;&lt;/org_manager_password&gt;
&lt;/Passwords&gt;</pre></div></div><br class="example-break" /><p>After having created the XML password file, you can immediately start the
SAP HANA installation in batch mode by providing all needed parameters via
the command line.</p><div class="example"><a id="id2034"></a><p class="title"><strong>Example 10. Using hdblcm in batch mode</strong></p><div class="example-contents"><p>In the example below the password file is used to provide the password during the installation dialog.
All installation parameters are named directly as one command.</p><pre class="screen"># cat &lt;path&gt;/hana_passwords | \
&lt;path_to_sap_media&gt;/hdblcm \
  --batch \
  --sid=&lt;SID&gt;\
  --number=&lt;Inst&gt; \
  --action=install \
  --hostname=&lt;node1&gt; \
  --addhosts=&lt;node2&gt;:role=worker,&lt;node3&gt;:role=standby  \
  --certificates_hostmap=&lt;node1&gt;=&lt;node1&gt; \
  --certificates_hostmap=&lt;node2&gt;=&lt;node2&gt; \
  --certificates_hostmap=&lt;node3&gt;=&lt;node3&gt; \
  --install_hostagent \
  --system_usage=test \
  --sapmnt=/hana/shared \
  --datapath=&lt;datapath&gt; \
  --logpath=&lt;logpath&gt; \
  --root_user=root  \
  --workergroup=default \
  --home=/usr/sap/&lt;SID&gt;/home \
  --userid=&lt;uid&gt; \
  --shell=/bin/bash \
  --groupid=&lt;gid&gt; \
  --read_password_from_stdin=xml</pre><p>The second example use the modified template file as answering file.</p><pre class="screen"># cat &lt;path&gt;/hana_passwords | \
&lt;path_to_sap_media&gt;/hdblcm \
 -b \
 --configfile=&lt;path_to_templateFile&gt;/&lt;mod_templateFile&gt; \
 --read_password_from_stdin=xml</pre></div></div><br class="example-break" /></li></ol></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-checks"></a>Checks</h3></div></div></div><p>Verify that <span class="strong"><strong>both</strong></span> database sites are up and all processes of these databases
are running correctly.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>As Linux user <span class="emphasis"><em>&lt;sid&gt;adm</em></span> use the SAP command line tool <span class="emphasis"><em>HDB</em></span> to get an
overview of all running SAP HANA processes. The output of <span class="emphasis"><em>HDB info</em></span> should look like
the example below for <span class="strong"><strong>both</strong></span> sites:</p><div class="example"><a id="id2051"></a><p class="title"><strong>Example 11. Calling  HDB info (as user &lt;sid&gt;adm)</strong></p><div class="example-contents"><pre class="screen">HDB info</pre><p>The <span class="emphasis"><em>HDB info</em></span> command lists the processes currently running for that SID.</p><pre class="screen">USER           PID  ...  COMMAND
ha1adm         6561 ...  -csh
ha1adm         6635 ...    \_ /bin/sh /usr/sap/HA1/HDB00/HDB info
ha1adm         6658 ...        \_ ps fx -U HA1 -o user,pid,ppid,pcpu,vsz,rss,args
ha1adm         5442 ...  sapstart pf=/hana/shared/HA1/profile/HA1_HDB00_suse01
ha1adm         5456 ...   \_ /usr/sap/HA1/HDB00/suse01/trace/hdb.sapha1_HDB00 -d -nw -f /usr/sap/ha1/HDB00/suse
ha1adm         5482 ...       \_ hdbnameserver
ha1adm         5551 ...       \_ hdbpreprocessor
ha1adm         5554 ...       \_ hdbcompileserver
ha1adm         5583 ...       \_ hdbindexserver
ha1adm         5586 ...       \_ hdbstatisticsserver
ha1adm         5589 ...       \_ hdbxsengine
ha1adm         5944 ...       \_ sapwebdisp_hdb pf=/usr/sap/HA1/HDB00}/suse01/wdisp/sapwebdisp.pfl -f /usr/sap/SL
ha1adm         5363 ...  /usr/sap/HA1/HDB00/exe/sapstartsrv pf=/hana/shared/HA1/profile/HA1_HDB00_suse02 -D -u s</pre></div></div><br class="example-break" /></li><li class="listitem"><p>Use the python script <span class="emphasis"><em>landscapeHostConfiguration.py</em></span> to show the status of
an entire SAP HANA site.</p><div class="example"><a id="id2060"></a><p class="title"><strong>Example 12. Query the host roles (as user &lt;sid&gt;adm)</strong></p><div class="example-contents"><pre class="screen">HDBSettings.sh landscapeHostConfiguration.py</pre><p>The landscape host configuration is shown with a line per SAP HANA host.</p><pre class="screen"> | Host   | Host   |... NameServer  | NameServer  | IndexServer | IndexServer
 |        | Active |... Config Role | Actual Role | Config Role | Actual Role
 | ------ | ------ |... ----------- | ----------- | ----------- | -----------
 | suse01 | yes    |... master 1    | master      | worker      | master
 | suse03 | yes    |... master 2    | slave       | worker      | slave
 | suse05 | yes    |... master 3    | slave       | standby     | standby

 overall host status: ok</pre></div></div><br class="example-break" /></li><li class="listitem"><p>Get an overview of instances of that site (as user &lt;sid&gt;adm)</p><div class="example"><a id="id2067"></a><p class="title"><strong>Example 13. Get the list of instances</strong></p><div class="example-contents"><pre class="screen">sapcontrol -nr &lt;Inst&gt; -function GetSystemInstanceList</pre><p>You should get a list of SAP HANA instances belonging to that site.</p><pre class="screen">12.06.2018 17:25:16
GetSystemInstanceList
OK
hostname, instanceNr, httpPort, httpsPort, startPriority, features, dispstatus
suse01, 00, 50013, 50014, 0.3, HDB|HDB_WORKER, GREEN
suse05, 00, 50013, 50014, 0.3, HDB|HDB_WORKER, GREEN
suse03, 00, 50013, 50014, 0.3, HDB|HDB_WORKER, GREEN</pre></div></div><br class="example-break" /></li></ol></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-setting-up-the-sap-hana-system-replication"></a>Setting up the SAP HANA system replication</h2></div></div></div><p><a id="SAPHanaHsr"></a>This section describes the setup of the system replication (HSR) after SAP HANA has
been installed properly.</p><p><span class="strong"><strong>Procedure</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Back up the primary database</p></li><li class="listitem"><p>Enable the primary database</p></li><li class="listitem"><p>Register the secondary database</p></li><li class="listitem"><p>Verify the system replication</p></li></ol></div><div class="figure"><a id="id2087"></a><p class="title"><strong>Figure 10. <a class="xref" href="#Planning">[Planning]</a> <a class="xref" href="#OsSetup">[OsSetup]</a> <a class="xref" href="#SAPHanaInst">[SAPHanaInst]</a> SAPHanaHsr <a class="xref" href="#Integration">[Integration]</a> <a class="xref" href="#Cluster">[Cluster]</a> <a class="xref" href="#Testing">[Testing]</a></strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase4.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase4" /></td></tr></table></div></div></div><br class="figure-break" /><p>For more information read the Section <span class="emphasis"><em>Setting Up System Replication</em></span> of the
SAP HANA Administration Guide.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-backing-up-the-primary-database"></a>Backing up the primary database</h3></div></div></div><p>First back up the primary database as described in the
<span class="emphasis"><em>SAP HANA Administration Guide, Section SAP HANA Database Backup and Recovery</em></span>.</p><p>Below find examples to back up SAP HANA with SQL Commands:</p><div class="example"><a id="id2107"></a><p class="title"><strong>Example 14. Simple backup for the system database and all tenants with one single backup call</strong></p><div class="example-contents"><p>As user &lt;sid&gt;adm enter the following command:</p><pre class="screen">hdbsql -i {refInst} -u SYSTEM -d SYSTEMDB \
   "BACKUP DATA FOR FULL SYSTEM USING FILE ('backup')"</pre><p>You get the following command output (or similar):</p><pre class="screen">0 rows affected (overall time 15.352069 sec; server time 15.347745 sec)</pre></div></div><br class="example-break" /><div class="example"><a id="id2113"></a><p class="title"><strong>Example 15. Simple backup for a single container (non-MDC) database</strong></p><div class="example-contents"><p>Enter the following command as user &lt;sid&gt;adm:</p><pre class="screen">hdbsql -i &lt;Inst&gt; -u &lt;dbuser&gt; \
   "BACKUP DATA USING FILE ('backup')"</pre></div></div><br class="example-break" /><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>Without a valid backup, you <span class="strong"><strong>cannot</strong></span> bring SAP HANA into a system
replication configuration.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-enabling-the-primary-database"></a>Enabling the primary database</h3></div></div></div><p>As Linux user <span class="emphasis"><em>&lt;sid&gt;adm</em></span> enable the system replication at the primary node. You
need to define a site name (like <span class="emphasis"><em>WDF1</em></span>) which must be unique for all SAP HANA
databases which are connected via system replication. This means the secondary
must have a different site name.</p><div class="example"><a id="id2125"></a><p class="title"><strong>Example 16. Enable the system replication on the primary site</strong></p><div class="example-contents"><p>As user &lt;sid&gt;adm enable the primary:</p><pre class="screen">hdbnsutil -sr_enable --name=WDF1</pre><p>Check if the command output is similar to:</p><pre class="screen">nameserver is active, proceeding ...
successfully enabled system as system replication source site
done.</pre></div></div><br class="example-break" /><p>The command line tool <span class="emphasis"><em>hdbnsutil</em></span> can be used to check the system replication
mode and site name.</p><div class="example"><a id="id2133"></a><p class="title"><strong>Example 17. Check the system replication configuration status as user &lt;sid&gt;adm on the primary</strong></p><div class="example-contents"><pre class="screen">hdbnsutil -sr_stateConfiguration</pre><p>If the system replication enablement was successful at the primary, the
output should be as follows:</p><pre class="screen">checking for active or inactive nameserver ...
System Replication State
~~~~~~~~~~~~~~~~~~~~~~~~

mode: primary
site id: 1
site name: WDF1
done.</pre></div></div><br class="example-break" /><p>The mode has changed from “none” to “primary” and the site now has a site name
and a site ID.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-registering-the-secondary-database"></a>Registering the secondary database</h3></div></div></div><p>The SAP HANA database instance on the secondary side must be stopped before the
system can be registered for the system replication. You can use your
preferred method to stop the instance (like <span class="emphasis"><em>HDB</em></span> or <span class="emphasis"><em>sapcontrol</em></span>). After the
database instance has been stopped successfully, you can register the instance
using <span class="emphasis"><em>hdbnsutil</em></span>.</p><div class="example"><a id="id2145"></a><p class="title"><strong>Example 18. Stop the secondary as Linux user <span class="emphasis"><em>&lt;sid&gt;adm</em></span>:</strong></p><div class="example-contents"><pre class="screen">sapcontrol -nr &lt;Inst&gt; -function StopSystem</pre></div></div><br class="example-break" /><div class="example"><a id="id2149"></a><p class="title"><strong>Example 19. Copy the KEY and KEY-DATA file from the primary to the secondary site</strong></p><div class="example-contents"><p>The copy of key and key-data should only be done on the master name server.
As the files are in the global file space, you do not need to run the command
on all cluster nodes.</p><pre class="screen">cd /usr/sap/&lt;SID&gt;/SYS/global/security/rsecssfs
rsync -va {,&lt;node1-siteB&gt;:}$PWD/data/SSFS_&lt;SID&gt;.DAT
rsync -va {,&lt;node1-siteB&gt;:}$PWD/key/SSFS_&lt;SID&gt;.KEY</pre></div></div><br class="example-break" /><div class="example"><a id="id2153"></a><p class="title"><strong>Example 20. Register the secondary as Linux user <span class="emphasis"><em>&lt;sid&gt;adm</em></span>:</strong></p><div class="example-contents"><pre class="screen">hdbnsutil -sr_register --name=&lt;site2&gt; \
     --remoteHost=&lt;node1-siteA&gt; --remoteInstance=&lt;Inst&gt; \
     --replicationMode=sync --operationMode=logreplay</pre><pre class="screen">adding site ...
checking for inactive nameserver ...
nameserver suse02:30001 not responding.
collecting information ...
updating local ini files ...
done.</pre></div></div><br class="example-break" /><p>The <span class="emphasis"><em>remoteHost</em></span> is the primary node in our case, the <span class="emphasis"><em>remoteInstance</em></span> is the
database instance number (here 00).</p><p>Now start the database instance again and verify the system replication status.
On the secondary site, the mode should be one of „SYNC“, „SYNCMEM“ or „ASYNC“.
The mode depends on the <span class="strong"><strong>sync</strong></span> option defined during the registration of the
secondary.</p><div class="example"><a id="id2163"></a><p class="title"><strong>Example 21. Start the system on the secondary site as user &lt;sid&gt;adm</strong></p><div class="example-contents"><pre class="screen">sapcontrol -nr &lt;Inst&gt; -function StartSystem</pre><p>Wait until the SAP HANA database is started completely.</p></div></div><br class="example-break" /><div class="example"><a id="id2167"></a><p class="title"><strong>Example 22. Check the system replication configuration as Linux user &lt;sid&gt;adm</strong></p><div class="example-contents"><pre class="screen">hdbnsutil -sr_stateConfiguration</pre><p>The output should look like the following:</p><pre class="screen">System Replication State
~~~~~~~~~~~~~~~~~~~~~~~~
mode: sync
site id: 2
site name: ROT1
active primary site: 1

primary masters: suse01 suse03 suse05
done.</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-verifying-the-system-replication"></a>Verifying the system replication</h3></div></div></div><p>To view the replication state of the whole SAP HANA cluster, use the following
command as <span class="emphasis"><em>&lt;sid&gt;adm</em></span> user on the primary site.</p><div class="example"><a id="id2176"></a><p class="title"><strong>Example 23. Check the system replication status at the primary site (as &lt;sid&gt;adm)</strong></p><div class="example-contents"><pre class="screen">HDBSettings.sh systemReplicationStatus.py</pre><p>This script prints a human-readable table of the system replication channels and their status. The
most interesting column is the <span class="strong"><strong>Replication Status</strong></span>, which should be <span class="strong"><strong>ACTIVE</strong></span>.</p><pre class="screen">| Database | Host   | .. Site Name | Secondary | .. Secondary | .. <span class="strong"><strong>Replication</strong></span>
|          |        | ..           | Host      | .. Site Name | .. <span class="strong"><strong>Status</strong></span>
| -------- | ------ | .. --------- | --------- | .. --------- | .. ------
| SYSTEMDB | suse01 | .. WDF1      | suse02    | .. ROT1      | .. <span class="strong"><strong>ACTIVE</strong></span>
| HA1      | suse01 | .. WDF1      | suse02    | .. ROT1      | .. <span class="strong"><strong>ACTIVE</strong></span>
| HA1      | suse01 | .. WDF1      | suse02    | .. ROT1      | .. <span class="strong"><strong>ACTIVE</strong></span>
| HA1      | suse03 | .. WDF1      | suse04    | .. ROT1      | .. <span class="strong"><strong>ACTIVE</strong></span>

status system replication site "2": ACTIVE
overall system replication status: ACTIVE

Local System Replication State
<sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub><sub>~</sub>

mode: PRIMARY
site id: 1
site name: WDF1</pre></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-integrating-sap-hana-with-the-cluster"></a>Integrating SAP HANA with the cluster</h2></div></div></div><div class="figure"><a id="id2201"></a><p class="title"><strong>Figure 11. <a class="xref" href="#Planning">[Planning]</a> <a class="xref" href="#OsSetup">[OsSetup]</a> <a class="xref" href="#SAPHanaInst">[SAPHanaInst]</a> <a class="xref" href="#SAPHanaHsr">[SAPHanaHsr]</a> Integration <a class="xref" href="#Cluster">[Cluster]</a> <a class="xref" href="#Testing">[Testing]</a></strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase5.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase5" /></td></tr></table></div></div></div><br class="figure-break" /><p><a id="Integration"></a>Proceed with the following steps:</p><p><span class="strong"><strong>Procedure</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Implement the python hook SAPHanaSR</p></li><li class="listitem"><p>Configure system replication operation mode</p></li><li class="listitem"><p>Allow &lt;sid&gt;adm to access the cluster</p></li><li class="listitem"><p>Start SAP HANA</p></li><li class="listitem"><p>Test the hook integration</p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-implementing-the-python-hook-saphanasr"></a>Implementing the Python hook SAPHanaSR</h3></div></div></div><p>This step must be done on both sites. SAP HANA must be stopped to change the
<span class="emphasis"><em>global.ini</em></span> and allow SAP HANA to integrate the HA/DR hook script during start.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Install the HA/DR hook script into a read/writable directory</p></li><li class="listitem"><p>Integrate the hook into <span class="emphasis"><em>global.ini</em></span> (SAP HANA needs to be stopped for doing that offline)</p></li><li class="listitem"><p>Check integration of the hook during start-up</p></li></ul></div><p>Take the hook from the SAPHanaSR-ScaleOut package and copy it to your preferred
directory like /hana/share/myHooks. The hook must be available on all SAP HANA nodes.</p><pre class="screen">suse01~ # mkdir -p /hana/shared/myHooks
suse01~ # cp /usr/share/SAPHanaSR-ScaleOut/SAPHanaSR.py /hana/shared/myHooks
suse01~ # chown -R &lt;sid&gt;adm:sapsys /hana/shared/myHooks</pre><p>Stop SAP HANA.</p><pre class="screen">sapcontrol -nr &lt;Inst&gt; -function StopSystem</pre><div class="example"><a id="id2245"></a><p class="title"><strong>Example 24. Adding SAPHanaSR via global.ini</strong></p><div class="example-contents"><pre class="screen">[ha_dr_provider_SAPHanaSR]
provider = SAPHanaSR
path = /hana/shared/myHooks
execution_order = 1

[trace]
ha_dr_saphanasr = info</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-configuring-the-system-replication-operation-mode"></a>Configuring the system replication operation mode</h3></div></div></div><p>When your system is connected as an SAPHanaSR target, you can find an entry in the <span class="emphasis"><em>global.ini</em></span> file
which defines the operation mode. Up to now there are two modes available:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p><span class="emphasis"><em>delta_datashipping</em></span></p></li><li class="listitem"><p><span class="emphasis"><em>logreplay</em></span></p></li></ul></div><p>Until performing a takeover and re-registration in the opposite direction, the entry for the operation mode is missing on
your primary site. The "classic" operation mode is <span class="emphasis"><em>delta_datashipping</em></span>. The preferred mode for HA is
<span class="emphasis"><em>logreplay</em></span>. Using the operation mode <span class="emphasis"><em>logreplay</em></span> makes your secondary site in the SAP HANA
system replication a hot standby system.
For more details regarding both modes check the SAP documentation such as
"How To Perform System Replication for SAP HANA" (see <a class="link" href="https://www.sap.com/documents/2013/10/26c02b58-5a7c-0010-82c7-eda71af511fa.html" target="_top">https://www.sap.com/documents/2013/10/26c02b58-5a7c-0010-82c7-eda71af511fa.html</a>).</p><p>Check both <span class="emphasis"><em>global.ini</em></span> files and add the operation mode, if needed.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">section</span></dt><dd><p>[ system_replication ]</p></dd><dt><span class="term">key</span></dt><dd><p>operation_mode = logreplay</p></dd></dl></div><p>Path for the <span class="emphasis"><em>global.ini</em></span>: /hana/shared/&lt;SID&gt;/global/hdb/custom/config/</p><pre class="screen">[system_replication]
operation_mode = logreplay</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-allowing-sidadm-to-access-the-cluster"></a>Allowing &lt;sid&gt;adm to access the cluster</h3></div></div></div><p>The current version of the SAPHanaSR python hook uses the command <span class="emphasis"><em>sudo</em></span> to allow
the &lt;sid&gt;adm user to access the cluster attributes. In Linux you can use <span class="emphasis"><em>visudo</em></span>
to start the vi editor for the <span class="strong"><strong>/etc/sudoers</strong></span> configuration file.</p><p>The user &lt;sid&gt;adm must be able to set the cluster attribute hana_&lt;sid&gt;_glob_srHook.
The SAP HANA system replication hook needs password free access. The following
example limits the sudo access to exactly setting the needed attribute.</p><p>Replace the &lt;sid&gt; by the lowercase SAP system ID.</p><div class="example"><a id="id2286"></a><p class="title"><strong>Example 25. Entry in sudo permissions /etc/sudoers file</strong></p><div class="example-contents"><p>Basic parameter option to allow &lt;sidadm&gt; to use the srHook.</p><pre class="screen"># SAPHanaSR-ScaleOut needs for srHook
&lt;sid&gt;adm ALL=(ALL) NOPASSWD: /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_glob_srHook -v *</pre><p>More specific parameters option to meet a high security level.</p><pre class="screen"># SAPHanaSR-ScaleOut needs for srHook
Cmnd_Alias SOK   = /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_glob_srHook -v SOK   -t crm_config -s SAPHanaSR
Cmnd_Alias SFAIL = /usr/sbin/crm_attribute -n hana_&lt;sid&gt;_glob_srHook -v SFAIL -t crm_config -s SAPHanaSR
&lt;sid&gt;adm ALL=(ALL) NOPASSWD: SOK, SFAIL</pre></div></div><br class="example-break" /><div class="example"><a id="id2292"></a><p class="title"><strong>Example 26. Result of replace &lt;sid&gt; with ha1</strong></p><div class="example-contents"><pre class="screen"># SAPHanaSR-ScaleOut needs for srHook
ha1adm ALL=(ALL) NOPASSWD: /usr/sbin/crm_attribute -n hana_ha1_glob_srHook -v *</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-starting-sap-hana"></a>Starting SAP HANA</h3></div></div></div><p>After having completed the SAP HANA integration and having configured the communication between
SAP HANA and the cluster, you can start the SAP HANA databases on both sites.</p><div class="example"><a id="id2298"></a><p class="title"><strong>Example 27. Starting a complete SAP HANA site as use &lt;sid&gt;adm</strong></p><div class="example-contents"><pre class="screen">sapcontrol -nr &lt;Inst&gt; -function StartSystem</pre><p>The <span class="emphasis"><em>sapcontrol</em></span> service commits the request with OK.</p><pre class="screen">11.06.2018 18:30:16
StartSystem
OK</pre><p>Check if SAP HANA has finished starting.</p><pre class="screen">sapcontrol -nr &lt;Inst&gt; -function WaitforStarted 300 20</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-testing-the-hook-integration"></a>Testing the hook integration</h3></div></div></div><p>When the SAP HANA database has been restarted after the changes, check if the hook script is called correctly.</p><p>First check if SAP HANA did create a compiled version of the python script.
The file list in <code class="literal">/hana/shared/myHooks</code> should now also contain a file with
the extension <span class="strong"><strong>pyc</strong></span>.</p><pre class="screen">cd /hana/shared/myHooks; ll</pre><pre class="screen">-rw-r--r-- 1 &lt;sid&gt;adm sapsys 4890 May  4 14:40 SAPHanaSR.py
-rw-r--r-- 1 &lt;sid&gt;adm sapsys 4932 Jun 11 15:00 SAPHanaSR.pyc</pre><p>A second verification is to check the SAP HANA trace files as &lt;sid&gt;adm:</p><pre class="screen">suse01:ha1adm&gt; cdtrace
suse01:ha1adm&gt; awk '/ha_dr_SAPHanaS.*crm_attribute/ \
     { printf "%s %s %s %s\n",$2,$3,$5,$16 }' nameserver_suse01.*
2018-05-04 12:34:04.476445 ha_dr_SAPHanaS...SFAIL
2018-05-04 12:53:06.316973 ha_dr_SAPHanaS...SOK</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-configuring-the-cluster-and-sap-hana-resources"></a>Configuring the cluster and SAP HANA resources</h2></div></div></div><p><a id="Cluster"></a>This chapter describes the configuration of the SUSE Linux Enterprise High Availability cluster. The SUSE Linux Enterprise High Availability Extension is part of SUSE Linux Enterprise Server for SAP Applications.
Further, the integration of SAP HANA System Replication with the SUSE Linux Enterprise High Availability cluster is explained. The integration is done
by using the SAPHanaSR-ScaleOut package which is also part of SUSE Linux Enterprise Server for SAP Applications.</p><div class="figure"><a id="id2320"></a><p class="title"><strong>Figure 12. <a class="xref" href="#Planning">[Planning]</a> <a class="xref" href="#OsSetup">[OsSetup]</a> <a class="xref" href="#SAPHanaInst">[SAPHanaInst]</a> <a class="xref" href="#SAPHanaHsr">[SAPHanaHsr]</a> <a class="xref" href="#Integration">[Integration]</a> Cluster <a class="xref" href="#Testing">[Testing]</a></strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase6.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase6" /></td></tr></table></div></div></div><br class="figure-break" /><p><span class="strong"><strong>Procedure</strong></span></p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Installation of cluster packages</p></li><li class="listitem"><p>Basic Cluster Configuration</p></li><li class="listitem"><p>Configure Cluster Properties and Resources</p></li><li class="listitem"><p>Final steps</p></li></ol></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-the-cluster-packages"></a>Installing the cluster packages</h3></div></div></div><p>If not already done, install the pattern <span class="emphasis"><em>High Availability</em></span> on <span class="strong"><strong>all</strong></span> nodes.</p><p>To do so, use Zypper.</p><pre class="screen">zypper in -t pattern ha_sles</pre><p>Now the Resource Agents for controlling the SAP HANA system replication need
to be installed at <span class="strong"><strong>all</strong></span> cluster nodes, including the majority maker.</p><pre class="screen">zypper in SAPHanaSR-ScaleOut</pre><p>If you have the packages installed before, make sure to get the newest updates
on <span class="strong"><strong>all</strong></span> nodes</p><pre class="screen">zypper patch</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-configuring-the-basic-cluster"></a>Configuring the basic cluster</h3></div></div></div><p>After having installed the cluster packages, the next step is to set up the basic cluster framework. For convenience, use
YaST or the <span class="emphasis"><em>ha-cluster-init</em></span> script.</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>It is strongly recommended to add a second corosync ring, implement unicast (UCAST)
communication and adjust the timeout values to your environment.</p></div><p><span class="strong"><strong>Prerequisites</strong></span></p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Name resolution</p></li><li class="listitem"><p>Time synchronization</p></li><li class="listitem"><p>Redundant network for cluster intercommunication</p></li><li class="listitem"><p>STONITH method</p></li></ul></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-setting-up-watchdog-for-storage-based-fencing"></a>Setting up watchdog for "Storage-based Fencing"</h4></div></div></div><p>It is recommended to use Storage-based Fencing (SBD) as central STONITH device, as done in the example at hand. Each node constantly monitors
connectivity to the storage device, and terminates itself in case the partition becomes unreachable.
Whenever SBD is used, a
correctly working watchdog is crucial. Modern systems support a hardware watchdog that needs to
be "tickled" or "fed" by a software component. The software component (usually a daemon) regularly
writes a service pulse to the watchdog. If the daemon stops feeding the watchdog, the hardware will
enforce a system restart. This protects against failures of the SBD process itself, such as dying, or
getting stuck on an I/O error.</p><div class="example"><a id="id2377"></a><p class="title"><strong>Example 28. Set up for Watchdog</strong></p><div class="example-contents"><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>Access to the watchdog timer:
No other software must access the watchdog timer. Some hardware vendors ship systems management
software that uses the watchdog for system resets (for example, HP ASR daemon). Disable such
software, if watchdog is used by SBD.</p></div><p>Determine the right watchdog module. Alternatively, you can find a list of installed drivers with your
kernel version.</p><pre class="screen">ls -l /lib/modules/$(uname -r)/kernel/drivers/watchdog</pre><p>Check if any watchdog module is already loaded.</p><pre class="screen">lsmod | egrep "(wd|dog|i6|iT|ibm)"</pre><p>If you get a result, the system has already a loaded watchdog. If the watchdog does not match
your watchdog device, you need to unload the module.</p><p>To safely unload the module, check first if an application is using the watchdog device.</p><pre class="screen">lsof /dev/watchdog
rmmod &lt;wrong_module&gt;</pre><p>Enable your watchdog module and make it persistent. For the example below, <span class="emphasis"><em>softdog</em></span> has been used which has some
restrictions and should not be used as first option.</p><pre class="screen">echo softdog &gt; /etc/modules-load.d/watchdog.conf
systemctl restart systemd-modules-load</pre><p>Check if the watchdog module is loaded correctly.</p><pre class="screen">lsmod | grep dog</pre><p>Testing the watchdog can be done with a simple action. Ensure to switch of your SAP HANA
first because watchdog will force an unclean reset / shutdown of your system.</p><p>In case of a hardware watchdog a desired action is predefined after the timeout of the watchdog has
reached. If your watchdog module is loaded and not controlled by any other application, do the following:</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>Triggering the watchdog without continuously updating the watchdog resets/switches off the system.
      This is the intended mechanism. The following commands will force your system to be reset/switched off.</p></div><pre class="screen">touch /dev/watchdog</pre><p>In case the softdog module is used the following action can be performed:</p><pre class="screen">echo 1&gt; /dev/watchdog</pre><p>After your test was successful you can implement the watchdog on all cluster members. The example below
applies to the softdog module. Replace <span class="strong"><strong>&lt;wrong_module&gt;</strong></span> by the module name queried before.</p><pre class="screen">for i in suse{02,03,04,05,06,-mm}; do
    ssh -T $i &lt;&lt;EOSSH
        hostname
        rmmod &lt;wrong_module&gt;
        echo softdog &gt; /etc/modules-load.d/watchdog.conf
        systemctl restart systemd-modules-load
        lsmod |grep -e dog
EOSSH
done</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-setting-up-the-initial-cluster-using-ha-cluster-init"></a>Setting up the initial cluster using <span class="emphasis"><em>ha-cluster-init</em></span></h4></div></div></div><p>For more detailed information about ha-cluster-* tools, see section <span class="emphasis"><em>Overview of the Bootstrap Scripts</em></span> of the Installation and Setup Quick Start Guide
for SUSE Linux Enterprise High Availability Extension at <a class="link" href="https://documentation.suse.com/sle-ha/12-SP4/html/SLE-HA-install-quick/art-ha-install-quick.html#sec-ha-inst-quick-bootstrap" target="_top">https://documentation.suse.com/sle-ha/12-SP4/html/SLE-HA-install-quick/art-ha-install-quick.html#sec-ha-inst-quick-bootstrap</a></p><p>Create an initial setup by using <span class="emphasis"><em>ha-cluster-init</em></span> command. Follow the dialog
steps.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This is <span class="strong"><strong>only</strong></span> to be done on the <span class="strong"><strong>first</strong></span> cluster node. If you are using
SBD as STONITH mechanism, you need to first load the watchdog kernel module
matching your setup. In the example at hand the <span class="emphasis"><em>softdog</em></span> kernel module is used.</p></div><p>The command <span class="emphasis"><em>ha_cluster-init</em></span> configures the basic cluster framework including:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SSH keys</p></li><li class="listitem"><p>csync2 to transfer configuration files</p></li><li class="listitem"><p>SBD (at least one device)</p></li><li class="listitem"><p>corosync (at least one ring)</p></li><li class="listitem"><p>HAWK Web interface</p></li></ul></div><pre class="screen">ha-cluster-init -u -s &lt;sbd-device&gt;</pre><p>As requested by <span class="emphasis"><em>ha-cluster-init</em></span>, change the password of the user <span class="emphasis"><em>hacluster</em></span> on all cluster nodes.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Do not forget to change the password of the user <span class="emphasis"><em>hacluster</em></span>.</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-configuring-the-cluster-for-all-other-cluster-nodes"></a>Configuring the cluster for all other cluster nodes</h4></div></div></div><p>The other nodes of the cluster could be integrated by starting the
command <span class="emphasis"><em>ha-cluster-join</em></span>. This command asks for the IP address or name of
the <span class="strong"><strong>first</strong></span> cluster node. Then all needed configuration files are copied over.
As a result the cluster is started on <span class="strong"><strong>all</strong></span> nodes. Do not forget the majority maker.</p><p>If you are using SBD as STONITH method, you need to activate the <span class="emphasis"><em>softdog</em></span> kernel
module matching your systems. In the example at hand the <span class="emphasis"><em>softdog</em></span> kernel module is used.</p><pre class="screen">ha-cluster-join -c &lt;host1&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-checking-the-cluster-for-the-first-time"></a>Checking the cluster for the first time</h4></div></div></div><p>Now it is time to check and optionally start the cluster for the first time on
all nodes.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>All nodes should be started in parallel. Otherwise unseen nodes might get fenced.</p></div><p>Check the cluster status with <code class="literal">crm_mon</code>. Use the option <code class="literal">-r</code> to also see
resources which are configured but stopped.</p><pre class="screen">crm_mon -r</pre><p>The command will show the "empty" cluster and will print something like the
screen output below. The most interesting information in this output is that
there are seven nodes in the status "online" and the message "partition with quorum".</p><pre class="screen">Stack: corosync
Current DC: suse05 (version 1.1.16-4.8-77ea74d) - partition with quorum
Last updated: Mon Jun 11 16:55:04 2018
Last change: Mon Jun 11 16:53:58 2018 by root via crm_attribute on suse02

7 nodes configured
1 resource configured

Online: [ suse-mm suse01 suse02 suse03 suse04 suse05 suse06 ]

Full list of resources:

stonith-sbd     (stonith:external/sbd): Started suse-mm</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-configuring-cluster-properties-and-resources"></a>Configuring cluster properties and resources</h3></div></div></div><p>This section describes how to configure bootstrap, STONITH, resources, and constraints
using the <span class="emphasis"><em>crm</em></span> configure shell command as described in section
<span class="emphasis"><em>Configuring and Managing Cluster Resources (Command Line)</em></span> of the
SUSE Linux Enterprise High Availability Administration Guide (see <a class="link" href="https://documentation.suse.com/sle-ha/12-SP4/html/SLE-HA-all/cha-ha-manual-config.html" target="_top">https://documentation.suse.com/sle-ha/12-SP4/html/SLE-HA-all/cha-ha-manual-config.html</a>).</p><p>Use the command <span class="emphasis"><em>crm</em></span> to add the objects to the Cluster Resource Management
(CRM). Copy the following examples to a local file and then load the
configuration to the Cluster Information Base (CIB). The benefit is that
you have a scripted setup and a backup of your configuration.</p><p>Perform all <span class="emphasis"><em>crm</em></span> commands only on <span class="strong"><strong>one</strong></span> node, for example on machine suse01.</p><p>First write a text file with the configuration, which you load into your cluster
in a second step. This step is as follows:</p><pre class="screen">vi crm-file&lt;XX&gt;
crm configure load update crm-file&lt;XX&gt;</pre><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-cluster-bootstrap-and-more"></a>Cluster bootstrap and more</h4></div></div></div><p>The first example defines the cluster bootstrap options including the resource and
operation defaults.</p><p>The <code class="literal">stonith-timeout</code> should be greater than 1.2 times the SBD <code class="literal">msgwait</code> timeout.
Find more details and examples in manual page SAPHanaSR-ScaleOut_basic_cluster(7).</p><pre class="screen">vi crm-bs.txt</pre><p>Enter the following to <span class="emphasis"><em>crm-bs.txt</em></span>:</p><pre class="screen">property $id="cib-bootstrap-options" \
              no-quorum-policy="freeze" \
              stonith-enabled="true" \
              concurrent-fencing="true" \
              stonith-action="reboot" \
              stonith-timeout="150s"
rsc_defaults $id="rsc-options" \
              resource-stickiness="1000" \
              migration-threshold="50"
op_defaults $id="op-options" \
              timeout="600"</pre><p>Now add the configuration to the cluster.</p><pre class="screen">crm configure load update crm-bs.txt</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-stonith"></a>STONITH</h4></div></div></div><p>As already explained in the requirements, STONITH is crucial for a supported cluster setup.
Without a valid fencing mechanism your cluster is unsupported.</p><p>A standard STONITH mechanism implements SBD based fencing. The SBD STONITH method is
very stable and reliable and has proved very good road capability.</p><p>You can use other fencing methods available for example from your public cloud provider.
However, it is crucial to intensively test the server fencing.</p><p>For SBD based fencing you can use one up to three SBD devices. The cluster will react differently
when an SBD device is lost. The differences and SBD fencing are explained very well in the SUSE
product documentation of the SUSE Linux Enterprise High Availability Extension available at <a class="link" href="https://documentation.suse.com/" target="_top">https://documentation.suse.com/</a>.</p><p>You need to adapt the SBD resource for the SAP HANA scale-out cluster.</p><p>As user &lt;sid&gt;adm create a file named for crm-fencing.txt.</p><div class="example"><a id="id2491"></a><p class="title"><strong>Example 29. Configure fencing</strong></p><div class="example-contents"><pre class="screen">vi crm-fencing.txt</pre><p>Enter the following to <span class="emphasis"><em>crm-fencing.txt</em></span>:</p><pre class="screen">primitive stonith-sbd stonith:external/sbd \
	params pcmk_action_limit=-1 pcmk_delay_max=1</pre><p>Now load the configuration from the file to the cluster.</p><pre class="screen">crm configure load update crm-fencing.txt</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-cluster-in-maintenance-mode"></a>Cluster in maintenance mode</h4></div></div></div><p>Load the configuration for the resources and the constraints
step-by-step to the cluster to explain the different parts. The
best way to avoid unexpected cluster reactions is to</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>first set the complete cluster to maintenance mode,</p></li><li class="listitem"><p>then do all needed changes and,</p></li><li class="listitem"><p>as last step, end the cluster maintenance mode.</p></li></ul></div><pre class="screen">crm configure property maintenance-mode=true</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-saphanatopology"></a>SAPHanaTopology</h4></div></div></div><p>Next, define the group of resources needed, before the SAP HANA instances can be
started. Prepare the changes in a text file, for example <span class="emphasis"><em>crm-saphanatop.txt</em></span>,
and load these with the <span class="emphasis"><em>crm</em></span> command.</p><p>If necessary, change the <span class="strong"><strong>SID</strong></span> and <span class="strong"><strong>instance number</strong></span> (bold) to appropriate
values for your setup.</p><div class="example"><a id="id2518"></a><p class="title"><strong>Example 30. Configure SAPHanaTopology</strong></p><div class="example-contents"><pre class="screen">suse01:~ # vi crm-saphanatop.txt</pre><p>Enter the following to <span class="emphasis"><em>crm-saphanatop.txt</em></span>:</p><pre class="screen">primitive rsc_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; ocf:suse:SAPHanaTopology \
        op monitor interval="10" timeout="600" \
        op start interval="0" timeout="600" \
        op stop interval="0" timeout="300" \
        params SID="<span class="strong"><strong>&lt;SID&gt;</strong></span>" InstanceNumber="<span class="strong"><strong>&lt;Inst&gt;</strong></span>"

clone cln_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; rsc_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; \
        meta clone-node-max="1" interleave="true"</pre><pre class="screen">primitive rsc_SAPHanaTop_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> ocf:suse:SAPHanaTopology \
        op monitor interval="10" timeout="600" \
        op start interval="0" timeout="600" \
        op stop interval="0" timeout="300" \
        params SID="<span class="strong"><strong>HA1</strong></span>" InstanceNumber="<span class="strong"><strong>00</strong></span>"

clone cln_SAPHanaTop_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> rsc_SAPHanaTop_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> \
        meta clone-node-max="1" interleave="true"</pre><p>For additional information about all parameters, use the command
<code class="literal">man ocf_suse_SAPHanaTopology</code>.</p><p>Again, add the configuration to the cluster.</p><pre class="screen">crm configure load update crm-saphanatop.txt</pre></div></div><br class="example-break" /><p>The most important parameters here are <span class="emphasis"><em>SID</em></span> (HA1) and <span class="emphasis"><em>InstanceNumber</em></span> (00),
which are self explaining in an SAP context.</p><p>Beside these parameters, the timeout values or the operations (start, monitor,
stop) are typical values to be adjusted for your environment.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-saphanacontroller"></a>SAPHanaController</h4></div></div></div><p>Next, define the group of resources needed, before the SAP HANA instances can be
started. Edit the changes in a text file, for example <code class="literal">crm-saphanacon.txt</code> and
load these with the command <code class="literal">crm</code>.</p><pre class="screen">vi crm-saphanacon.txt</pre><div class="example"><a id="id2549"></a><p class="title"><strong>Example 31. Configure SAPHanaController</strong></p><div class="example-contents"><p>Enter the following to crm-saphanacon.txt</p><pre class="screen">primitive rsc_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt; ocf:suse:SAPHanaController \
        op start interval="0" timeout="3600" \
        op stop interval="0" timeout="3600" \
        op promote interval="0" timeout="3600" \
        op monitor interval="60" role="Master" timeout="700" \
        op monitor interval="61" role="Slave" timeout="700" \
        params SID="&lt;SID&gt;" InstanceNumber="&lt;Inst&gt;" \
        PREFER_SITE_TAKEOVER="true" \
        DUPLICATE_PRIMARY_TIMEOUT="7200" AUTOMATED_REGISTER="false"

ms msl_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt; rsc_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt; \
        meta clone-node-max="1" master-max="1" interleave="true"</pre><p>The most important parameters here are &lt;SID&gt; (HA1) and &lt;Inst&gt;
(00), which are in the SAP context quite self explaining.
Beside these parameters, the timeout values or the operations (start, monitor,
stop) are typical tuneables.</p><pre class="screen">primitive rsc_SAPHanaCon_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> ocf:suse:SAPHanaController \
        op start interval="0" timeout="3600" \
        op stop interval="0" timeout="3600" \
        op promote interval="0" timeout="3600" \
        op monitor interval="60" role="Master" timeout="700" \
        op monitor interval="61" role="Slave" timeout="700" \
        params SID="<span class="strong"><strong>HA1</strong></span>" InstanceNumber="<span class="strong"><strong>00</strong></span>" PREFER_SITE_TAKEOVER="true" \
        DUPLICATE_PRIMARY_TIMEOUT="7200" AUTOMATED_REGISTER="false"

ms msl_SAPHanaCon_HA1_HDB00 rsc_SAPHanaCon_HA1_HDB00 \
        meta clone-node-max="1" master-max="1" interleave="true"</pre><p>Add the configuration to the cluster.</p><pre class="screen">crm configure load update crm-saphanacon.txt</pre></div></div><br class="example-break" /><div class="table"><a id="id2561"></a><p class="title"><strong>Table 2. Table Description of important Resource Agent parameter</strong></p><div class="table-contents"><table class="table" summary="Table Description of important Resource Agent parameter" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Name</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>PREFER_SITE_TAKEOVER</p></td><td align="left" valign="top"><p>Defines whether RA should prefer to takeover to the secondary instance instead
of restarting the failed primary locally. Set to <span class="strong"><strong>true</strong></span> for SAPHanaSR-ScaleOut.</p></td></tr><tr><td align="left" valign="top"><p>AUTOMATED_REGISTER</p></td><td align="left" valign="top"><p>Defines whether a former primary should be automatically registered to be
secondary of the new primary. Defaults to <span class="strong"><strong>false</strong></span>.</p><p>If set to <span class="strong"><strong>false</strong></span>, the former primary must be manually registered. The cluster
will not start this SAP HANA RDBMS until it is registered to avoid double
primary up situations.</p></td></tr><tr><td align="left" valign="top"><p>DUPLICATE_PRIMARY_TIMEOUT</p></td><td align="left" valign="top"><p>Time difference needed between two primary time stamps if a dual-primary
situation occurs. If the time difference is less than the time gap, the
cluster holds one or both sites in a "WAITING" status.
This is to give an administrator the chance to react on a failover. If the complete node
of the former primary crashed, the former primary will be registered after the
time difference is passed. If "only" the SAP HANA RDBMS has crashed, then the
former primary will be registered immediately. After this registration to the
new primary, all data will be overwritten by the system replication.</p></td></tr></tbody></table></div></div><br class="table-break" /><p>Additional information about all parameters can be found with the command
<code class="literal">man ocf_suse_SAPHanaController</code>.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-the-virtual-ip-address"></a>The virtual IP address</h4></div></div></div><p>The last resource to be added to the cluster is covering the virtual IP address.
Replace the bold string with your instance number, SAP HANA system ID and the
virtual IP address.</p><div class="example"><a id="id2595"></a><p class="title"><strong>Example 32. Configure the IP Address</strong></p><div class="example-contents"><pre class="screen">vi crm-vip.txt</pre><p>Enter the following to <span class="emphasis"><em>crm-vip.txt</em></span>:</p><pre class="screen">primitive rsc_ip_&lt;SID&gt;_HDB&lt;Inst&gt; ocf:heartbeat:IPaddr2 \
        op monitor interval="10s" timeout="20s" \
        params ip="&lt;IP&gt;"</pre><pre class="screen">primitive rsc_ip_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> ocf:heartbeat:IPaddr2 \
        op monitor interval="10s" timeout="20s" \
        params ip="<span class="strong"><strong>192.168.201.109</strong></span>"</pre><p>Load the file to the cluster.</p><pre class="screen">crm configure load update crm-vip.txt</pre></div></div><br class="example-break" /><p>In most installations, only the parameter <span class="strong"><strong>ip</strong></span> needs to be set to the virtual
IP address to be presented to the client systems.
Use the command <code class="literal">man ocf_heartbeat_IPAddr2</code> for details on additional parameters.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-constraints"></a>Constraints</h4></div></div></div><p>The constraints are organizing the correct placement of the virtual IP
address for the client database access and the start order between the two
resource agents SAPHana and SAPHanaTopology. The rules help to remove false
positive messages from the <span class="emphasis"><em>crm_mon</em></span> command.</p><div class="example"><a id="id2614"></a><p class="title"><strong>Example 33. Configure needed constraints</strong></p><div class="example-contents"><pre class="screen">vi crm-cs.txt</pre><p>Enter the following to <span class="emphasis"><em>crm-cs.txt</em></span>:</p><pre class="screen">colocation col_saphana_ip_&lt;SID&gt;_HDB&lt;Inst&gt; 2000: rsc_ip_&lt;SID&gt;_HDB&lt;Inst&gt;:Started \
    msl_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt;:Master

order ord_SAPHana_&lt;SID&gt;_HDB&lt;Inst&gt; Optional: cln_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; \
    msl_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt;

location SAPHanaCon_not_on_majority_maker msl_SAPHanaCon_&lt;SID&gt;_HDB&lt;Inst&gt; -inf: &lt;majority maker&gt;
location SAPHanaTop_not_on_majority_maker cln_SAPHanaTop_&lt;SID&gt;_HDB&lt;Inst&gt; -inf: &lt;majority maker&gt;</pre><pre class="screen">colocation col_saphana_ip_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> 2000: rsc_ip_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span>:Started \
    msl_SAPHanaCon_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span>:Master

order ord_SAPHana_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> Optional: cln_SAPHanaTop_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> \
    msl_SAPHanaCon_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span>

location SAPHanaCon_not_on_majority_maker msl_SAPHanaCon_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> -inf: <span class="strong"><strong>suse-mm</strong></span>
location SAPHanaTop_not_on_majority_maker cln_SAPHanaTop_<span class="strong"><strong>HA1</strong></span>_HDB<span class="strong"><strong>00</strong></span> -inf: <span class="strong"><strong>suse-mm</strong></span></pre><p>Load the file to the cluster.</p><pre class="screen">configure load update crm-cs.txt</pre></div></div><br class="example-break" /></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-final-steps"></a>Final Steps</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-verifying-the-communication-between-the-hook-and-the-cluster"></a>Verifying the communication between the hook and the cluster</h4></div></div></div><p>Now check if the HA/DR provider could set the appropriate
cluster attribute hana_&lt;sid&gt;_glob_srHook:</p><div class="example"><a id="id2646"></a><p class="title"><strong>Example 34. Query the srHook cluster attribute</strong></p><div class="example-contents"><pre class="screen">crm_attribute -G  -n hana_&lt;sid&gt;_glob_srHook</pre><p>You should get an output similar to the following:</p><pre class="screen">scope=crm_config  name=hana_&lt;sid&gt;_glob_srHook value=SFAIL</pre></div></div><br class="example-break" /><p>In this case the HA/DR provider sets the attribute to SFAIL to inform the
cluster about a broken system replication.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-using-special-virtual-host-names-or-fqhn-during-the-installation-of-sap-hana"></a>Using special virtual host names or FQHN during the installation of SAP HANA</h4></div></div></div><p>If you have used special virtual host names or the fully qualified host name
(FQHN) instead of the short node name, the resource agents need to map these
names. To be able to match the short node name with the used SAP 'virtual
host name', the saphostagent needs to report the list of installed instances
correctly:</p><div class="example"><a id="id2655"></a><p class="title"><strong>Example 35. In the setup at hand the virtual host name matches the node name</strong></p><div class="example-contents"><pre class="screen"><span class="strong"><strong>suse01</strong></span>:ha1adm&gt; /usr/sap/hostctrl/exe/saphostctrl -function ListInstances
 Inst Info : HA1 - 00 - <span class="strong"><strong>suse01</strong></span> - 749, patch 418, changelist 1816226</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-ending-the-cluster-maintenance-mode"></a>Ending the cluster maintenance mode</h4></div></div></div><p>After all changes, as last step end the cluster maintenance mode.</p><pre class="screen">crm configure property maintenance-mode=false</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-testing-the-cluster"></a>Testing the cluster</h2></div></div></div><p><a id="Testing"></a>Testing is one of the most important project tasks for implementing clusters.
Proper testing is crucial. Make sure that all test cases
derived from project or customer expectations are defined and passed completely.
<span class="strong"><strong>Without testing the project is likely to fail in production use</strong></span>.</p><div class="figure"><a id="id2669"></a><p class="title"><strong>Figure 13. <a class="xref" href="#Planning">[Planning]</a> <a class="xref" href="#OsSetup">[OsSetup]</a> <a class="xref" href="#SAPHanaInst">[SAPHanaInst]</a> <a class="xref" href="#SAPHanaHsr">[SAPHanaHsr]</a> <a class="xref" href="#Integration">[Integration]</a> <a class="xref" href="#Cluster">[Cluster]</a> Testing</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="100%"><tr><td><img src="images/SAPHanaSR-ScaleOut-Plan-Phase7.svg" width="100%" alt="SAPHanaSR ScaleOut Plan Phase7" /></td></tr></table></div></div></div><br class="figure-break" /><p>The test prerequisite, if not described differently, is always that all cluster
nodes are booted, are already normal members of the cluster and the SAP HANA RDBMS
is running. The system replication is in state <span class="strong"><strong>SYNC</strong></span> represented by 'SOK'.
The cluster is idle, no actions are pending, no migration constraints left over, no failcounts left over.</p><p>In the current version of this setup guide a plain list of test cases is provided. A more detailed description of the
test cases is planned for future versions. These details will be provided either in an updated version of this guide
or the test cases will be extracted to a separate test plan document.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-generic-cluster-tests"></a>Generic cluster tests</h3></div></div></div><p>The cluster tests described in this section cover the cluster reaction during operations. This includes starting and stopping
the complete cluster or simulating SBD failures and much more.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Parallel start of all cluster nodes (<code class="literal">systemctl start pacemaker</code> should be done in a short time frame).</p></li><li class="listitem"><p>Stop of the complete cluster.</p></li><li class="listitem"><p>Isolate ONE of the two SAP HANA sites.</p></li><li class="listitem"><p>Power-off the majority maker.</p></li><li class="listitem"><p>Isolate the SBD.</p></li><li class="listitem"><p>Simulate a maintenance procedure with cluster continuously running.</p></li><li class="listitem"><p>Simulate a maintenance procedure with cluster restart.</p></li><li class="listitem"><p>Kill the corosync process of one of the cluster nodes.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-tests-on-the-primary-site"></a>Tests on the primary site</h3></div></div></div><p>The tests described in this section are checking the reaction on several failures of the primary site.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-tests-regarding-cluster-nodes-of-the-primary-site"></a>Tests regarding cluster nodes of the primary site</h4></div></div></div><p>The tests listed here check the SAP HANA and cluster reaction if one or more nodes of the primary site are failing or
re-joining the cluster.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Power-off master name server of the primary. The test assumes that there is still an SAP HANA standby instance.</p></li><li class="listitem"><p>Power-off master name server of the primary after all standby instances are already in use.</p></li><li class="listitem"><p>Power-off any worker node but not the master name server of the primary. The test assumes that there is still an SAP HANA standby instance.</p></li><li class="listitem"><p>Power-off any worker node but not the master name server of the primary after all standby instances are already in use.</p></li><li class="listitem"><p>Power-off any standby node of the primary.</p></li><li class="listitem"><p>Re-join of a previously power-off cluster node.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-tests-regarding-the-complete-primary-site"></a>Tests regarding the complete primary site</h4></div></div></div><p>This test category is simulating a complete site failure.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Power-off all nodes of the primary site in parallel.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-tests-regarding-the-sap-hana-instances-of-the-primary-site"></a>Tests regarding the SAP HANA instances of the primary site</h4></div></div></div><p>The tests listed here are checks about the SAP HANA and cluster reactions triggered by application failures such as a crashed SAP HANA instance.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Kill the SAP HANA instance of the master name server of the primary. The test assumes that there is still an SAP HANA standby instance.</p></li><li class="listitem"><p>Kill the SAP HANA instance of the master name server of the primary after all standby instances are already in use.</p></li><li class="listitem"><p>Kill the SAP HANA instance of any worker node but not the master name server of the primary. The test assumes that there is still an SAP HANA standby instance.</p></li><li class="listitem"><p>Kill the SAP HANA instance of any worker node but not the master name server of the primary after all standby instances are already in use.</p></li><li class="listitem"><p>Kill the SAP HANA instance of any standby node.</p></li><li class="listitem"><p>Kill sapstartsrv of any SAP HANA instance of the primary.</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-tests-on-the-secondary-site"></a>Tests on the secondary site</h3></div></div></div><p>The tests described in this section are checking the reaction on several failures of the secondary site.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-tests-regarding-cluster-nodes-of-the-secondary-site"></a>Tests regarding cluster nodes of the secondary site</h4></div></div></div><p>The tests listed here check the SAP HANA and cluster reaction if one or more nodes of the secondary site are failing or
re-joining the cluster.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Power-off master name server of the secondary. The test assumes that there is still an SAP HANA standby instance.</p></li><li class="listitem"><p>Power-off master name server of the secondary after all standby instances are already in use.</p></li><li class="listitem"><p>Power-off any worker node but not the master name server of the secondary. The test assumes that there is still an SAP HANA standby instance.</p></li><li class="listitem"><p>Power-off any worker node but not the master name server of the secondary after all standby instances are already in use.</p></li><li class="listitem"><p>Power-off any standby node of the secondary.</p></li><li class="listitem"><p>Re-join of a previously power-off cluster node.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-tests-regarding-the-complete-secondary-site"></a>Tests regarding the complete secondary site</h4></div></div></div><p>This test category is simulating a complete site failure.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Power-off all nodes of the secondary site in parallel.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-tests-regarding-the-sap-hana-instances-of-the-secondary-site"></a>Tests regarding the SAP HANA instances of the secondary site</h4></div></div></div><p>The tests listed here are checks about the SAP HANA and cluster reactions triggered by application failures such as a crashed SAP HANA instance.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Kill the SAP HANA instance of the master name server of the secondary. The test assumes that there is still an SAP HANA standby instance.</p></li><li class="listitem"><p>Kill the SAP HANA instance of the master name server of the secondary after all standby instances are already in use.</p></li><li class="listitem"><p>Kill the SAP HANA instance of any worker node but not the master name server of the secondary. The test assumes that there is still an SAP HANA standby instance.</p></li><li class="listitem"><p>Kill the SAP HANA instance of any worker node but not the master name server of the secondary after all standby instances are already in use.</p></li><li class="listitem"><p>Kill the SAP HANA instance of any standby node.</p></li><li class="listitem"><p>Kill <span class="emphasis"><em>sapstartsrv</em></span> of any SAP HANA instance of the secondary.</p></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-administration"></a>Administration</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-dos-and-donts"></a>Dos and don’ts</h3></div></div></div><p>In your project, you should <span class="strong"><strong>do</strong></span> the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Define (and test) STONITH <span class="strong"><strong>before</strong></span> adding other resources to the cluster.</p></li><li class="listitem"><p>Do <span class="strong"><strong>intensive</strong></span> testing.</p></li><li class="listitem"><p><span class="strong"><strong>Tune</strong></span> the timeouts of operations of SAPHanaController and SAPHanaTopology.</p></li><li class="listitem"><p>Start with <span class="strong"><strong> PREFER_SITE_TAKEOVER=true</strong></span>, <span class="strong"><strong>AUTOMATED_REGISTER=false</strong></span> and
<span class="strong"><strong>DUPLICATE_PRIMARY_TIMEOUT=”7200”</strong></span>.</p></li><li class="listitem"><p>Always make sure that the cluster configuration does not contain any left-over
client-prefer location constraints or failcounts.</p></li><li class="listitem"><p>Before testing or beginning maintenance procedures, check if the cluster is
in idle state.</p></li></ul></div><p>In your project, <span class="strong"><strong>avoid</strong></span> the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Rapidly changing/changing back cluster configuration, such as: Setting nodes
to standby and online again or stopping/starting the master/slave resource.</p></li><li class="listitem"><p>Creating a cluster without proper time synchronization or unstable name
resolutions for hosts, users, and groups.</p></li><li class="listitem"><p>Adding location rules for the clone, master/slave or IP resource. Only
location rules mentioned in this setup guide are allowed.</p></li><li class="listitem"><p>As "migrating" or "moving" resources in <span class="emphasis"><em>crm-shell</em></span>, HAWK or other tools would
add client-prefer location rules, these activities are completely <span class="strong"><strong>forbidden!</strong></span>.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-monitoring-and-tools"></a>Monitoring and tools</h3></div></div></div><p>You can use the High Availability Web Konsole (HAWK), SAP HANA Studio and
different command line tools for cluster status requests.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-hawk-cluster-status-and-more"></a>HAWK – cluster status and more</h4></div></div></div><p>You can use an Internet browser to check the cluster status. Use the following URL:
<a class="link" href="https://&lt;node&gt;:7630" target="_top">https://&lt;node&gt;:7630</a></p><p>The login credentials are provided during the installation dialog of <span class="emphasis"><em>ha-cluster-init</em></span>. Keep in mind to
change the default password of the Linux user <span class="emphasis"><em>hacluster</em></span> .</p><div class="figure"><a id="id2837"></a><p class="title"><strong>Figure 14. Cluster Status in Hawk</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="95%"><tr><td><img src="images/cluster_status_hawk_1.png" width="100%" alt="cluster status hawk 1" /></td></tr></table></div></div></div><br class="figure-break" /><p>If you set up the cluster using <span class="emphasis"><em>ha-cluster-init</em></span> and you have installed all
packages as described above, your system will provide a very useful Web
interface. You can use this graphical Web interface to get an overview of the
complete cluster status, perform administrative tasks or even configure resources
and cluster bootstrap parameters.</p><p>Read the product manuals for a complete documentation of this powerful user
interface.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-sap-hana-studio"></a>SAP HANA Studio</h4></div></div></div><p>Database-specific administration and checks can be done with SAP HANA Cockpit.</p><div class="figure"><a id="id2850"></a><p class="title"><strong>Figure 15. SAP HANA Studio – Landscape of a scale-out system</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="95%"><tr><td><img src="images/hana_studio_landscape.png" width="100%" alt="hana studio landscape" /></td></tr></table></div></div></div><br class="figure-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Be extremely careful with changing any parameter or the topology of the
system replication. This might cause an interference with the cluster resource management.</p></div><p>A positive example is to register a former primary as new secondary and you have
set <span class="emphasis"><em>AUTOMATED_REGISTER=false</em></span>.</p><p>A negative example is to un-register a secondary,
disable the system replication on the primary, and similar actions.</p><p>For all actions that change the system replication it is recommended to first check
for the maintenance procedure.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-cluster-command-line-tools"></a>Cluster command line tools</h4></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">crm_mon</span></dt><dd><p>A simple overview can be obtained by calling <span class="emphasis"><em>crm_mon</em></span>. Using the option <span class="emphasis"><em>-r</em></span> shows
also stopped but already configured resources. Option <span class="emphasis"><em>-1</em></span> tells <span class="emphasis"><em>crm_mon</em></span> to
output the status once instead of periodically.</p></dd></dl></div><pre class="screen">Stack: corosync
Current DC: suse05 (version 1.1.16-4.8-77ea74d) - partition with quorum
Last updated: Mon Jun 11 16:55:04 2018
Last change: Mon Jun 11 16:53:58 2018 by root via crm_attribute on suse02

7 nodes configured
16 resources configured

Online: [ suse-mm suse01 suse02 suse03 suse04 suse05 suse06 ]

Full list of resources:

stonith-sbd     (stonith:external/sbd): Started suse-mm
rsc_ip_HA1_HDB00        (ocf::heartbeat:IPaddr2):       Started suse02
 Master/Slave Set: msl_SAPHanaCon_HA1_HDB00 [rsc_SAPHanaCon_HA1_HDB00]
     Masters: [ suse02 ]
     Slaves: [ suse01 suse03 suse04 suse05 suse06 ]
     Stopped: [ suse-mm ]
 Clone Set: cln_SAPHanaTop_HA1_HDB00 [rsc_SAPHanaTop_HA1_HDB00]
     Started: [ suse01 suse02 suse03 suse04 suse05 suse06 ]
     Stopped: [ suse-mm ]</pre><p>See the manual page <span class="emphasis"><em>crm_mon(8)</em></span> for details.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">SAPHanaSR-showAttr</span></dt><dd><p>To show some SAPHanaController and SAPHanaTopology resource agent
internal values, you can call the program <span class="emphasis"><em>SAPHanaSR-showAttr</em></span>. The internal
values, storage location and their parameter names may change in the next versions.
The command <span class="emphasis"><em>SAPHanaSR-showAttr</em></span> will always fetch the values from the correct
storage location.</p></dd></dl></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>Do <span class="strong"><strong>not</strong></span> use cluster commands like <span class="emphasis"><em>crm_attribute</em></span> to fetch the values directly
from the cluster. Your methods will be broken, when you
need to move an attribute to a different storage location or even out of the cluster.
<span class="emphasis"><em>SAPHanaSR-showAttr</em></span> is firstly a test program only and should not be used for
automated system monitoring.</p></div><div class="example"><a id="id2889"></a><p class="title"><strong>Example 36. Check SAPHanaSR-showAttr as user root</strong></p><div class="example-contents"><pre class="screen">suse-mm:~ # SAPHanaSR-showAttr --sid=&lt;SID&gt;</pre><p>The tool displays all interesting cluster attributes in three areas.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <span class="strong"><strong>global</strong></span> section includes the information about the cib time stamp and
the attributes covering the status of the system replication</p></li><li class="listitem"><p>The <span class="strong"><strong>site</strong></span> section includes the attributes per site and shows which site is
the primary and the return code of the <span class="emphasis"><em>landscapeHostConfiguration.py</em></span>
script. In addition the active master name server is shown per site.</p></li><li class="listitem"><p>The <span class="strong"><strong>hosts</strong></span> section includes the node status, the roles of the host inside the
SAP HANA database, the calculated score to get the primary master name server and
the site name the host belongs to.</p></li></ul></div><pre class="screen">Global cib-time                 prim sec  srHook sync_state
------------------------------------------------------------
global Tue Jun 12 15:02:58 2018 WDF1 ROT1 SOK    SOK


Site lpt        lss mns    srr
-------------------------------
WDF1 1528808568 4   suse02 P
ROT1 30         4   suse01 S


Hosts   clone_state node_state roles                        score site
-----------------------------------------------------------------------
suse-mm online
suse01  DEMOTED     online     master1:master:worker:master 100 ROT1
suse02  PROMOTED    online     master1:master:worker:master 150 WDF1
suse03  DEMOTED     online     master3:slave:worker:slave   80  ROT1
suse04  DEMOTED     online     master2:slave:worker:slave   110 WDF1
suse05  DEMOTED     online     master2:slave:worker:slave   80  ROT1
suse06  DEMOTED     online     master3:slave:worker:slave   110 WDF1</pre></div></div><br class="example-break" /><p>The majority maker <span class="emphasis"><em>suse-mm</em></span> does not run an SAP HANA instance and therefore
neither has a role attribute nor a score or site value.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-sap-hana-landscapehostconfiguration"></a>SAP HANA LandscapeHostConfiguration</h4></div></div></div><p>To check the status of an SAP HANA database and to figure out if the cluster
should react, you can use the script <code class="literal">landscapeHostConfiguration.py</code>.</p><div class="example"><a id="id2911"></a><p class="title"><strong>Example 37. Check the landscape status as user &lt;sid&gt;adm</strong></p><div class="example-contents"><pre class="screen">HDBSettings.sh landscapeHostConfiguration.py</pre><p>The landscape host configuration is shown with a line per SAP HANA host.</p><pre class="screen"> | Host   | Host   | ... NameServer  | NameServer  | IndexServer | IndexServer |
 |        | Active | ... Config Role | Actual Role | Config Role | Actual Role |
 | ------ | ------ | ... ----------- | ----------- | ----------- | ----------- |
 | suse01 | yes    | ... master 1    | master      | worker      | master      |
 | suse03 | yes    | ... master 2    | slave       | worker      | slave       |
 | suse05 | yes    | ... master 3    | slave       | standby     | standby     |

 overall host status: ok</pre></div></div><br class="example-break" /><p>Following the SAP HA guideline, the <span class="emphasis"><em>SAPHana</em></span> resource agent interprets the
return codes in the following way:</p><div class="table"><a id="id2918"></a><p class="title"><strong>Table 3. Table Interpretation of Return Codes</strong></p><div class="table-contents"><table class="table" summary="Table Interpretation of Return Codes" border="1"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th align="left" valign="top">Return Code</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>4</p></td><td align="left" valign="top"><p>SAP HANA database is up and OK. The cluster does interpret this as correctly
running database.</p></td></tr><tr><td align="left" valign="top"><p>3</p></td><td align="left" valign="top"><p>SAP HANA database is up and in status INFO. The cluster does interpret this as
a correctly running database.</p></td></tr><tr><td align="left" valign="top"><p>2</p></td><td align="left" valign="top"><p>SAP HANA database is up and in status warning. The cluster does interpret this
as a correctly running database.</p></td></tr><tr><td align="left" valign="top"><p>1</p></td><td align="left" valign="top"><p>SAP HANA database is down. If the database should be up and is not own by
intention, this could trigger a takeover.</p></td></tr><tr><td align="left" valign="top"><p>0</p></td><td align="left" valign="top"><p>Internal Script Error – to be ignored.</p></td></tr></tbody></table></div></div><br class="table-break" /></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-useful-links-manuals-and-sap-notes"></a>Useful links, manuals, and SAP Notes</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-suse-best-practices-and-more"></a>SUSE Best Practices and more</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">Best Practices for SUSE Linux Enterprise Server for SAP Applications 12</span></dt><dd><p><a class="link" href="https://documentation.suse.com/sbp/sap/" target="_top">https://documentation.suse.com/sbp/sap/</a></p></dd><dt><span class="term">SAP blog article</span></dt><dd><p><a class="link" href="http://scn.sap.com/community/hana-in-memory/blog/2014/04/04/fail-safe-operation-of-sap-hana-suse-extends-its-high-availability-solution" target="_top">Fail-Safe Operation of SAP HANA*: SUSE Extends Its High-Availability Solution</a></p></dd><dt><span class="term">SAP Community Wiki article</span></dt><dd><p><a class="link" href="http://scn.sap.com/docs/DOC-65899" target="_top">HOW TO SET UP SAPHanaSR IN THE COST OPTIMIZED SAP HANA SR SCENARIO</a></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-suse-product-documentation"></a>SUSE product documentation</h3></div></div></div><p>The SUSE product manuals and documentation can be downloaded at <a class="link" href="https://documentation.suse.com/" target="_top">https://documentation.suse.com/</a>.</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Current online documentation of SUSE Linux Enterprise Server for SAP Applications</span></dt><dd><p><a class="link" href="https://documentation.suse.com/sles-sap/12-SP5/" target="_top">https://documentation.suse.com/sles-sap/12-SP5/</a></p></dd><dt><span class="term">Current online documentation of SUSE Linux Enterprise High Availability</span></dt><dd><p><a class="link" href="https://documentation.suse.com/sle-ha/12-SP5/" target="_top">https://documentation.suse.com/sle-ha/12-SP5/</a></p></dd><dt><span class="term">Tuning guide for SUSE Linux Enterprise Server</span></dt><dd><p><a class="link" href="https://documentation.suse.com/sles/12-SP5/html/SLES-all/book-sle-tuning.html" target="_top">https://documentation.suse.com/sles/12-SP5/html/SLES-all/book-sle-tuning.html</a></p></dd><dt><span class="term">Storage admin guide for SUSE Linux Enterprise Server</span></dt><dd><p><a class="link" href="https://documentation.suse.com/sles/12-SP5/html/SLES-all/stor-admin.html" target="_top">https://documentation.suse.com/sles/12-SP5/html/SLES-all/stor-admin.html</a></p></dd><dt><span class="term">Release notes</span></dt><dd><p><a class="link" href="https://www.suse.com/releasenotes/" target="_top">https://www.suse.com/releasenotes/</a></p></dd><dt><span class="term">TID multipath system unable to boot after installing dracut-037-98.2.x86_64</span></dt><dd><p><a class="link" href="https://www.suse.com/support/kb/doc/?id=7020912" target="_top">https://www.suse.com/support/kb/doc/?id=7020912</a></p></dd><dt><span class="term">TID Systemd-udev-settle timing out</span></dt><dd><p><a class="link" href="https://www.suse.com/support/kb/doc/?id=7022681" target="_top">https://www.suse.com/support/kb/doc/?id=7022681</a></p></dd><dt><span class="term">TID How to load the correct watchdog kernel module</span></dt><dd><p><a class="link" href="http://www.suse.com/support/kb/doc.php?id=7016880" target="_top">http://www.suse.com/support/kb/doc.php?id=7016880</a></p></dd><dt><span class="term">TID rpcbind won’t start after upgrade from SLES 11 to SLES 12</span></dt><dd><p><a class="link" href="https://www.suse.com/support/kb/doc/?id=7017144" target="_top">https://www.suse.com/support/kb/doc/?id=7017144</a></p></dd></dl></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">TID Memory, I/O and DefaultTasksMax related considerations for SLES for SAP servers with huge memory</span></dt><dd><p><a class="link" href="https://www.suse.com/support/kb/doc/?id=7021211" target="_top">https://www.suse.com/support/kb/doc/?id=7021211</a></p></dd><dt><span class="term">TID XFS metadata corruption and invalid checksum on SAP Hana servers</span></dt><dd><p><a class="link" href="https://www.suse.com/support/kb/doc/?id=7022921" target="_top">https://www.suse.com/support/kb/doc/?id=7022921</a></p></dd><dt><span class="term">SUSE Linux Enterprise Server technical information</span></dt><dd><p><a class="link" href="https://www.suse.com/products/server/technical-information/" target="_top">https://www.suse.com/products/server/technical-information/</a></p></dd><dt><span class="term">XFS file system</span></dt><dd><p><a class="link" href="https://www.suse.com/communities/conversations/xfs-the-file-system-of-choice/" target="_top">https://www.suse.com/communities/conversations/xfs-the-file-system-of-choice/</a></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-sap-product-documentation"></a>SAP product documentation</h3></div></div></div><div class="variablelist"><dl class="variablelist"><dt><span class="term">SAP HANA Installation and Update Guide</span></dt><dd><p><a class="link" href="http://help.sap.com/hana/SAP_HANA_Server_Installation_Guide_en.pdf" target="_top">http://help.sap.com/hana/SAP_HANA_Server_Installation_Guide_en.pdf</a></p></dd><dt><span class="term">SAP HANA Administration Guide</span></dt><dd><p><a class="link" href="http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf" target="_top">http://help.sap.com/hana/SAP_HANA_Administration_Guide_en.pdf</a></p></dd></dl></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-sap-notes"></a>SAP Notes</h3></div></div></div><p>As SAP Notes are changing over time, this list is only a starting point</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>611361 Hostnames of SAP ABAP Platform servers</p></li><li class="listitem"><p>1275776 Preparing SLES for SAP Environments</p></li><li class="listitem"><p>1514967 SAP HANA: Central Note</p></li><li class="listitem"><p>1523337 SAP In-Memory Database 1.0: Central Note</p></li><li class="listitem"><p>1501701 Single Computing Unit Performance and Sizing</p></li><li class="listitem"><p>1824819 SAP HANA DB: Recommended OS settings for SLES 11 / SLES for SAP Applications 11 SP4</p></li><li class="listitem"><p>1846872 "No space left on device" error reported from HANA</p></li><li class="listitem"><p>1855805 Recommended SLES 11 packages for HANA support on OS level</p></li><li class="listitem"><p>1867783 XFS Data Inconsistency Bug with SLES 11 SP2</p></li><li class="listitem"><p>1876398 Network configuration for System Replication in HANA SP6</p></li><li class="listitem"><p>1888072 SAP HANA DB: Indexserver crash in strcmp sse42</p></li><li class="listitem"><p>1890444 Slow HANA system due to CPU power save mode</p></li><li class="listitem"><p>1944799 SAP HANA Guidelines for SLES Operating System Installation</p></li><li class="listitem"><p>1954788 SAP HANA DB: Recommended OS settings for SLES 11 / SLES for SAP Applications 11 SP3</p></li><li class="listitem"><p>1984787 SUSE LINUX Enterprise Server 12: Installation notes and</p></li><li class="listitem"><p>1999993 How-To: Interpreting SAP HANA Mini Check Results</p></li><li class="listitem"><p>2000000 FAQ: SAP HANA Performance Optimization</p></li><li class="listitem"><p>2100040 FAQ: SAP HANA CPU</p></li><li class="listitem"><p>2205917 SAP HANA DB: Recommended OS settings for SLES 12 / SLES for SAP Applications 12.</p></li><li class="listitem"><p>2380229 SAP HANA Platform 2.0 – Central Note</p></li><li class="listitem"><p>2470289 FAQ: SAP HANA Non-Uniform Memory Access (NUMA)</p></li><li class="listitem"><p>2647673 HANA Installation Failure</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-legal-notice"></a>Legal notice</h2></div></div></div><p>Copyright © 2006–2022 SUSE LLC and contributors. All rights reserved.</p><p>Permission is granted to copy, distribute and/or modify this document under the terms of
the GNU Free Documentation License, Version 1.2 or (at your option) version 1.3; with the
Invariant Section being this copyright notice and license. A copy of the license version 1.2
is included in the section entitled "GNU Free Documentation License".</p><p>SUSE, the SUSE logo and YaST are registered trademarks of SUSE LLC in the United States
and other countries. For SUSE trademarks, see <a class="link" href="https://www.suse.com/company/legal/" target="_top">https://www.suse.com/company/legal/</a>.</p><p>Linux is a registered trademark of Linus Torvalds. All other names or trademarks mentioned in
this document may be trademarks or registered trademarks of their respective owners.</p><p>Documents published as part of the SUSE Best Practices series have been contributed voluntarily
by SUSE employees and third parties. They are meant to serve as examples of how particular
actions can be performed. They have been compiled with utmost attention to detail.
However, this does not guarantee complete accuracy. SUSE cannot verify that actions described
in these documents do what is claimed or whether actions described have unintended consequences.
SUSE LLC, its affiliates, the authors, and the translators may not be held liable for possible errors
or the consequences thereof.</p><p>Below we draw your attention to the license under which the articles are published.</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-gnu-free-documentation-license"></a>GNU Free Documentation License</h2></div></div></div><p>Copyright © 2000, 2001, 2002 Free Software Foundation, Inc.
51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</p><h3><a id="id-0-preamble"></a>0. PREAMBLE</h3><p>The purpose of this License is to make a manual, textbook, or other functional and useful document "free" in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</p><p>This License is a kind of "copyleft", which means that derivative works of the document must themselves be free in the same sense.
It complements the GNU General Public License, which is a copyleft license designed for free software.</p><p>We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does.
But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book.
We recommend this License principally for works whose purpose is instruction or reference.</p><h3><a id="id-1-applicability-and-definitions"></a>1. APPLICABILITY AND DEFINITIONS</h3><p>This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License.
Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein.
The "Document", below, refers to any such manual or work.
Any member of the public is a licensee, and is addressed as "you". You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.</p><p>A "Modified Version" of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</p><p>A "Secondary Section" is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document’s overall subject (or to related matters) and contains nothing that could fall directly within that overall subject.
(Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</p><p>The "Invariant Sections" are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License.
If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant.
The Document may contain zero Invariant Sections.
If the Document does not identify any Invariant Sections then there are none.</p><p>The "Cover Texts" are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License.
A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.</p><p>A "Transparent" copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters.
A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent.
An image format is not Transparent if used for any substantial amount of text.
A copy that is not "Transparent" is called "Opaque".</p><p>Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification.
Examples of transparent image formats include PNG, XCF and JPG.
Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.</p><p>The "Title Page" means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page.
For works in formats which do not have any title page as such, "Title Page" means the text near the most prominent appearance of the work’s title, preceding the beginning of the body of the text.</p><p>A section "Entitled XYZ" means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language.
(Here XYZ stands for a specific section name mentioned below, such as "Acknowledgements", "Dedications", "Endorsements", or "History".) To "Preserve the Title" of such a section when you modify the Document means that it remains a section "Entitled XYZ" according to this definition.</p><p>The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document.
These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.</p><h3><a id="id-2-verbatim-copying"></a>2. VERBATIM COPYING</h3><p>You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License.
You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute.
However, you may accept compensation in exchange for copies.
If you distribute a large enough number of copies you must also follow the conditions in section 3.</p><p>You may also lend copies, under the same conditions stated above, and you may publicly display copies.</p><h3><a id="id-3-copying-in-quantity"></a>3. COPYING IN QUANTITY</h3><p>If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document’s license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover.
Both covers must also clearly and legibly identify you as the publisher of these copies.
The front cover must present the full title with all words of the title equally prominent and visible.
You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</p><p>If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</p><p>If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material.
If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</p><p>It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</p><h3><a id="id-4-modifications"></a>4. MODIFICATIONS</h3><p>You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it.
In addition, you must do these things in the Modified Version:</p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</p></li><li class="listitem"><p>List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.</p></li><li class="listitem"><p>State on the Title page the name of the publisher of the Modified Version, as the publisher.</p></li><li class="listitem"><p>Preserve all the copyright notices of the Document.</p></li><li class="listitem"><p>Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</p></li><li class="listitem"><p>Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</p></li><li class="listitem"><p>Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document’s license notice.</p></li><li class="listitem"><p>Include an unaltered copy of this License.</p></li><li class="listitem"><p>Preserve the section Entitled "History", Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled "History" in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</p></li><li class="listitem"><p>Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the "History" section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</p></li><li class="listitem"><p>For any section Entitled "Acknowledgements" or "Dedications", Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</p></li><li class="listitem"><p>Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</p></li><li class="listitem"><p>Delete any section Entitled "Endorsements". Such a section may not be included in the Modified Version.</p></li><li class="listitem"><p>Do not retitle any existing section to be Entitled "Endorsements" or to conflict in title with any Invariant Section.</p></li><li class="listitem"><p>Preserve any Warranty Disclaimers.</p></li></ol></div><p>If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant.
To do this, add their titles to the list of Invariant Sections in the Modified Version’s license notice.
These titles must be distinct from any other section titles.</p><p>You may add a section Entitled "Endorsements", provided it contains nothing but endorsements of your Modified Version by various parties—​for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</p><p>You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version.
Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity.
If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</p><p>The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</p><h3><a id="id-5-combining-documents"></a>5. COMBINING DOCUMENTS</h3><p>You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.</p><p>The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy.
If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</p><p>In the combination, you must combine any sections Entitled "History" in the various original documents, forming one section Entitled "History"; likewise combine any sections Entitled "Acknowledgements", and any sections Entitled "Dedications". You must delete all sections Entitled "Endorsements".</p><h3><a id="id-6-collections-of-documents"></a>6. COLLECTIONS OF DOCUMENTS</h3><p>You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</p><p>You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</p><h3><a id="id-7-aggregation-with-independent-works"></a>7. AGGREGATION WITH INDEPENDENT WORKS</h3><p>A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an "aggregate" if the copyright resulting from the compilation is not used to limit the legal rights of the compilation’s users beyond what the individual works permit.
When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.</p><p>If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document’s Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form.
Otherwise they must appear on printed covers that bracket the whole aggregate.</p><h2><a id="id-8-translation"></a>8. TRANSLATION</h2><p>Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections.
You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers.
In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.</p><p>If a section in the Document is Entitled "Acknowledgements", "Dedications", or "History", the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.</p><h3><a id="id-9-termination"></a>9. TERMINATION</h3><p>You may not copy, modify, sublicense, or distribute the Document except as expressly provided for under this License.
Any other attempt to copy, modify, sublicense or distribute the Document is void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under this License will not have their licenses terminated so long as such parties remain in full compliance.</p><h3><a id="id-10-future-revisions-of-this-license"></a>10. FUTURE REVISIONS OF THIS LICENSE</h3><p>The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time.
Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns.
See <a class="link" href="http://www.gnu.org/copyleft/" target="_top">http://www.gnu.org/copyleft/</a>.</p><p>Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this License "or any later version" applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation.
If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation.</p><h3><a id="id-addendum-how-to-use-this-license-for-your-documents"></a>ADDENDUM: How to use this License for your documents</h3><pre class="screen">Copyright (c) YEAR YOUR NAME.
   Permission is granted to copy, distribute and/or modify this document
   under the terms of the GNU Free Documentation License, Version 1.2
   or any later version published by the Free Software Foundation;
   with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
   A copy of the license is included in the section entitled “GNU
   Free Documentation License”.</pre><p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts, replace the “
with…​Texts.”
line with this:</p><pre class="screen">with the Invariant Sections being LIST THEIR TITLES, with the
   Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</pre><p>If you have Invariant Sections without Cover Texts, or some other combination of the three, merge those two alternatives to suit the situation.</p><p>If your document contains nontrivial examples of program code, we recommend releasing these examples in parallel under your choice of free software license, such as the GNU General Public License, to permit their use in free software.</p></div></div></body></html>