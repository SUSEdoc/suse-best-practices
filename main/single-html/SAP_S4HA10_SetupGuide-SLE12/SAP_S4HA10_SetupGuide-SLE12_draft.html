<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - Setup Guide</title><meta name="generator" content="DocBook XSL Stylesheets V1.79.2" /><meta name="description" content="SUSE® Linux Enterprise Server for SAP Applications is optimized in various ways for SAP* applications. This document explains how to deploy an S/4 HANA Enqueue Replication 2 High Availability Cluster solution. It is based on SUSE Linux Enterprise Server for SAP Applications 12 and related service packs. Disclaimer: Documents published as part of the SUSE Best Practices series have been contributed voluntarily by SUSE employees and third parties. They are meant to serve as examples of how particular actions can be performed. They have been compiled with utmost attention to detail. However, this does not guarantee complete accuracy. SUSE cannot verify that actions described in these documents do what is claimed or whether actions described have unintended consequences. SUSE LLC, its affiliates, the authors, and the translators may not be held liable for possible errors or the consequences thereof." /><style type="text/css">
body { background-image: url('static/images/draft.png');
       background-repeat: no-repeat;
       background-position: top left;
       /* The following properties make the watermark "fixed" on the page. */
       /* I think that's just a bit too distracting for the reader... */
       /* background-attachment: fixed; */
       /* background-position: center center; */
     }</style></head><body onload="$('#betawarn-button-wrap').toggle();if (document.cookie.length > 0) {if (document.cookie.indexOf('betawarn=closed') != -1){$('#betawarn').toggle()}};"><div id="betawarn" style="position:fixed;bottom:0;z-index:9025;background-color:#FDE8E8;padding:1em;margin-left:10%;margin-right:10%;display:block;border-top:.75em solid #E11;width:80%"><p style="color:#333;margin:1em 0;padding:0;">This is a draft document that was built and uploaded automatically. It may document beta software and be incomplete or even incorrect. <strong>Use this document at your own risk.</strong></p> <div id="betawarn-button-wrap" style="display:none;margin:0;padding:0;"><a href="#" onclick="$('#betawarn').toggle();var d=new Date();d.setTime(d.getTime()+(0.5*24*60*60*1000));document.cookie='betawarn=closed; expires='+d.toUTCString()+'; path=/'; return false;" style="color:#333;text-decoration:underline;float:left;margin-top:.5em;padding:1em;display:block;background-color:#FABEBE;">I understand this is a draft</a></div></div><div xml:lang="en" class="article" lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="id1337"></a>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - Setup Guide</h2></div><div><div class="author"><h3 class="author"><span class="firstname">Fabian</span> <span class="surname">Herschel, Distinguished Architect SAP, SUSE</span></h3></div></div><div><div class="author"><h3 class="author"><span class="firstname">Bernd</span> <span class="surname">Schubert, SAP Solution Architect, SUSE</span></h3></div></div><div><div class="abstract"><p class="title"><strong>Abstract</strong></p><p>SUSE® Linux Enterprise Server for SAP Applications is
		optimized in various ways for SAP* applications.
		This document explains how to deploy an S/4
		HANA Enqueue Replication 2 High Availability Cluster solution.
		It is based on SUSE Linux Enterprise Server for SAP Applications 12 and related service packs.
	</p><p><span class="strong"><strong>Disclaimer: </strong></span>
        Documents published as part of the SUSE Best Practices series have been contributed voluntarily
        by SUSE employees and third parties. They are meant to serve as examples of how particular
        actions can be performed. They have been compiled with utmost attention to detail.
        However, this does not guarantee complete accuracy. SUSE cannot verify that actions described
        in these documents do what is claimed or whether actions described have unintended consequences.
        SUSE LLC, its affiliates, the authors, and the translators may not be held liable for possible errors
        or the consequences thereof.</p></div></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="section"><a href="#id-about-this-guide">About This Guide</a></span></dt><dd><dl><dt><span class="section"><a href="#id-introduction">Introduction</a></span></dt><dt><span class="section"><a href="#sec-resource">Additional Documentation and Resources</a></span></dt><dt><span class="section"><a href="#id-errata">Errata</a></span></dt><dt><span class="section"><a href="#id-feedback">Feedback</a></span></dt></dl></dd><dt><span class="section"><a href="#id-scope-of-this-document">Scope of This Document</a></span></dt><dt><span class="section"><a href="#id-overview">Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#id-differences-to-previous-cluster-architectures">Differences to Previous Cluster Architectures</a></span></dt><dt><span class="section"><a href="#id-three-systems-or-more-for-ascs-ers-database-and-additional-sap-instances">Three Systems or More for ASCS, ERS, Database and Additional SAP Instances</a></span></dt><dt><span class="section"><a href="#id-high-availability-for-the-database">High Availability for the Database</a></span></dt><dt><span class="section"><a href="#id-integration-of-sap-s4hana-into-the-cluster-using-the-cluster-connector">Integration of SAP S/4HANA into the Cluster Using the Cluster Connector</a></span></dt><dt><span class="section"><a href="#id-disks-and-partitions">Disks and Partitions</a></span></dt><dt><span class="section"><a href="#id-ip-addresses-and-virtual-names">IP Addresses and Virtual Names</a></span></dt><dt><span class="section"><a href="#id-mount-points-and-nfs-shares">Mount Points and NFS Shares</a></span></dt></dl></dd><dt><span class="section"><a href="#id-sap-installation">SAP Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#id-linux-user-and-group-number-scheme">Linux User and Group Number Scheme</a></span></dt><dt><span class="section"><a href="#id-installing-ascs-on-valuga11">Installing ASCS on valuga11</a></span></dt><dt><span class="section"><a href="#id-installing-ers-on-valuga12">Installing ERS on valuga12</a></span></dt><dt><span class="section"><a href="#id-subsequent-steps-for-ascs-and-ers">Subsequent Steps for ASCS and ERS</a></span></dt><dt><span class="section"><a href="#id-installing-database-on-valuga01">Installing Database on valuga01</a></span></dt><dt><span class="section"><a href="#id-install-the-primary-application-server-pas-on-valuga01">Install the Primary Application Server (PAS) on valuga01</a></span></dt><dt><span class="section"><a href="#id-installing-an-additional-application-server-aas-on-valuga01">Installing an Additional Application Server (AAS) on valuga01</a></span></dt></dl></dd><dt><span class="section"><a href="#id-implementing-the-cluster">Implementing the Cluster</a></span></dt><dd><dl><dt><span class="section"><a href="#id-os-preparation-and-cluster-software-installation">OS Preparation and Cluster Software Installation</a></span></dt><dt><span class="section"><a href="#id-configuring-the-cluster-base">Configuring the Cluster Base</a></span></dt><dt><span class="section"><a href="#id-configuring-cluster-resources">Configuring Cluster Resources</a></span></dt></dl></dd><dt><span class="section"><a href="#id-administration">Administration</a></span></dt><dd><dl><dt><span class="section"><a href="#id-dos-and-donts">Dos and Don’ts</a></span></dt><dt><span class="section"><a href="#id-testing-the-cluster">Testing the Cluster</a></span></dt></dl></dd><dt><span class="section"><a href="#id-multi-node-cluster-setups-for-an-sap-s4hana">Multi-Node Cluster Setups for an SAP S/4HANA</a></span></dt><dd><dl><dt><span class="section"><a href="#id-extend-an-existing-two-node-cluster-configuration">Extend An Existing Two Node Cluster Configuration</a></span></dt><dt><span class="section"><a href="#id-pros-and-cons-for-odd-and-even-numbers-of-cluster-nodes">Pro’s and Con’s for Odd and Even Numbers of Cluster Nodes</a></span></dt></dl></dd><dt><span class="section"><a href="#id-references">References</a></span></dt><dd><dl><dt><span class="section"><a href="#id-pacemaker">Pacemaker</a></span></dt><dt><span class="section"><a href="#id-related-suse-tid">Related SUSE TID</a></span></dt><dt><span class="section"><a href="#id-related-sap-notes">Related SAP Notes</a></span></dt></dl></dd><dt><span class="section"><a href="#id-appendix">Appendix</a></span></dt><dd><dl><dt><span class="section"><a href="#id-crm-configuration">CRM Configuration</a></span></dt><dt><span class="section"><a href="#id-corosync-configuration-of-the-two-node-cluster">Corosync Configuration of the Two Node Cluster</a></span></dt><dt><span class="section"><a href="#id-corosync-configuration-of-the-multi-node-cluster">Corosync Configuration of the multi Node Cluster</a></span></dt></dl></dd><dt><span class="section"><a href="#id-legal-notice">Legal Notice</a></span></dt><dd><dl><dt><span class="section"><a href="#id-gnu-free-documentation-license">GNU Free Documentation License</a></span></dt></dl></dd></dl></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-about-this-guide"></a>About This Guide</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-introduction"></a>Introduction</h3></div></div></div><p>SUSE® Linux Enterprise Server for SAP Applications is the optimal platform to
run SAP* applications with high availability. Together with a redundant layout
of the technical infrastructure, single points of failure can be eliminated.</p><p>SAP* Business Suite is a sophisticated application platform for large enterprises
and mid-size companies. Many critical business environments require the highest
possible SAP* application availability.</p><p>The described cluster solution can be used for SAP* SAP S/4HANA ABAP Platform.</p><p>SAP S/4HANA ABAP Platform is a common stack of middleware functionality used to support SAP
business applications. The SAP Enqueue Replication Server 2 constitutes application
level redundancy for one of the most crucial components of the SAP S/4HANA ABAP Platform stack,
the enqueue service. An optimal effect of the enqueue replication mechanism can
be achieved when combining the application level redundancy with a high
availability cluster solution, as provided for example by SUSE Linux Enterprise Server for SAP Applications. Over several
years of productive operations, the components mentioned have proven their maturity
for customers of different sizes and industries.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="sec-resource"></a>Additional Documentation and Resources</h3></div></div></div><p>Several chapters in this document contain links to additional documentation resources that
are either available on the system or on the Internet.</p><p>For the latest product documentation updates, see <a class="link" href="https://documentation.suse.com/" target="_top">https://documentation.suse.com/</a>.</p><p>More whitepapers, guides and best practices documents referring to SUSE Linux Enterprise Server and SAP can be
found and downloaded at the SUSE Best Practices Web page:</p><p><a class="link" href="https://documentation.suse.com/sbp/sap/" target="_top">https://documentation.suse.com/sbp/sap/</a></p><p>Here you can access guides for SAP HANA system replication
automation and High Availability (HA) scenarios for SAP NetWeaver and SAP S/4HANA.</p><p>Additional resources, such as customer references, brochures or flyers, can be found at the SUSE Linux
Enterprise Server for SAP Applications resource library:</p><p><a class="link" href="https://www.suse.com/products/sles-for-sap/#resource" target="_top">https://www.suse.com/products/sles-for-sap/#resource</a> .</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-errata"></a>Errata</h3></div></div></div><p>To deliver urgent smaller fixes and important information in a timely manner, the Technical Information Document (TID) for this document
will be updated, maintained and published at a higher frequency:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - Setup Guide - Errata
(<a class="link" href="https://www.suse.com/support/kb/doc/?id=7023714" target="_top">https://www.suse.com/support/kb/doc/?id=7023714</a>)</p></li><li class="listitem"><p>In addition to this guide, check the SUSE SAP Best Practice Guide Errata for other solutions
(<a class="link" href="https://www.suse.com/support/kb/doc/?id=7023713" target="_top">https://www.suse.com/support/kb/doc/?id=7023713</a>).</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-feedback"></a>Feedback</h3></div></div></div><p>Several feedback channels are available:</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Bugs and Enhancement Requests</span></dt><dd><p>For services and support options available for your product, refer to <a class="link" href="http://www.suse.com/support/" target="_top">http://www.suse.com/support/</a>.</p></dd></dl></div><p>To report bugs for a product component, go to <a class="link" href="https://scc.suse.com/support/" target="_top">https://scc.suse.com/support/</a> requests, log in, and select <span class="emphasis"><em>Submit New SR</em></span> (Service Request).</p><div class="variablelist"><dl class="variablelist"><dt><span class="term">Mail</span></dt><dd><p>For feedback on the documentation of this product, you can send a mail to <a class="link" href="mailto:doc-team@suse.com" target="_top">doc-team@suse.com</a>. Make sure to include the document title, the product version and the publication date of the documentation. To report errors or suggest enhancements, provide a concise description of the problem and refer to the respective section number and page (or URL).</p></dd></dl></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-scope-of-this-document"></a>Scope of This Document</h2></div></div></div><p>The document at hand explains how to:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Plan a SUSE Linux Enterprise High Availability platform for SAP S/4HANA ABAP Platform, including SAP Enqueue Replication Server 2.</p></li><li class="listitem"><p>Set up a Linux high availability platform and perform a basic SAP S/4HANA ABAP Platform
installation including SAP Enqueue Replication Server 2 on SUSE Linux Enterprise.</p></li><li class="listitem"><p>Integrate the high availability cluster with the SAP control framework via
<span class="strong"><strong>sap-suse-cluster-connector</strong></span> version 3, as certified by SAP.</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This guide implements the cluster architecture for enqueue replication version 2. For SAP S/4HANA ABAP Platform
 versions 1809 or newer enqueue replication version 2 is the default.</p></div><p>This guide focuses on the high availability of the central services. For SAP HANA system replication
consult the guides for the performance-optimized or cost-optimized scenario (see <a class="xref" href="#sec-resource" title="Additional Documentation and Resources">the section called “Additional Documentation and Resources”</a>).</p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-overview"></a>Overview</h2></div></div></div><p>This document describes setting up a pacemaker cluster using SUSE Linux Enterprise Server for SAP Applications
12 for the Enqueue Replication scenario. The focus is on matching the SAP S/4-HA-CLU 1.0
certification specifications and goals. For the setup described in this document, two nodes are used for the ASCS
central services instance and ERS replicated enqueue instance. These two nodes are controlled by
the SUSE Linux Enterprise High Availability cluster. A third node is used for running the database and PAS and AAS application
server instances. An additional fourth node is used as NFS server.</p><p>The goals for the setup include:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Integration of the cluster with the SAP start framework <span class="emphasis"><em>sapstartsrv</em></span> to
ensure that maintenance procedures do not break the cluster stability.</p></li><li class="listitem"><p>Rolling Kernel Switch (RKS) awareness.</p></li><li class="listitem"><p>Standard SAP installation to improve support processes.</p></li><li class="listitem"><p>Support of automated HA maintenance mode for SAP resources by implementing support of
SAP HACheckMaintenanceMode and HASetMaintenanceMode.</p></li><li class="listitem"><p>Support of more than two cluster nodes for ASCS and ERS instances allowed.</p></li></ul></div><p>The updated certification SAP S/4-HA-CLU 1.0 redefines some of the test procedures
and describes new expectations how the cluster should behave in special
conditions. These changes allowed to improve the cluster architecture and to
design it for easier usage and setup.</p><p>Shared SAP resources are located on a central NFS server.</p><p>The SAP instances themselves are installed on a shared disk to allow for switching over the file
systems for proper functionality. A shared disk setup also allows using the SBD
for the cluster fencing mechanism STONITH.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-differences-to-previous-cluster-architectures"></a>Differences to Previous Cluster Architectures</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The described new concept differs from the old stack that used a master-slave architecture.
With the new certification there is a switch to a simpler model with primitives.
This means: on one machine there is the ASCS instance with its own resources and on
the other machine there is the ERS instance with its own resources.</p></li><li class="listitem"><p>For SAP S/4HANA the new concept implies that, after a resource failure, the ASCS does not need to be started at the ERS
side. The new enqueue architecture is also named ENSA2.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-three-systems-or-more-for-ascs-ers-database-and-additional-sap-instances"></a>Three Systems or More for ASCS, ERS, Database and Additional SAP Instances</h3></div></div></div><p>This document describes the installation of a distributed SAP system on three and more
systems. In this setup, only two systems reside inside the cluster. The database and
SAP dialog instances can be added to the cluster either by adding more nodes to the
cluster or by installing the database on either of the existing nodes. However, it is recommended to install the
database on a separate cluster. The cluster configuration for three and more nodes is described at the
end of this document. The number of nodes within one cluster should be either two or an odd number.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Because the setup at hand focuses on the SAP S/4-HA-CLU 1.0 certification, the cluster detailed
in this guide only manages the SAP instances ASCS and ERS.</p></div><p>If your database is SAP HANA, we recommend setting up the performance-optimized
system replication scenario using the automation solution SAPHanaSR. The
SAPHanaSR automation should be set up in an own two-node cluster. The setup is
described in a separate best practices document available from the SUSE Best Practices Web page.</p><div class="figure"><a id="id1459"></a><p class="title"><strong>Figure 1. Three systems for the certification setup</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="NaN"><tr><td><img src="images/sles4sap_nw740_3nodes.svg" width="NaN" alt="SVG" /></td></tr></table></div></div></div><br class="figure-break" /><div class="itemizedlist"><p class="title"><strong>Clustered machines Two-Node Scenario</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>one machine (valuga11) for ASCS</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Hostname:    sapen2as</p></li></ul></div></li><li class="listitem"><p>one machine (valuga12) for ERS</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Hostname:   sapen2er</p></li></ul></div></li></ul></div><div class="itemizedlist"><p class="title"><strong>Non-Clustered machine</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>one machine (valuga01) for DB and as application server</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Hostname:   sapen2db</p></li><li class="listitem"><p>Hostname:   sapen2d1</p></li><li class="listitem"><p>Hostname:   sapen2d2</p></li></ul></div></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-high-availability-for-the-database"></a>High Availability for the Database</h3></div></div></div><p>Depending on your needs, you can increase the availability of the database, if your
database is not already highly available by design.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-sap-hana-system-replication"></a>SAP HANA System Replication</h4></div></div></div><p>A perfect enhancement of the three-node scenario described in this document is
to implement an SAP HANA system replication (SR) automation.</p><div class="figure"><a id="id1495"></a><p class="title"><strong>Figure 2. One cluster for central services, one for SAP HANA SR</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="NaN"><tr><td><img src="images/sles4sap_nw740_cs+hanasr.svg" width="NaN" alt="SVG" /></td></tr></table></div></div></div><br class="figure-break" /><div class="table"><a id="id1502"></a><p class="title"><strong>Table 1. The following OS/database combinations are examples for this scenario</strong></p><div class="table-contents"><table class="table" summary="The following OS/database combinations are examples for this scenario" border="1" width="85%"><colgroup><col class="col_1" /><col class="col_2" /></colgroup><thead><tr><th colspan="2" align="center" valign="top">SUSE Linux Enterprise Server for SAP Applications 12</th></tr></thead><tbody><tr><td align="center" valign="top"><p><span class="strong"><strong>Intel X86_64</strong></span></p></td><td align="left" valign="top"><p>SAP HANA DATABASE 2.0</p></td></tr></tbody></table></div></div><br class="table-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Version for SAP S/4HANA ABAP Platform on Linux on AMD64/Intel 64. More information about
the supported combinations of OS and databases for SAP S/4HANA Server 1809 can be found at the
SAP Product Availability Matrix at <a class="link" href="https://apps.support.sap.com/sap/support/pam" target="_top">SAP PAM</a>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-integration-of-sap-s4hana-into-the-cluster-using-the-cluster-connector"></a>Integration of SAP S/4HANA into the Cluster Using the Cluster Connector</h3></div></div></div><p>The integration of the HA cluster through the SAP control framework using the
<span class="strong"><strong>sap_suse_cluster_connector</strong></span> is of special interest. The service <span class="strong"><strong>sapstartsrv</strong></span> controls SAP instances since
SAP Kernel versions 6.40. One of the classic problems running
SAP instances in a highly available environment is the following: If an SAP
administrator changes the status (start/stop) of an SAP instance without using
the interfaces provided by the cluster software, the cluster framework will
detect that as an error status and will bring the SAP instance into the old
status by either starting or stopping the SAP instance. This can result in
very dangerous situations, if the cluster changes the status of an SAP instance
during some SAP maintenance tasks. The new updated solution enables the central component
<span class="strong"><strong>sapstartsrv</strong></span> to report state changes to the cluster software. This avoids dangerous situations
as previously described.
More details can be found in the blog article "Using sap_vendor_cluster_connector for interaction between cluster
framework and sapstartsrv" at <a class="link" href="https://blogs.sap.com/2014/05/08/using-sapvendorclusterconnector-for-interaction-between-cluster-framework-and-sapstartsrv/comment-page-1/" target="_top">https://blogs.sap.com/2014/05/08/using-sapvendorclusterconnector-for-interaction-between-cluster-framework-and-sapstartsrv/comment-page-1/</a>.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If you update from an SAP S/4HANA ABAP Platform version less than 1809, read SAP Note 2641019 carefully to adapt your cluster.</p></div><div class="figure"><a id="id1529"></a><p class="title"><strong>Figure 3. Cluster connector to integrate the cluster with the SAP start framework</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="NaN"><tr><td><img src="images/sles4sap_clusterconnector.svg" width="NaN" alt="SVG" /></td></tr></table></div></div></div><br class="figure-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>For this scenario, an updated version of the <span class="strong"><strong>sap-suse-cluster-connector</strong></span> is used.
It implements the API version 3 for the communication between the cluster
framework and the <span class="strong"><strong>sapstartsrv</strong></span> service.</p></div><p>The new version of the <span class="strong"><strong>sap-suse-cluster-connector</strong></span> allows starting, stopping and migrating
an SAP instance. The integration between the cluster software and the
<span class="strong"><strong>sapstartsrv</strong></span> also implements the option to run checks of the HA setup using either the
command line tool <span class="strong"><strong>sapcontrol</strong></span> or even the SAP management consoles (SAP MMC or
SAP MC). Since version 3.1.0 and later the maintenance mode of cluster resources triggered with SAP
<span class="strong"><strong>sapcontrol</strong></span> commands is supported.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-disks-and-partitions"></a>Disks and Partitions</h3></div></div></div><p>XFS is used for all SAP file systems besides the file systems on NFS.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-shared-disk-for-cluster-ascs-and-ers"></a>Shared Disk for Cluster ASCS and ERS</h4></div></div></div><p>The disk for the ASCS and ERS instances must be shared and assigned to the
cluster nodes valuga11 and valuga12 in the two-node cluster example. In addition to the partitions for the file systems
for the SAP instances, the disk also provides the partition to be used as SBD.</p><p>On valuga11 prepare the file systems for the shared disk. Create three partitions on
the shared drive /dev/disk/by-id/SUSE-Example-A:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Partition one (/dev/disk/by-id/SUSE-Example-A-part1) for SBD (7 MB)</p></li><li class="listitem"><p>Partition two (/dev/disk/by-id/SUSE-Example-A-part2) for the first file system (10 GB) formatted with XFS</p></li><li class="listitem"><p>Partition three (/dev/disk/by-id/SUSE-Example-A-part3) for the second file system (10 GB) formatted with XFS</p></li></ul></div><p>To create the partitions, you can use either YaST or available command line tools.
The following script can be used for non-interactive setups.</p><div class="example"><a id="id1560"></a><p class="title"><strong>Example 1. Create Partitions and File Systems for SBD and ASCS/ERS on valuga11</strong></p><div class="example-contents"><pre class="screen"># parted -s /dev/disk/by-id/SUSE-Example-A print
# # we are on the 'correct' drive, right?
# parted -s /dev/disk/by-id/SUSE-Example-A mklabel gpt
# parted -s /dev/disk/by-id/SUSE-Example-A mkpart primary 1049k 8388k
# parted -s /dev/disk/by-id/SUSE-Example-A mkpart primary 8389k 10.7G
# parted -s /dev/disk/by-id/SUSE-Example-A mkpart primary 10.7G 21.5G
# mkfs.xfs /dev/disk/by-id/SUSE-Example-A-part2
# mkfs.xfs /dev/disk/by-id/SUSE-Example-A-part3</pre></div></div><br class="example-break" /><p>For these file systems, we recommend using normal partitions to keep the cluster
configuration as simple as possible. However, you can also place these file
systems in separate volume groups. In that case, you need to add further cluster
resources to control the logical volume groups, and occasionally
MD-Raid devices. The description of such a setup however is out of the scope of this guide.</p><p>After having partitioned the shared disk on valuga11, you need to request a
partition table rescan on valuga12.</p><pre class="screen"># partprobe; fdisk -l /dev/disk/by-id/SUSE-Example-A</pre><p>During the SAP installation you need to mount /usr/sap/EN2/ASCS00 on valuga11 and
/usr/sap/EN2/ERS10 on valuga12.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>valuga11:   /dev/disk/by-id/SUSE-Example-A-part2   /usr/sap/EN2/ASCS00</p></li><li class="listitem"><p>valuga12:   /dev/disk/by-id/SUSE-Example-A-part3   /usr/sap/EN2/ERS10</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-disk-for-db-and-dialog-instances-hana-db"></a>Disk for DB and Dialog Instances (HANA DB)</h4></div></div></div><p>The disk for the database server is assigned to valuga01.
The disk for the primary and secondary application server is assigned to
valuga01.</p><div class="itemizedlist"><p class="title"><strong>valuga01</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Partition one (/dev/disk/by-id/SUSE-Example-B-part1) for the database (160 GB) formatted with XFS</p></li><li class="listitem"><p>Partition two (/dev/disk/by-id/SUSE-Example-B-part2) for the PAS instance (10 GB) formatted with XFS</p></li><li class="listitem"><p>Partition three (/dev/disk/by-id/SUSE-Example-B-part3) for the AAS instance (10 GB) formatted
with XFS</p></li></ul></div><p>You can either use YaST or available command line tools to create the partitions.
The following script can be used for non-interactive setups.</p><div class="example"><a id="id1584"></a><p class="title"><strong>Example 2. Create Partitions and File Systems for DB and App Servers on valuga01</strong></p><div class="example-contents"><pre class="screen"># parted -s /dev/disk/by-id/SUSE-Example-B print
# # we are on the 'correct' drive, right?
# parted -s /dev/disk/by-id/SUSE-Example-B mklabel gpt
# parted -s /dev/disk/by-id/SUSE-Example-B mkpart primary 1049k 160G
# parted -s /dev/disk/by-id/SUSE-Example-B mkpart primary 160G 170G
# parted -s /dev/disk/by-id/SUSE-Example-B mkpart primary 170G 180G
# mkfs.xfs /dev/disk/by-id/SUSE-Example-B-part1
# mkfs.xfs /dev/disk/by-id/SUSE-Example-B-part2
# mkfs.xfs /dev/disk/by-id/SUSE-Example-B-part3</pre></div></div><br class="example-break" /><div class="itemizedlist"><p class="title"><strong>To be mounted either by OS or an optional cluster</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>valuga01:   /dev/disk/by-id/SUSE-Example-B-part1   /hana</p></li><li class="listitem"><p>valuga01:   /dev/disk/by-id/SUSE-Example-B-part2   /usr/sap/EN2/D01</p></li><li class="listitem"><p>valuga01:   /dev/disk/by-id/SUSE-Example-B-part3   /usr/sap/EN2/D02</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>D01: Since NetWeaver 7.5 the primary application server instance
directory has been renamed to 'D&lt;Instance_Number&gt;'.</p></div><div class="itemizedlist"><p class="title"><strong>NFS server</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>192.168.1.1:/data/export/S4_HA_CLU_10/EN2/sapmnt   /sapmnt</p></li><li class="listitem"><p>192.168.1.1:/data/export/S4_HA_CLU_10/EN2/SYS /usr/sap/EN2/SYS</p></li></ul></div><div class="itemizedlist"><p class="title"><strong>Media</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>192.168.1.1:/Landscape /var/lib/Landscape</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-ip-addresses-and-virtual-names"></a>IP Addresses and Virtual Names</h3></div></div></div><p>Check if the file <span class="emphasis"><em>/etc/hosts</em></span> contains at least the following address resolutions.
Add those entries if they are missing.</p><pre class="screen">192.168.1.100  valuga01
192.168.1.103  valuga11
192.168.1.104  valuga12

192.168.1.112  sapen2as
192.168.1.113  sapen2er
192.168.1.114  sapen2db
192.168.1.110  sapen2d1
192.168.1.111  sapen2d2</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-mount-points-and-nfs-shares"></a>Mount Points and NFS Shares</h3></div></div></div><p>In the present setup the directory <span class="emphasis"><em>/usr/sap</em></span> is part of the root file system. You can
also create a dedicated file system for that area and mount <span class="emphasis"><em>/usr/sap</em></span>
during the system boot. As <span class="emphasis"><em>/usr/sap</em></span> contains the SAP control file
<span class="emphasis"><em>sapservices</em></span> and the <span class="strong"><strong>saphostagent</strong></span>, the directory should not be placed on a
shared file system between the cluster nodes.</p><p>You need to create the directory structure on all nodes that should run the SAP resource.
The SYS directory will be located on an NFS share for all nodes.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Create mount points and mounting NFS shares on all nodes.</p></li></ul></div><div class="example"><a id="id1624"></a><p class="title"><strong>Example 3. Mount NFS Shares on all nodes</strong></p><div class="example-contents"><pre class="screen"># mkdir -p /sapmnt /var/lib/Landscape
# mkdir -p /usr/sap/EN2/{ASCS00,D01,D02,ERS10,SYS}
# mount -t nfs 192.168.1.1:/data/export/S4_HA_CLU_10/EN2/sapmnt    /sapmnt
# mount -t nfs 192.168.1.1:/data/export/S4_HA_CLU_10/EN2/SYS /usr/sap/EN2/SYS
# mount -t nfs 192.168.1.1:/Landscape /var/lib/Landscape</pre></div></div><br class="example-break" /><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>For HANA: Create mount points for database at valuga01:</p></li></ul></div><pre class="screen"># mkdir /hana
# mount /dev/disk/by-id/SUSE-Example-B-part1 /hana/
# mkdir -p /hana/{shared,data,log}
# mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
# mount /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02</pre><p>You do not control the NFS shares via the cluster in the setup at hand. Thus you should
add these file systems to <span class="emphasis"><em>/etc/fstab</em></span> to get the file systems mounted during
the next system boot.</p><div class="figure"><a id="id1633"></a><p class="title"><strong>Figure 4. File system layout including NFS shares</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="NaN"><tr><td><img src="images/sles4sap_ap1809_fs.svg" width="NaN" alt="SVG" /></td></tr></table></div></div></div><br class="figure-break" /><p>Prepare the three servers for the distributed SAP installation. Server 1
(valuga01) is used to install the SAP HANA database. Server 1
(valuga01) is used to install the PAS SAP instance. Server 1
(valuga01) is used to install the AAS SAP instances. Server 2
(valuga11) is used to install the ASCS SAP instances. Server 3
(valuga12) is used to install the ERS SAP instances.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Mount the instance and database file systems on one specific node:</p></li></ul></div><div class="example"><a id="id1644"></a><p class="title"><strong>Example 4. Mount several file systes for SAP S/4HANA on different nodes</strong></p><div class="example-contents"><pre class="screen">(ASCS   valuga11) # mount /dev/disk/by-id/SUSE-Example-A-part2 /usr/sap/EN2/ASCS00
(ERS    valuga12) # mount /dev/disk/by-id/SUSE-Example-A-part3 /usr/sap/EN2/ERS10
(DB     valuga01) # mount /dev/disk/by-id/SUSE-Example-B-part1 /hana/
(Dialog valuga01) # mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
(Dialog valuga01) # mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D02</pre></div></div><br class="example-break" /><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>As a result, the directory <span class="emphasis"><em>/usr/sap/EN2/</em></span> should now look as follows:</p></li></ul></div><pre class="screen"># ls -la /usr/sap/EN2/
total 0
drwxr-xr-x 1 en2adm sapsys 70 28. Mar 17:26 ./
drwxr-xr-x 1 root   sapsys 58 28. Mar 16:49 ../
drwxr-xr-x 7 en2adm sapsys 58 28. Mar 16:49 ASCS00/
drwxr-xr-x 1 en2adm sapsys  0 28. Mar 15:59 D02/
drwxr-xr-x 1 en2adm sapsys  0 28. Mar 15:59 D01/
drwxr-xr-x 1 en2adm sapsys  0 28. Mar 15:59 ERS10/
drwxr-xr-x 5 en2adm sapsys 87 28. Mar 17:21 SYS/</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The owner of the directory and files is changed during the SAP installation. By default, all
of them are owned by <span class="emphasis"><em>root</em></span>.</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-sap-installation"></a>SAP Installation</h2></div></div></div><p>The overall procedure to install the distributed SAP system is as follows:</p><div class="orderedlist"><p class="title"><strong>Tasks</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p>Plan Linux user and group number scheme</p></li><li class="listitem"><p>Install the ASCS instance for the central services</p></li><li class="listitem"><p>Install the ERS to get a replicated enqueue scenario</p></li><li class="listitem"><p>Prepare the ASCS and ERS installations for the cluster take-over</p></li><li class="listitem"><p>Install the database</p></li><li class="listitem"><p>Install the primary application server instance (PAS)</p></li><li class="listitem"><p>Install additional application server instances (AAS)</p></li></ol></div><p>The result will be a distributed SAP installation as illustrated here:</p><div class="figure"><a id="id1675"></a><p class="title"><strong>Figure 5. Distributed installation of the SAP system</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="NaN"><tr><td><img src="images/sles4sap_nw740_distInstall.svg" width="NaN" alt="SVG" /></td></tr></table></div></div></div><br class="figure-break" /><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-linux-user-and-group-number-scheme"></a>Linux User and Group Number Scheme</h3></div></div></div><p>Whenever asked by the SAP software provisioning manager (SWPM) which Linux User
IDs or Group IDs to use, refer to the following table as an example:</p><pre class="screen">Group sapinst      1001
Group sapsys       1002
Group dbhshm       1003

User  en2adm       2001
User  sapadm       2002
User  dbhadm       2003</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-ascs-on-valuga11"></a>Installing ASCS on valuga11</h3></div></div></div><p>Temporarily, as the local IP address, set the service IP address which you will later use in the
cluster, because the installer needs to be able to resolve and use it.
Make sure to use the correct virtual host name for each installation step.
If applicable, make sure to also mount file systems like <span class="emphasis"><em>/dev/disk/by-id/SUSE-Example-A-part2</em></span> and <span class="emphasis"><em>/var/lib/Landscape/</em></span>.</p><pre class="screen"># ip a a 192.168.1.112/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-A-part2 /usr/sap/EN2/ASCS00
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2as</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP
→ High-Availability System → ASCS Instance</p></li></ul></div></li><li class="listitem"><p>Use SID EN2</p></li><li class="listitem"><p>Use instance number 00</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>All passwords: use &lt;use-your-secure-pwd&gt;</p></li><li class="listitem"><p>Double-check during the parameter review, if virtual name <span class="strong"><strong>sapen2as</strong></span> is used</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-ers-on-valuga12"></a>Installing ERS on valuga12</h3></div></div></div><p>Temporarily, as the local IP address, set the service IP address which you will later use in the
cluster, because the installer needs to be able to resolve and use it.
Make sure to use the correct virtual host name for each installation step.</p><pre class="screen"># ip a a 192.168.1.113/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-A-part3 /usr/sap/EN2/ERS10
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2er</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP →
High-Availability System → ERS Instance</p></li></ul></div></li><li class="listitem"><p>Use instance number 10</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>Double-check during the parameter review that virtual name <span class="strong"><strong>sapen2er</strong></span> is used</p></li><li class="listitem"><p>If you get an error during the installation about permissions, change the
ownership of the ERS directory</p></li></ul></div><pre class="screen"># chown -R en2adm:sapsys /usr/sap/EN2/ERS10</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>If you get a prompt to manually stop/start the ASCS instance, log in to
valuga11 as user en2adm and call 'sapcontrol'.</p></li></ul></div><pre class="screen"># sapcontrol -nr 00 -function Stop    # to stop the ASCS
# sapcontrol -nr 00 -function Start   # to start the ASCS</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-subsequent-steps-for-ascs-and-ers"></a>Subsequent Steps for ASCS and ERS</h3></div></div></div><p>After installation, you can perform several subsequent steps on the ASCS and ERS instances.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-stopping-ascs-and-ers"></a>Stopping ASCS and ERS</h4></div></div></div><p>To stop the ASCS and ERS instances, use the commands below.
On <span class="emphasis"><em>valuga11</em></span>, do the following:</p><pre class="screen"># su - en2adm
# sapcontrol -nr 00 -function Stop
# sapcontrol -nr 00 -function StopService</pre><p>On <span class="emphasis"><em>valuga12</em></span>, do the following:</p><pre class="screen"># su - en2adm
# sapcontrol -nr 10 -function Stop
# sapcontrol -nr 10 -function StopService</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-maintaining-sapservices"></a>Maintaining <span class="emphasis"><em>sapservices</em></span></h4></div></div></div><p>Ensure <span class="emphasis"><em>/usr/sap/sapservices</em></span> holds both entries (ASCS and ERS) on both cluster
nodes. This allows the <span class="strong"><strong>sapstartsrv</strong></span> clients to start the service as follows:</p><p>As user <span class="emphasis"><em>en2adm</em></span>, type the following command:</p><pre class="screen"># sapcontrol -nr 10 -function StartService EN2</pre><p>The <span class="emphasis"><em>/usr/sap/sapservices</em></span> file looks as follows - typically one line per instance is displayed:</p><pre class="screen">#!/bin/sh
LD_LIBRARY_PATH=/usr/sap/EN2/ASCS00/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; /usr/sap/EN2/ASCS00/exe/sapstartsrv pf=/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as -D -u en2adm
LD_LIBRARY_PATH=/usr/sap/EN2/ERS10/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; /usr/sap/EN2/ERS10/exe/sapstartsrv pf=/usr/sap/EN2/ERS10/profile/EN2_ERS10_sapen2er -D -u en2adm</pre><p>If entries are missing you can register them using sapstartsrv with options <span class="strong"><strong>pf=</strong></span>&lt;profile-of-the-sap-instance&gt; and <span class="strong"><strong>-reg</strong></span>.</p><pre class="screen"># LD_LIBRARY_PATH=/usr/sap/hostctrl/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH
# /usr/sap/hostctrl/exe/sapstartsrv \
 pf=/usr/sap/&lt;SID&gt;/SYS/profile/&lt;SID&gt;_ERS&lt;instanceNumberErs&gt;_&lt;virtHostNameErs&gt; \
 -reg
# /usr/sap/hostctrl/exe/sapstartsrv \
 pf=/usr/sap/&lt;SID&gt;/SYS/profile/&lt;SID&gt;_ASCS&lt;instanceNumberAscs&gt;_&lt;virtHostNameAscs&gt; \
 -reg</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-integrating-the-cluster-framework-using-sap-suse-cluster-connector"></a>Integrating the Cluster Framework Using <span class="emphasis"><em>sap-suse-cluster-connector</em></span></h4></div></div></div><p>Install the package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> version 3.1.0 from the SUSE
repositories:</p><pre class="screen"># zypper in sap-suse-cluster-connector</pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> contains the version 3.x.x (SAP API 3).
The package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> with version 3.0.x implements the SUSE SAP API
version 3. New features like SAP Rolling Kernel Switch (RKS) and migration of ASCS are
only supported with this new version.
The package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> with version 3.1.x supports in addition the maintenance mode of
cluster resources triggered from SAP tools.</p></div><p>For the ERS and ASCS instances, edit the instance profiles
EN2_ASCS00_sapen2as and EN2_ERS10_sapen2er in the
profile directory <span class="emphasis"><em>/usr/sap/EN2/SYS/profile/</em></span>.</p><p>Tell the <span class="strong"><strong>sapstartsrv</strong></span> service to load the HA script connector library and
to use the connector <span class="strong"><strong>sap-suse-cluster-connector</strong></span>.</p><pre class="screen">service/halib = $(DIR_CT_RUN)/saphascriptco.so
service/halib_cluster_connector = /usr/bin/sap_suse_cluster_connector</pre><p>Add the user <span class="emphasis"><em>en2adm</em></span> to the unix user group <span class="emphasis"><em>haclient</em></span>.</p><pre class="screen"># usermod -a -G haclient en2adm</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-adapting-sap-profiles-to-match-the-sap-s4-ha-clu-1-0-certification"></a>Adapting SAP Profiles to Match the SAP S/4-HA-CLU 1.0 Certification</h4></div></div></div><p>For the ASCS instance, change the start command from <span class="emphasis"><em>Restart_Program_xx</em></span> to
<span class="emphasis"><em>Start_Program_xx</em></span> for the enqueue server (Enqueue Server 2). This change tells the
SAP start framework <span class="strong"><strong>not</strong></span> to self-restart the enqueue process. Such a restart
would result in a loss of the locks.</p><div class="example"><a id="id1787"></a><p class="title"><strong>Example 5. File /usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as</strong></p><div class="example-contents"><pre class="screen">Start_Program_01 = local $(_ENQ) pf=$(_PF)</pre></div></div><br class="example-break" /><p>Optionally, you can limit the number of restarts of services (in the case of
ASCS, this limits the restart of the message server).</p><p>For the ERS instance, change the start command from <span class="emphasis"><em>Restart_Program_xx</em></span> to
<span class="emphasis"><em>Start_Program_xx</em></span> for the enqueue replication server (Enqueue Replicator 2).</p><div class="example"><a id="id1794"></a><p class="title"><strong>Example 6. File /usr/sap/EN2/SYS/profile/EN2_ERS10_sapen2er</strong></p><div class="example-contents"><pre class="screen">Start_Program_00 = local $(_ENQR) pf=$(_PF) NR=$(SCSID)</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-starting-ascs-and-ers"></a>Starting ASCS and ERS</h4></div></div></div><p>To start the ASCS and ERS instances, use the commands below.</p><p>On <span class="emphasis"><em>valuga11</em></span>, do the following:</p><pre class="screen"># su - en2adm
# sapcontrol -nr 00 -function StartService EN2
# sapcontrol -nr 00 -function Start</pre><p>On <span class="emphasis"><em>valuga12</em></span>, do the following</p><pre class="screen"># su - en2adm
# sapcontrol -nr 10 -function StartService EN2
# sapcontrol -nr 10 -function Start</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-database-on-valuga01"></a>Installing Database on valuga01</h3></div></div></div><p>The HANA DB has very strict HW requirements. The storage sizing depends on many
indicators. Check the supported configurations at
<a class="link" href="https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html" target="_top">SAP HANA Hardware Directory</a>
and <a class="link" href="https://www.sap.com/documents/2015/03/74cdb554-5a7c-0010-82c7-eda71af511fa.html" target="_top">SAP HANA TDI</a>.</p><pre class="screen"># ip a a 192.168.1.114/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part1 /hana
# mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
# mount /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2db</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP →
High-Availability System → Database Instance</p></li></ul></div></li><li class="listitem"><p>Profile directory /sapmnt/EN2/profile</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>Database parameters : Database ID (DBSID) is DBH;
Database Host is sapen2db; Instance Number is 00</p></li><li class="listitem"><p>Database System ID enter Instance Number is 00; SAP Mount Directory is
/sapmnt/EN2/profile</p></li><li class="listitem"><p>Account parameters: change them in case of custom values needed</p></li><li class="listitem"><p>Clean-up: select <span class="strong"><strong>Yes</strong></span>, remove operating system users from the group <code class="literal">sapinst</code>.</p></li><li class="listitem"><p>Double-check during the parameter review, if virtual name <span class="strong"><strong>sapen2db</strong></span> is
used</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-install-the-primary-application-server-pas-on-valuga01"></a>Install the Primary Application Server (PAS) on valuga01</h3></div></div></div><pre class="screen"># ip a a 192.168.1.110/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part2 /usr/sap/EN2/D01
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2d1</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP →
High-Availability System → Primary Application Server Instance</p></li></ul></div></li><li class="listitem"><p>Use instance number 01</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>For this example setup we have used a default secure store key</p></li><li class="listitem"><p>Do not install Diagnostic Agent</p></li><li class="listitem"><p>No SLD</p></li><li class="listitem"><p>Double-check during the parameter review, if virtual name <span class="strong"><strong>sapen2d1</strong></span> is used</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-installing-an-additional-application-server-aas-on-valuga01"></a>Installing an Additional Application Server (AAS) on valuga01</h3></div></div></div><pre class="screen"># ip a a 192.168.1.111/24 dev eth0
# mount /dev/disk/by-id/SUSE-Example-B-part3 /usr/sap/EN2/D02
# cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst SAPINST_USE_HOSTNAME=sapen2d2</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP →
High-Availability System → Additional Application Server Instance</p></li></ul></div></li><li class="listitem"><p>Use instance number 02</p></li><li class="listitem"><p>Deselect using FQDN</p></li><li class="listitem"><p>Do not install Diagnostic Agent</p></li><li class="listitem"><p>Double-check during the parameter review, if virtual name <span class="strong"><strong>sapen2d2</strong></span> is used</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-implementing-the-cluster"></a>Implementing the Cluster</h2></div></div></div><p>The main procedure to implement the cluster is as follows:</p><div class="orderedlist"><p class="title"><strong>Tasks</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p>OS preparation and install the cluster software</p></li><li class="listitem"><p>Configure the cluster base including corosync and resource manager</p></li><li class="listitem"><p>Configure the cluster resources</p></li><li class="listitem"><p>Tune the cluster timing in special for the SBD.</p></li></ol></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Before you continue to set up the cluster, perform the following actions:
First stop all SAP instances. Then remove the (manually added) IP addresses on the cluster nodes.
Finally unmount the file systems which will be controlled by the cluster later.</p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>The SBD device/partition needs to be created beforehand. Double-check which
device/partition to use! In this setup guide a partition <span class="emphasis"><em>/dev/disk/by-id/SUSE-Example-A-part1</em></span>
is already reserved for SBD usage.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-os-preparation-and-cluster-software-installation"></a>OS Preparation and Cluster Software Installation</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Set up and enable <span class="strong"><strong>NTP</strong></span> with <span class="strong"><strong>yast2</strong></span>.</p></li><li class="listitem"><p>Install the RPM pattern <span class="strong"><strong>ha_sles</strong></span> on both cluster nodes.</p><pre class="screen"># zypper in -t pattern ha_sles</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-configuring-the-cluster-base"></a>Configuring the Cluster Base</h3></div></div></div><div class="itemizedlist"><p class="title"><strong>Tasks</strong></p><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>To configure the cluster base, you can use either YaST or the interactive
command line tool <span class="strong"><strong>ha-cluster-init</strong></span>. The example below uses the command line wizard.</p></li><li class="listitem"><p>Install and configure the watchdog device on the first machine.</p></li></ul></div><p>Instead of deploying the software based solution, a hardware-based watchdog device should preferably be used.
The following example uses the software device but can be easily adapted to the hardware device.</p><pre class="screen"># modprobe softdog
# echo softdog &gt; /etc/modules-load.d/watchdog.conf
# systemctl restart systemd-modules-load
# lsmod | egrep "(wd|dog|i6|iT|ibm)"</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Install and configure the cluster stack on the first machine</p></li></ul></div><pre class="screen"># ha-cluster-init -u -s  /dev/disk/by-id/SUSE-Example-A-part1</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Join the second node</p></li></ul></div><p>On the second node, perform some preparation steps.</p><pre class="screen"># modprobe softdog
# echo softdog &gt; /etc/modules-load.d/watchdog.conf
# systemctl restart systemd-modules-load
# lsmod | egrep "(wd|dog|i6|iT|ibm)"</pre><p>To configure the cluster base, you can use either YaST or the interactive
command line tool <span class="strong"><strong>ha-cluster-join</strong></span>. The example below uses the command line wizard.</p><pre class="screen"># ha-cluster-join -c valuga11</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The <span class="emphasis"><em>crm_mon -1r</em></span> output should look as follows:</p></li></ul></div><pre class="screen">Stack: corosync
Current DC: valuga11 (version 1.1.18+20180430.b12c320f5-1.14-b12c320f5) - partition with quorum
Last updated: Mon Jan 28 13:10:37 2019
Last change: Wed Jan 23 09:52:57 2019 by root via cibadmin on valuga11

2 nodes configured
1 resource configured

Online: [ valuga11 valuga12 ]

stonith-sbd	(stonith:external/sbd):	Started valuga11</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-configuring-cluster-resources"></a>Configuring Cluster Resources</h3></div></div></div><p>A changed SAPInstance resource configuration is needed for SAP S/4HANA to <span class="strong"><strong>not</strong></span> use
the master-slave construct anymore. Move to a more cluster-like construct to
start and stop the ASCS and the ERS instances themselves, but <span class="strong"><strong>not</strong></span> the complete
master-slave.</p><p>With the new version of ENSA2, the ASCS instance can be started on the same host. There is no longer a need
to follow the ERS instance. The ASCS instance receives the enqueue lock table over the network from the ERS instance. If no
other node is available, the ASCS instance will be started on the same host where the ERS instance is running.</p><div class="figure"><a id="id1938"></a><p class="title"><strong>Figure 6. Resources and constraints</strong></p><div class="figure-contents"><div class="mediaobject"><table border="0" summary="manufactured viewport for HTML img" style="cellpadding: 0; cellspacing: 0;" width="NaN"><tr><td><img src="images/sles4sap_s4hana1809_resources.svg" width="NaN" alt="SVG" /></td></tr></table></div></div></div><br class="figure-break" /><p>Another benefit of this concept is that you can work with native (mountable)
file systems instead of a shared (NFS) file system for the SAP instance
directories.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-preparing-the-cluster-for-adding-the-resources"></a>Preparing the Cluster for Adding the Resources</h4></div></div></div><p>To prevent the cluster from starting partially defined resources, set the cluster
to the maintenance mode. This deactivates all monitor actions.</p><p>As user <span class="emphasis"><em>root</em></span>, type the following command:</p><pre class="screen"># crm configure property maintenance-mode="true"</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-configuring-the-resources-for-the-ascs-instance"></a>Configuring the Resources for the ASCS Instance</h4></div></div></div><p>First, configure the resources for the file system, IP address and the SAP
instance. You need to adapt the parameters for your specific environment.</p><div class="example"><a id="id1955"></a><p class="title"><strong>Example 7. ASCS primitive</strong></p><div class="example-contents"><pre class="screen">primitive rsc_fs_EN2_ASCS00 Filesystem \
  params device="/dev/disk/by-id/SUSE-Example-A-part2" directory="/usr/sap/EN2/ASCS00" \
         fstype=xfs \
  op start timeout=60s interval=0 \
  op stop timeout=60s interval=0 \
  op monitor interval=20s timeout=40s
primitive rsc_ip_EN2_ASCS00 IPaddr2 \
  params ip=192.168.1.112 \
  op monitor interval=10s timeout=20s
primitive rsc_sap_EN2_ASCS00 SAPInstance \
  operations $id=rsc_sap_EN2_ASCS00-operations \
  op monitor interval=11 timeout=60 on-fail=restart \
  params InstanceName=EN2_ASCS00_sapen2as \
     START_PROFILE="/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as" \
     AUTOMATIC_RECOVER=false \
  meta resource-stickiness=5000</pre></div></div><br class="example-break" /><div class="example"><a id="id1958"></a><p class="title"><strong>Example 8. ASCS group</strong></p><div class="example-contents"><pre class="screen">group grp_EN2_ASCS00 \
  rsc_ip_EN2_ASCS00 rsc_fs_EN2_ASCS00 rsc_sap_EN2_ASCS00 \
	meta resource-stickiness=3000</pre></div></div><br class="example-break" /><p>Create a <span class="emphasis"><em>txt</em></span> file (like <span class="emphasis"><em>crm_ascs.txt</em></span>) with your preferred text editor. Add
both examples (primitives and group) to that file and load the configuration to
the cluster manager configuration.</p><p>As user <span class="emphasis"><em>root</em></span>, type the following command:</p><pre class="screen"># crm configure load update crm_ascs.txt</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-configuring-the-resources-for-the-ers-instance"></a>Configuring the Resources for the ERS Instance</h4></div></div></div><p>Second, configure the resources for the file system, IP address and the SAP
instance. You need to adapt the parameters for your specific environment.</p><p>The specific parameter <span class="emphasis"><em>IS_ERS=true</em></span> must only be set for the ERS instance.</p><div class="example"><a id="id1972"></a><p class="title"><strong>Example 9. ERS primitive</strong></p><div class="example-contents"><pre class="screen">primitive rsc_fs_EN2_ERS10 Filesystem \
  params device="/dev/disk/by-id/SUSE-Example-A-part3" directory="/usr/sap/EN2/ERS10" fstype=xfs \
  op start timeout=60s interval=0 \
  op stop timeout=60s interval=0 \
  op monitor interval=20s timeout=40s
primitive rsc_ip_EN2_ERS10 IPaddr2 \
  params ip=192.168.1.113 \
  op monitor interval=10s timeout=20s
primitive rsc_sap_EN2_ERS10 SAPInstance \
  operations $id=rsc_sap_EN2_ERS10-operations \
  op monitor interval=11 timeout=60 on-fail=restart \
  params InstanceName=EN2_ERS10_sapen2er \
         START_PROFILE="/usr/sap/EN2/SYS/profile/EN2_ERS10_sapen2er" \
         AUTOMATIC_RECOVER=false IS_ERS=true</pre></div></div><br class="example-break" /><div class="example"><a id="id1975"></a><p class="title"><strong>Example 10. ERS group</strong></p><div class="example-contents"><pre class="screen">group grp_EN2_ERS10 \
  rsc_ip_EN2_ERS10 rsc_fs_EN2_ERS10 rsc_sap_EN2_ERS10</pre></div></div><br class="example-break" /><p>Create a <span class="emphasis"><em>txt</em></span> file (like <span class="emphasis"><em>crm_ers.txt</em></span>) with your preferred text editor. Add
both examples (primitives and group) to that file and load the configuration to
the cluster manager configuration.</p><p><span class="emphasis"><em>As user root</em></span></p><pre class="screen"># crm configure load update crm_ers.txt</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-configuring-the-colocation-constraints-between-ascs-and-ers"></a>Configuring the Colocation Constraints Between ASCS and ERS</h4></div></div></div><p>Compared to the ENSA1 configuration, the constraints between the ASCS and ERS instances are changed.
An ASCS instance should avoid starting up on the cluster node running the ERS instance if any other
node is available. Today the ENSA2 setup can resynchronize the lock table over the network.</p><p>If the ASCS instance has been started by the cluster on the ERS node, the ERS instance should
be moved to another cluster node (col_sap_EN2_no_both). This constraint
is needed to ensure that the ERS instance will synchronize the locks again and the cluster is
ready for an additional take-over.</p><div class="example"><a id="id1988"></a><p class="title"><strong>Example 11. Location constraint</strong></p><div class="example-contents"><pre class="screen">colocation col_sap_EN2_no_both -5000: grp_EN2_ERS10 grp_EN2_ASCS00
order ord_sap_EN2_first_start_ascs Optional: rsc_sap_EN2_ASCS00:start \
      rsc_sap_EN2_ERS10:stop symmetrical=false</pre></div></div><br class="example-break" /><p>Create a <span class="emphasis"><em>txt</em></span> file (like <span class="emphasis"><em>crm_col.txt</em></span>) with a text editor. Add
both constraints to that file and load the configuration to the
cluster manager configuration.</p><p>As user <span class="emphasis"><em>root</em></span>, type the following command:</p><pre class="screen"># crm configure load update crm_col.txt</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-activating-the-cluster"></a>Activating the Cluster</h4></div></div></div><p>The last step is to end the cluster maintenance mode and to allow the
cluster to detect already running resources.</p><p>As user <span class="emphasis"><em>root</em></span>, type the following command:</p><pre class="screen"># crm configure property maintenance-mode="false"</pre></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-administration"></a>Administration</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-dos-and-donts"></a>Dos and Don’ts</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Before each test, verify that the cluster is in idle state, no migration constraints are active,
and no resource failure messages are visible. Start each procedure with a clean setup.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-migrating-the-ascs-instance"></a>Migrating the ASCS Instance</h4></div></div></div><p>To <span class="strong"><strong>migrate</strong></span> the ASCS SAP instance, you should use SAP tools such as
the SAP management console. This will trigger <span class="strong"><strong>sapstartsrv</strong></span> to use the
sap-suse-cluster-connector to migrate the ASCS instance. As user <span class="emphasis"><em>en2adm</em></span> you can run
the command below to migrate the ASCS. This will always
migrate the ASCS to the ERS side which will keep the SAP enqueue locks.</p><p>As user <span class="emphasis"><em>en2adm</em></span>, type the command:</p><pre class="screen"># sapcontrol -nr 00 -function HAFailoverToNode ""</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-never-block-resources"></a>Never Block Resources</h4></div></div></div><p>With SAP S/4-HA-CLU 1.0 it is <span class="strong"><strong>no longer allowed to block resources</strong></span> from being
  controlled manually. This means using the variable <span class="emphasis"><em>BLOCK_RESOURCES</em></span> in
  <span class="emphasis"><em>/etc/sap_suse_cluster_connector</em></span> is not allowed anymore.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-always-use-unique-instance-numbers"></a>Always Use Unique Instance Numbers</h4></div></div></div><p>Currently all SAP <span class="strong"><strong>instance numbers controlled by the cluster must be unique</strong></span>.
  If you need multiple dialog instances, such as D00, running on different
  systems, they should not be controlled by the cluster.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-setting-the-cluster-to-maintenance-mode"></a>Setting the Cluster to Maintenance Mode</h4></div></div></div><p>The procedure to set the cluster into maintenance mode can be executed as user <span class="emphasis"><em>root</em></span> or <span class="emphasis"><em>sidadm</em></span>.</p><p>As user <span class="emphasis"><em>root</em></span>, type the following command:</p><pre class="screen"># crm configure property maintenance-mode="true"</pre><p>As user <span class="emphasis"><em>en2adm</em></span>, type the following command (the full path is needed):</p><pre class="screen"># /usr/sbin/crm configure property maintenance-mode="true"</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-stopping-the-cluster-maintenance"></a>Stopping the Cluster Maintenance</h4></div></div></div><p>The procedure to end the maintenance mode for the cluster can be executed as user <span class="emphasis"><em>root</em></span>.
Type the following command:</p><pre class="screen"># crm configure property maintenance-mode="false"</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-starting-the-resource-maintenance-mode"></a>Starting the Resource Maintenance Mode</h4></div></div></div><p>The procedure to start the resource maintenance mode can be executed as user <span class="emphasis"><em>en2adm</em></span>.
This sets the ASCS and ERS cluster resource to <span class="strong"><strong>unmanaged</strong></span>.</p><p>As user <span class="emphasis"><em>en2adm</em></span>, type the command:</p><pre class="screen"># sapcontrol -nr 00 -function HASetMaintenanceMode 1</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-stopping-the-resource-maintenance-mode"></a>Stopping the Resource Maintenance Mode</h4></div></div></div><p>The procedure to start the resource maintenance mode can be executed as user <span class="emphasis"><em>en2adm</em></span>.
This sets the ASCS and ERS cluster resource to <span class="strong"><strong>managed</strong></span>.</p><p>As user <span class="emphasis"><em>en2adm</em></span>, type the command:</p><pre class="screen"># sapcontrol -nr 00 -function HASetMaintenanceMode 0</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-cleaning-up-resources"></a>Cleaning Up Resources</h4></div></div></div><p>You can also <span class="strong"><strong>clean-up resource failures</strong></span>. Failures of the ASCS will be automatically
  deleted to allow a failback after the configured period of time. For all other
  resources, you can clean-up the status including the failures.</p><p>As user <span class="emphasis"><em>root</em></span>, type the following command:</p><pre class="screen"># crm resource cleanup RESOURCE-NAME</pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-testing-the-cluster"></a>Testing the Cluster</h3></div></div></div><p>It is strongly recommended to perform at least the following tests before you
go into production with your cluster:</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-checking-product-names-with-hagetfailoverconfig"></a>Checking Product Names with HAGetFailoverConfig</h4></div></div></div><p>Check if the name of the SUSE cluster solution is shown in the output of
  <span class="strong"><strong>sapcontrol</strong></span> or the SAP management console. This test checks the status of the
  SAP NetWeaver cluster integration.</p><p>As user <span class="emphasis"><em>en2adm</em></span>, type the following command:</p><pre class="screen"># sapcontrol -nr 00 -function HAGetFailoverConfig</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-running-sap-checks-using-hacheckconfig-and-hacheckfailoverconfig"></a>Running SAP Checks Using HACheckConfig and HACheckFailoverConfig</h4></div></div></div><p>Check if the HA configuration tests are passed successfully and do not produce error messages.</p><p>As user <span class="emphasis"><em>en2adm</em></span>, type the following commands:</p><pre class="screen"># sapcontrol -nr 00 -function HACheckConfig
# sapcontrol -nr 00 -function HACheckFailoverConfig</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-manually-migrating-ascs"></a>Manually Migrating ASCS</h4></div></div></div><p>Check if manually migrating the ASCS instance using HA tools works properly.</p><p>As user <span class="emphasis"><em>root</em></span>, run the following commands:</p><pre class="screen"># crm resource migrate rsc_sap_EN2_ASCS00 force
## wait until the ASCS is been migrated to the ERS host
# crm resource unmigrate rsc_sap_EN2_ASCS00</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-migrating-ascs-using-hafailovertonode"></a>Migrating ASCS Using HAFailoverToNode</h4></div></div></div><p>Check if moving the ASCS instance using SAP tools like sapcontrol works properly.</p><p>As user <span class="emphasis"><em>en2adm</em></span>, type the following command:</p><pre class="screen"># sapcontrol -nr 00 -function HAFailoverToNode ""</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-test-ascs-migration-after-os-failure"></a>Test ASCS Migration After OS Failure</h4></div></div></div><p>Check if the ASCS instance moves correctly after a node failure.
This test will immediately trigger a hard reboot of the node.</p><p>As user <span class="emphasis"><em>root</em></span>, type the following command:</p><pre class="screen">## on the ASCS host
# echo b &gt;/proc/sysrq-trigger</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-restarting-ascs-in-place-using-stop-and-start"></a>Restarting ASCS In-Place Using Stop and Start</h4></div></div></div><p>Check if the in-place restart of the SAP resources have been processed
  correctly. The SAP instance should not failover to an other node, it
  must start on the same node where it has been stopped.</p><p>As user <span class="emphasis"><em>en2adm</em></span>, do the following:</p><pre class="screen">## example for ASCS
# sapcontrol -nr 00 -function Stop
## wait till the ASCS is completely down
# sapcontrol -nr 00 -function Start</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-automated-restart-of-the-ascs-instance-simulating-rolling-kernel-switch"></a>Automated Restart of the ASCS Instance (Simulating Rolling Kernel Switch)</h4></div></div></div><p>The next test should proof that the cluster solution did nor interact neither try to restart the ASCS instance
during a maintenance procedure. In addition, it should verify that no locks are lost during the restart of
an ASCS instance during an RKS procedure. The cluster solution should recognize that the restart of
the ASCS instance was expected. No failure or error should be reported or counted.</p><p>Optionally, you can set locks and verify that they still exist after the maintenance procedure. There are multiple
ways to do that. One example test can be performed as follows:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Log in to your SAP system and open the transaction SU01.</p></li><li class="listitem"><p>Create a new user. Do not finish the transaction to see the locks.</p></li><li class="listitem"><p>With the SAP MC / MMC, check if there are locks available.</p></li><li class="listitem"><p>Open the ASCS instance entry and go to <span class="emphasis"><em>Enqueue Locks</em></span>.</p></li><li class="listitem"><p>With the transaction SM12, you can also see the locks.</p></li></ol></div><p>Do this test multiple times in a short time frame. The restart of the ASCS instance in the example below happens five times.</p><p>As user <span class="emphasis"><em>en2adm</em></span>, create and execute the following script:</p><pre class="screen">$ cat ascs_restart.sh
#!/bin/bash
for lo in 1 2 3 4 5; do
  echo LOOP "$lo - Restart ASCS00"
  sapcontrol -host sapen2as -nr 00 -function StopWait 120 1
  sleep 1
  sapcontrol -host sapen2as -nr 00 -function StartWait 120 1
  sleep 1
done</pre><pre class="screen">$ bash ascs_restart.sh</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-rolling-kernel-switch-procedure"></a>Rolling Kernel Switch Procedure</h4></div></div></div><p>The rolling kernel switch (RKS) is an automated procedure that enables the kernel in an ABAP system
to be exchanged without any system downtime. During an RKS, all instances of the system, and
generally all SAP start services (sapstartsrv), are restarted.</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>Check in SAP note 953653 whether the new kernel patch is RKS compatible to your currently running kernel.</p></li><li class="listitem"><p>Check SAP note 2077934 - Rolling kernel switch in HA environments.</p></li><li class="listitem"><p>Download the new kernel from the SAP service market place.</p></li><li class="listitem"><p>Make a backup of your current central kernel directory.</p></li><li class="listitem"><p>Extract the new kernel archive to the central kernel directory.</p></li><li class="listitem"><p>Start the RKS via SAP MMC, system overview (transaction SM51) or via command line.</p></li><li class="listitem"><p>Monitor and check the version of your SAP instances with the SAP MC / MMC or with <span class="strong"><strong>sapcontrol</strong></span>.</p></li></ol></div><p>As user <span class="emphasis"><em>en2adm</em></span>, type the following commands:</p><pre class="screen">## sapcontrol [-user &lt;sidadm psw&gt;] -host &lt;host&gt; -nr &lt;INSTANCE_NR&gt; -function UpdateSystem 120 300 1
# sapcontrol -user en2adm &lt;use-your-secure-pwd&gt; -host sapen2as -nr 00 -function UpdateSystem 120 300 1
# sapcontrol -nr 00 -function GetSystemUpdateList -host sapen2as \
  -user en2adm &lt;use-your-secure-pwd&gt;
# sapcontrol -nr 00 -function GetVersionInfo -host sapen2as \
  -user en2adm &lt;use-your-secure-pwd&gt;
# sapcontrol -nr 10 -function GetVersionInfo -host sapen2er \
  -user en2adm &lt;use-your-secure-pwd&gt;
# sapcontrol -nr 01 -function GetVersionInfo -host sapen2d1 \
  -user en2adm &lt;use-your-secure-pwd&gt;
# sapcontrol -nr 02 -function GetVersionInfo -host sapen2d2 \
  -user en2adm &lt;use-your-secure-pwd&gt;</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-additional-tests"></a>Additional Tests</h4></div></div></div><p>In addition to the already performed tests, you should do the following:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Check the recoverable and non-recoverable outage of the message server process.</p></li><li class="listitem"><p>Check the non-recoverable outage of the SAP enqueue server process.</p></li><li class="listitem"><p>Check the outage of the SAP Enqueue Replication Server 2.</p></li><li class="listitem"><p>Check the outage and restart of sapstartsrv.</p></li><li class="listitem"><p>Check the simulation of an upgrade.</p></li><li class="listitem"><p>Check the simulation of cluster resource failures.</p></li></ul></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-multi-node-cluster-setups-for-an-sap-s4hana"></a>Multi-Node Cluster Setups for an SAP S/4HANA</h2></div></div></div><p><a id="multicluster"></a><span class="strong"><strong>Multinode cluster</strong></span> setups mean cluster configurations with more than two nodes.
Depending from the starting point it is possible to extend a two node cluster setup or directly start with
more than two nodes for an ASCS / ERS high availability setup.
The examples below will show the setting up of Multi-node cluster and the extension of an existing two node cluster pair. The major configuration changes
will be shown and the basic preparation of the new cluster member node.</p><p>The task list to set up the three node cluster is similar to the task list of the two node cluster. But some
details are described different here to get a diskless SBD setup.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-extend-an-existing-two-node-cluster-configuration"></a>Extend An Existing Two Node Cluster Configuration</h3></div></div></div><div class="orderedlist"><p class="title"><strong>Tasks</strong></p><ol class="orderedlist" type="1"><li class="listitem"><p>Backup the current cluster</p></li><li class="listitem"><p>OS installation new node</p></li><li class="listitem"><p>Patching the existing nodes</p></li><li class="listitem"><p>Preparing the New Node’s Operating System</p></li><li class="listitem"><p>SAP preparation</p></li><li class="listitem"><p>Installing the cluster software on the new node</p></li><li class="listitem"><p>joining the cluster</p></li><li class="listitem"><p>Test the new cluster configuration</p></li></ol></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-backup-the-current-cluster"></a>Backup the Current Cluster</h4></div></div></div><p>Backup the current. cluster</p><div class="informalexample"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Backup your system</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>cluster configuration</p></li><li class="listitem"><p>corosync.conf</p></li><li class="listitem"><p>all data and configuration which are important and customized and not default</p></li></ul></div></li></ul></div><p>The system is configured as described in the SUSE Best Practices document
<span class="emphasis"><em>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - Setup Guide</em></span>.</p><p><strong>Backing Up the Cluster Configuration. </strong>Go to one of the cluster nodes and safe the cluster configuration with <span class="emphasis"><em>crm</em></span> and <span class="emphasis"><em>crm report</em></span> commands:</p><pre class="screen"># crm configure save 2node.txt</pre><pre class="screen"># crm report</pre><p>Back up the existing /etc/corosync/corosync.conf and all other files which may be important for a restore.
This example is one method creating a backup. The important point is using an <span class="strong"><strong>external</strong></span> destination.</p><pre class="screen"># tar cvf /&lt;path to an <span class="strong"><strong>external</strong></span> storage&gt;/bck_2nodes_configuration.tar \
      /etc/corosync/corosync.conf \
      2node.txt \
      &lt;crm report files&gt;
      &lt;add your additional files here&gt;</pre></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-os-installation-of-the-new-cluster-node-member"></a>OS Installation of The New Cluster Node Member</h4></div></div></div><p>We recommend using automating the installation to ensure that the system setup across nodes is identical.
Make sure to document any additional steps you take beyond the automated setup. In our example, we
deploy our machines with an AutoYaST configuration file and run a post step script which does the basic
configuration.</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-patching-existing-nodes"></a>Patching Existing Nodes</h4></div></div></div><p>If applicable, install the latest updates and patches on your existing nodes.
Alternatively, if you are using frozen repositories such as those provided by SUSE Manager,
add the new system to the same repositories, so they have the same patch level as your
existing nodes.</p><p>Use <span class="strong"><strong>zypper patch</strong></span> or <span class="strong"><strong>zypper update</strong></span> depending on your company’s rules.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>It is recommended installing the latest available patches to guarantee system stability and hardening.
Bug fixing and security patches help avoid unplanned outages and make the system less vulnerable.</p></li></ul></div><p>There are multiple ways:</p><pre class="screen"># zypper patch --category security
<span class="marked"> or
# zypper patch --severity important
</span> or
# zypper patch
## or
# zypper update</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-preparing-the-new-nodes-operating-system"></a>Preparing the New Node’s Operating System</h4></div></div></div><div class="example"><a id="id2235"></a><p class="title"><strong>Example 12. Check for valid DNS, time synchronization, network settings</strong></p><div class="example-contents"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Verify that DNS is working:</p><pre class="screen"># ping &lt;hostname&gt;</pre></li><li class="listitem"><p>Set up <span class="strong"><strong>NTP Client</strong></span> (this is best done with <span class="strong"><strong>yast2</strong></span>) and enable it:</p><pre class="screen"># yast ntp-client</pre></li><li class="listitem"><p>Check the network settings:</p><pre class="screen"># ip r</pre></li></ul></div></div></div><br class="example-break" /><p>You may run into trouble if there is no valid or no default route configured.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Patch the new system like the existing nodes, verify that your systems have the same patch level and
that all required reboots have been performed.</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-installing-cluster-software-on-the-new-node"></a>Installing Cluster Software on the New Node</h4></div></div></div><div class="example"><a id="id2255"></a><p class="title"><strong>Example 13. Installing packages</strong></p><div class="example-contents"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Install the pattern <span class="strong"><strong>ha_sles</strong></span> on the new cluster node:</p><pre class="screen"># zypper in -t pattern ha_sles</pre></li><li class="listitem"><p>Install the package <span class="strong"><strong>sap-suse-cluster-connector</strong></span> version 3.1.0 from the SUSE repositories:</p><pre class="screen"># zypper in sap-suse-cluster-connector</pre></li></ul></div></div></div><br class="example-break" /><p>After installing all necessary packages, compare installed package versions.</p><div class="example"><a id="id2267"></a><p class="title"><strong>Example 14. Check that all nodes have the same software packages and versions</strong></p><div class="example-contents"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>On the existing cluster nodes:</p><pre class="screen"># rpm -qa | sort &gt;rpm_valuga11.log</pre></li><li class="listitem"><p>On the new node:</p><pre class="screen"># rpm -qa | sort &gt;rpm_valuga13.log</pre></li><li class="listitem"><p>Copy the file from one node to the other and compare the two versions:</p><pre class="screen"># vimdiff rpm_valuga13.log rpm_valuga11.log</pre></li></ul></div></div></div><br class="example-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>If there any differences fix them first before you proceed.</p></div><div class="example"><a id="id2281"></a><p class="title"><strong>Example 15. Install and configure the watchdog device on the new machine.</strong></p><div class="example-contents"><p>Instead of deploying the software-based solution, preferably use a hardware-based watchdog device.
The following example uses the software device but can be easily adapted to the hardware device.</p><pre class="screen"># modprobe softdog
# echo softdog &gt; /etc/modules-load.d/watchdog.conf
# systemctl restart systemd-modules-load
# lsmod | egrep "(wd|dog|i6|iT|ibm)"</pre></div></div><br class="example-break" /><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>Ensure that the new node is connected to the same SBD disk connected to the existing two nodes. Ensure that the new node has the same exact SBD configurations already exist on the two existing nodes</p></div><pre class="screen"># sbd -d /dev/disk/by-id/SUSE-Example-A-part1 dump</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-preparing-the-sap-installation-on-the-new-node"></a>Preparing the SAP Installation on the New Node</h4></div></div></div><p>With SWPM 2.0 (SP4 or later), which is part of the SL Toolset, SAP provides a new option which can perform all necessary steps to prepare a fresh
install server to be able to fit into an existing SAP system. This new option will help us to prepare a
new host which can later run either the ASCS or ERS in the cluster environment.</p><p>You need to create the directory structure that should run the SAP resource.
The SYS directory is located on an NFS share for all nodes.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Create mount points and mount NFS shares on the new added node (valuga13):</p></li></ul></div><div class="example"><a id="id2295"></a><p class="title"><strong>Example 16. Mount NFS Shares on valuga13</strong></p><div class="example-contents"><pre class="screen"># mkdir -p /sapmnt /var/lib/Landscape
# mkdir -p /usr/sap/EN2/{ASCS00,ERS10,SYS}
# mount -t nfs 192.168.1.1:/data/export/S4_HA_CLU_10/EN2/sapmnt    /sapmnt
# mount -t nfs 192.168.1.1:/data/export/S4_HA_CLU_10/EN2/SYS /usr/sap/EN2/SYS
# mount -t nfs 192.168.1.1:/Landscape /var/lib/Landscape</pre></div></div><br class="example-break" /><p>As this directory needs to be available at all time, make sure it is mounted during boot. This can be
achieved by put the information into the /etc/fstab.</p><p>In the next step the following information are required:
- profile directory
- password for SAP System Administrator
- UID for sapadm</p><pre class="screen"># cd /var/lib/Landscape/media/SAP-media/SWPM20_P9/
# ./sapinst</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SWPM product installation path:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Installing SAP S/4HANA Server 1809  → SAP HANA DATABASE → Installation → Application Server ABAP
→ High-Availability System → Prepare Additional Host</p></li></ul></div></li><li class="listitem"><p>Use /sapmnt/EN2/profile for the profile directory</p></li><li class="listitem"><p>All passwords: &lt;use-your-secure-pwd&gt;</p></li><li class="listitem"><p>UID for sapadm: 2002</p></li></ul></div><div class="example"><a id="id2313"></a><p class="title"><strong>Example 17. Post Step Procedure after SAP Preparation Step</strong></p><div class="example-contents"><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Add the user <span class="emphasis"><em>en2adm</em></span> to the unix user group <span class="emphasis"><em>haclient</em></span>.</p><pre class="screen"># usermod -a -G haclient en2adm</pre></li><li class="listitem"><p>Create the file <span class="emphasis"><em>/usr/sap/sapservices</em></span>  or copy it from one of your existing cluster nodes.</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>This must be done for each instance. Call sapstartsrv with parameters <span class="strong"><strong>pf=</strong></span>&lt;profile-of-the-sap-instance&gt; and <span class="strong"><strong>-reg</strong></span>.</p></div><p>The following commands register the ASCS and the ERS SAP instance:</p><pre class="screen">##  create them with sapstartsrv
# LD_LIBRARY_PATH=/usr/sap/hostctrl/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH
# /usr/sap/hostctrl/exe/sapstartsrv pf=/usr/sap/&lt;SID&gt;/SYS/profile/&lt;SID&gt;_ERS&lt;instanceNumberErs&gt;_&lt;virtHostNameErs&gt; -reg
# /usr/sap/hostctrl/exe/sapstartsrv pf=/usr/sap/&lt;SID&gt;/SYS/profile/&lt;SID&gt;_ASCS&lt;instanceNumberAscs&gt;_&lt;virtHostNameAscs&gt; -reg</pre></li><li class="listitem"><p>Alternatively copy the file</p><pre class="screen"># scp -p valuga11:/usr/sap/sapservices /usr/sap/</pre></li><li class="listitem"><p>Finally check the file</p><pre class="screen"># cat /usr/sap/sapservices
#!/bin/sh
LD_LIBRARY_PATH=/usr/sap/EN2/ASCS00/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; /usr/sap/EN2/ASCS00/exe/sapstartsrv pf=/usr/sap/EN2/SYS/profile/EN2_ASCS00_sapen2as -D -u en2adm
LD_LIBRARY_PATH=/usr/sap/EN2/ERS10/exe:$LD_LIBRARY_PATH; export LD_LIBRARY_PATH; /usr/sap/EN2/ERS10/exe/sapstartsrv pf=/usr/sap/EN2/SYS/profile/EN2_ERS10_sapen2er -D -u en2adm</pre></li></ul></div></div></div><br class="example-break" /><div class="example"><a id="id2336"></a><p class="title"><strong>Example 18. Add the New Node to the Cluster</strong></p><div class="example-contents"><p>Check if the SBD device is available in case the SBD stonith method is in place for the two nodes.
If the existing cluster using a different, supported stonith mechanism check and verify them too for the
new cluster node.</p><pre class="screen"># sbd -d /dev/disk/by-id/SUSE-Example-A-part1 dump</pre><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Joining the cluster with <span class="emphasis"><em>ha-cluster-join</em></span></p></li></ul></div><pre class="screen"># ha-cluster-join -c valuga11</pre><p>After the new node has joined into the cluster the configuration must be adapted to the new situation.
Double check if the join was successful and verify the <span class="emphasis"><em>/etc/corosync/corosync.conf</em></span></p><pre class="screen"># grep votes -n2 /etc/corosync/corosync.conf</pre><p>The values <span class="strong"><strong>expected_votes</strong></span> and <span class="strong"><strong>two_node</strong></span> should now look like this on all nodes:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>expected_votes: 3</p></li><li class="listitem"><p>two_node: 0</p></li></ul></div><p>Modify the cluster configuration and set a new colocation rule with <span class="emphasis"><em>crm</em></span>:</p><pre class="screen"># crm configure delete col_sap_EN2_no_both
# crm configure colocation ASCS00_ERS10_separated_EN2 -5000: grp_EN2_ERS10 grp_EN2_ASCS00</pre></div></div><br class="example-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="id-test-the-new-cluster-configuration"></a>Test the New Cluster Configuration</h4></div></div></div><p>It is highly recommended to run certain test to verify that the new configuration is working as expected.
A list of test can be found in the basic setup for the two node cluster above.</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-pros-and-cons-for-odd-and-even-numbers-of-cluster-nodes"></a>Pro’s and Con’s for Odd and Even Numbers of Cluster Nodes</h3></div></div></div><p>There are certain use cases and infrastructure requirements which end up in different installation setup’s.
We will cover some advantages and disadvantages of special configuration below:</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>The two node cluster and two locations</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Advantage: symmetric spread of all nodes over all locations</p></li><li class="listitem"><p>Disadvantage: no diskless SBD feature allowed for all two node clusters</p></li></ul></div></li><li class="listitem"><p>The two node cluster and more than two locations</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Advantage: SBD device can be provided from there (must be HA himself)</p></li><li class="listitem"><p>Advantage: cluster could operate with three SBD devices from different locations</p></li><li class="listitem"><p>Disadvantage: no diskless SBD feature allowed for all two node clusters</p></li></ul></div></li><li class="listitem"><p>The three node cluster and two locations</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Advantage: less complex infrastructure</p></li><li class="listitem"><p>Advantage: diskless SBD feature is allowed</p></li><li class="listitem"><p>Disadvantage: "pre selected" location (two node + one node)</p></li></ul></div></li><li class="listitem"><p>The three node cluster and three locations</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: circle; "><li class="listitem"><p>Advantage: symmetric spread of all nodes over all locations</p></li><li class="listitem"><p>Advantage: diskless SBD feature is allowed</p></li><li class="listitem"><p>Disadvantage: higher planing effort and complexity for infrastructure planning</p></li></ul></div></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-references"></a>References</h2></div></div></div><p>For more information, see the documents listed below.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-pacemaker"></a>Pacemaker</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>Pacemaker 1.1 Configuration Explained:
<a class="link" href="https://clusterlabs.org/pacemaker/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/" target="_top">https://clusterlabs.org/pacemaker/doc/en-US/Pacemaker/1.1/html/Pacemaker_Explained/</a></p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-related-suse-tid"></a>Related SUSE TID</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>SUSE SAP Best Practice Guide Errata (<a class="link" href="https://www.suse.com/support/kb/doc/?id=7023713" target="_top">https://www.suse.com/support/kb/doc/?id=7023713</a>)</p></li><li class="listitem"><p>SAP S/4 HANA - Enqueue Replication 2 High Availability Cluster - Setup Guide (<a class="link" href="https://www.suse.com/support/kb/doc/?id=7023714" target="_top">https://www.suse.com/support/kb/doc/?id=7023714</a>)</p></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-related-sap-notes"></a>Related SAP Notes</h3></div></div></div><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem"><p>953653 - Rolling Kernel Switch (<a class="link" href="https://launchpad.support.sap.com/#/notes/953653" target="_top">https://launchpad.support.sap.com/#/notes/953653</a>)</p></li><li class="listitem"><p>1092448 - IBM XL C/C++ runtime environment for Linux on system p (<a class="link" href="https://launchpad.support.sap.com/#/notes/1092448" target="_top">https://launchpad.support.sap.com/#/notes/1092448</a>)</p></li><li class="listitem"><p>1153713 - Problems with SAP Management Console (Java) (<a class="link" href="https://launchpad.support.sap.com/#/notes/1153713" target="_top">https://launchpad.support.sap.com/#/notes/1153713</a>)</p></li><li class="listitem"><p>1552925 - Linux: High Availability Cluster Solutions (<a class="link" href="https://launchpad.support.sap.com/#/notes/1552925" target="_top">https://launchpad.support.sap.com/#/notes/1552925</a>)</p></li><li class="listitem"><p>1619879 - licensing of HA/DR/cluster → invalid license (<a class="link" href="https://launchpad.support.sap.com/#/notes/1619879" target="_top">https://launchpad.support.sap.com/#/notes/1619879</a>)</p></li><li class="listitem"><p>1763512 - Support details for SUSE Linux Enterprise for SAP Applications (<a class="link" href="https://launchpad.support.sap.com/#/notes/1763512" target="_top">https://launchpad.support.sap.com/#/notes/1763512</a>)</p></li><li class="listitem"><p>1984787 - SUSE LINUX Enterprise Server 12: Installation notes (<a class="link" href="https://launchpad.support.sap.com/#/notes/1984787" target="_top">https://launchpad.support.sap.com/#/notes/1984787</a>)</p></li><li class="listitem"><p>2077934 - Rolling kernel switch in HA environments (<a class="link" href="https://launchpad.support.sap.com/#/notes/2077934" target="_top">https://launchpad.support.sap.com/#/notes/2077934</a>)</p></li><li class="listitem"><p>2235581 - SAP HANA: Supported Operating Systems (<a class="link" href="https://launchpad.support.sap.com/#/notes/2235581" target="_top">https://launchpad.support.sap.com/#/notes/2235581</a>)</p></li><li class="listitem"><p>2254173 - Linux: Rolling Kernel Switch in Pacemaker based NetWeaver HA environments (<a class="link" href="https://launchpad.support.sap.com/#/notes/2254173" target="_top">https://launchpad.support.sap.com/#/notes/2254173</a>)</p></li><li class="listitem"><p>2369910 - SAP Software on Linux: General information (<a class="link" href="https://launchpad.support.sap.com/#/notes/2369910" target="_top">https://launchpad.support.sap.com/#/notes/2369910</a>)</p></li><li class="listitem"><p>2464065 - Check of automatic maintenance mode for HA solutions (<a class="link" href="https://launchpad.support.sap.com/#/notes/2464065" target="_top">https://launchpad.support.sap.com/#/notes/2464065</a>)</p></li><li class="listitem"><p>2578899 - SUSE Linux Enterprise Server 15: Installation Note (<a class="link" href="https://launchpad.support.sap.com/#/notes/2578899" target="_top">https://launchpad.support.sap.com/#/notes/2578899</a>)</p></li><li class="listitem"><p>2630416 - Support for Standalone Enqueue Server 2 (<a class="link" href="https://launchpad.support.sap.com/#/notes/2630416" target="_top">https://launchpad.support.sap.com/#/notes/2630416</a>)</p></li><li class="listitem"><p>2641019 - Installation of ENSA2 and update from ENSA1 to ENSA2 in SUSE HA environment (<a class="link" href="https://launchpad.support.sap.com/#/notes/2641019" target="_top">https://launchpad.support.sap.com/#/notes/2641019</a>)</p></li><li class="listitem"><p>2684254 - SAP HANA DB: Recommended OS settings for SLES 15 / SLES for SAP Applications 15 (<a class="link" href="https://launchpad.support.sap.com/#/notes/2684254" target="_top">https://launchpad.support.sap.com/#/notes/2684254</a>)</p></li><li class="listitem"><p>2711036 - Usage of the Standalone Enqueue Server 2 in an HA Environment (<a class="link" href="https://launchpad.support.sap.com/#/notes/2711036" target="_top">https://launchpad.support.sap.com/#/notes/2711036</a>)</p></li></ul></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-appendix"></a>Appendix</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-crm-configuration"></a>CRM Configuration</h3></div></div></div><p>Find below the complete crm configuration for SAP system EN2. This example
is for the two node cluster. In multi node cluster you will find additional node entries
like <span class="strong"><strong>node 3: valuga13</strong></span>.</p><pre class="screen">node 1: valuga11
node 2: valuga12
primitive rsc_fs_EN2_ASCS00 Filesystem \
    params device="/dev/disk/by-id/SUSE-Example-A-part2" \
    directory="/usr/sap/EN2/ASCS00" \
    fstype=xfs \
    op start timeout=60s interval=0 \
    op stop timeout=60s interval=0 \
    op monitor interval=20s timeout=40s
primitive rsc_fs_EN2_ERS10 Filesystem \
    params device="/dev/disk/by-id/SUSE-Example-A-part3" \
    directory="/usr/sap/EN2/ERS10" \
    fstype=xfs \
    op start timeout=60s interval=0 \
    op stop timeout=60s interval=0 \
    op monitor interval=20s timeout=40s
primitive rsc_ip_EN2_ASCS00 IPaddr2 \
    params ip=192.168.1.112 \
    op monitor interval=10s timeout=20s
primitive rsc_ip_EN2_ERS10 IPaddr2 \
    params ip=192.168.1.113 \
    op monitor interval=10s timeout=20s
primitive rsc_sap_EN2_ASCS00 SAPInstance \
    operations $id=rsc_sap_EN2_ASCS00-operations \
    op monitor interval=11 timeout=60 on-fail=restart \
    params InstanceName=EN2_ASCS00_sapen2as \
    START_PROFILE="/sapmnt/EN2/profile/EN2_ASCS00_sapen2as" \
    AUTOMATIC_RECOVER=false \
    meta resource-stickiness=5000
primitive rsc_sap_EN2_ERS10 SAPInstance \
    operations $id=rsc_sap_EN2_ERS10-operations \
    op monitor interval=11 timeout=60 on-fail=restart \
    params InstanceName=EN2_ERS10_sapen2er \
    START_PROFILE="/sapmnt/EN2/profile/EN2_ERS10_sapen2er" \
    AUTOMATIC_RECOVER=false IS_ERS=true
primitive stonith-sbd stonith:external/sbd \
    params pcmk_delay_max=30s
group grp_EN2_ASCS00 rsc_ip_EN2_ASCS00 rsc_fs_EN2_ASCS00 \
    rsc_sap_EN2_ASCS00 \
    meta resource-stickiness=3000
group grp_EN2_ERS10 rsc_ip_EN2_ERS10 rsc_fs_EN2_ERS10 \
    rsc_sap_EN2_ERS10
colocation col_sap_EN2_not_both -5000: grp_EN2_ERS10 grp_EN2_ASCS00
order ord_sap_EN2_first_ascs Optional: rsc_sap_EN2_ASCS00:start \
    rsc_sap_EN2_ERS10:stop symmetrical=false
property cib-bootstrap-options: \
    have-watchdog=true \
    cluster-infrastructure=corosync \
    cluster-name=hacluster \
    stonith-enabled=true \
    placement-strategy=balanced
rsc_defaults rsc-options: \
    resource-stickiness=1 \
    migration-threshold=3
op_defaults op-options: \
    timeout=600 \
    record-pending=true</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-corosync-configuration-of-the-two-node-cluster"></a>Corosync Configuration of the Two Node Cluster</h3></div></div></div><p>Find below the Corosync configuration.</p><pre class="screen"># cat /etc/corosync/corosync.conf
# Please read the corosync.conf.5 manual page
totem {
    version: 2
    secauth: on
    crypto_hash: sha1
    crypto_cipher: aes256
    cluster_name: hacluster
    clear_node_high_bit: yes
    token: 5000
    token_retransmits_before_loss_const: 10
    join: 60
    consensus: 6000
    max_messages: 20
    interface {
        ringnumber: 0
        mcastport: 5405
        ttl: 1
    }

    transport: udpu
}

logging {
    fileline: off
    to_stderr: no
    to_logfile: no
    logfile: /var/log/cluster/corosync.log
    to_syslog: yes
    debug: off
    timestamp: on
    logger_subsys {
        subsys: QUORUM
        debug: off
    }

}

nodelist {
    node {
        ring0_addr: 192.168.1.103
        nodeid: 1
    }

    node {
        ring0_addr: 192.168.1.104
        nodeid: 2
    }

}

quorum {

    # Enable and configure quorum subsystem (default: off)
    # see also corosync.conf.5 and votequorum.5
    provider: corosync_votequorum
    expected_votes: 2
    two_node: 1
}</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-corosync-configuration-of-the-multi-node-cluster"></a>Corosync Configuration of the multi Node Cluster</h3></div></div></div><pre class="screen">	# Please read the corosync.conf.5 manual page
	totem {
		version: 2
		secauth: on
		crypto_hash: sha1
		crypto_cipher: aes256
		cluster_name: hacluster
		clear_node_high_bit: yes
		token: 5000
		token_retransmits_before_loss_const: 10
		join: 60
		consensus: 6000
		max_messages: 20
		interface {
			ringnumber: 0
			mcastport: 5405
			ttl: 1
		}

		transport: udpu
	}

	logging {
		fileline: off
		to_stderr: no
		to_logfile: no
		logfile: /var/log/cluster/corosync.log
		to_syslog: yes
		debug: off
		timestamp: on
		logger_subsys {
			subsys: QUORUM
			debug: off
		}

	}

	nodelist {
		node {
			ring0_addr: 192.168.1.103
			nodeid: 1
		}

		node {
			ring0_addr: 192.168.1.104
			nodeid: 2
		}

		node {
			ring0_addr: 192.168.1.105
			nodeid: 3
		}

	}

	quorum {

		# Enable and configure quorum subsystem (default: off)
		# see also corosync.conf.5 and votequorum.5
		provider: corosync_votequorum
		expected_votes: 3
		two_node: 0
	}</pre></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id-legal-notice"></a>Legal Notice</h2></div></div></div><p>Copyright © 2006–2022 SUSE LLC and contributors. All rights reserved.</p><p>Permission is granted to copy, distribute and/or modify this document under the terms of
the GNU Free Documentation License, Version 1.2 or (at your option) version 1.3; with the
Invariant Section being this copyright notice and license. A copy of the license version 1.2
is included in the section entitled "GNU Free Documentation License".</p><p>SUSE, the SUSE logo and YaST are registered trademarks of SUSE LLC in the United States
and other countries. For SUSE trademarks, see <a class="link" href="https://www.suse.com/company/legal/" target="_top">https://www.suse.com/company/legal/</a>.</p><p>Linux is a registered trademark of Linus Torvalds. All other names or trademarks mentioned in
this document may be trademarks or registered trademarks of their respective owners.</p><p>Documents published as part of the SUSE Best Practices series have been contributed voluntarily
by SUSE employees and third parties. They are meant to serve as examples of how particular
actions can be performed. They have been compiled with utmost attention to detail.
However, this does not guarantee complete accuracy. SUSE cannot verify that actions described
in these documents do what is claimed or whether actions described have unintended consequences.
SUSE LLC, its affiliates, the authors, and the translators may not be held liable for possible errors
or the consequences thereof.</p><p>Below we draw your attention to the license under which the articles are published.</p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="id-gnu-free-documentation-license"></a>GNU Free Documentation License</h3></div></div></div><p>Copyright © 2000, 2001, 2002 Free Software Foundation, Inc.
51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
Everyone is permitted to copy and distribute verbatim copies of this license document, but changing it is not allowed.</p><h4><a id="id-0-preamble"></a>0. PREAMBLE</h4><p>The purpose of this License is to make a manual, textbook, or other functional and useful document "free" in the sense of freedom: to assure everyone the effective freedom to copy and redistribute it, with or without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way to get credit for their work, while not being considered responsible for modifications made by others.</p><p>This License is a kind of "copyleft", which means that derivative works of the document must themselves be free in the same sense.
It complements the GNU General Public License, which is a copyleft license designed for free software.</p><p>We have designed this License in order to use it for manuals for free software, because free software needs free documentation: a free program should come with manuals providing the same freedoms that the software does.
But this License is not limited to software manuals; it can be used for any textual work, regardless of subject matter or whether it is published as a printed book.
We recommend this License principally for works whose purpose is instruction or reference.</p><h4><a id="id-1-applicability-and-definitions"></a>1. APPLICABILITY AND DEFINITIONS</h4><p>This License applies to any manual or other work, in any medium, that contains a notice placed by the copyright holder saying it can be distributed under the terms of this License.
Such a notice grants a world-wide, royalty-free license, unlimited in duration, to use that work under the conditions stated herein.
The "Document", below, refers to any such manual or work.
Any member of the public is a licensee, and is addressed as "you". You accept the license if you copy, modify or distribute the work in a way requiring permission under copyright law.</p><p>A "Modified Version" of the Document means any work containing the Document or a portion of it, either copied verbatim, or with modifications and/or translated into another language.</p><p>A "Secondary Section" is a named appendix or a front-matter section of the Document that deals exclusively with the relationship of the publishers or authors of the Document to the Document’s overall subject (or to related matters) and contains nothing that could fall directly within that overall subject.
(Thus, if the Document is in part a textbook of mathematics, a Secondary Section may not explain any mathematics.) The relationship could be a matter of historical connection with the subject or with related matters, or of legal, commercial, philosophical, ethical or political position regarding them.</p><p>The "Invariant Sections" are certain Secondary Sections whose titles are designated, as being those of Invariant Sections, in the notice that says that the Document is released under this License.
If a section does not fit the above definition of Secondary then it is not allowed to be designated as Invariant.
The Document may contain zero Invariant Sections.
If the Document does not identify any Invariant Sections then there are none.</p><p>The "Cover Texts" are certain short passages of text that are listed, as Front-Cover Texts or Back-Cover Texts, in the notice that says that the Document is released under this License.
A Front-Cover Text may be at most 5 words, and a Back-Cover Text may be at most 25 words.</p><p>A "Transparent" copy of the Document means a machine-readable copy, represented in a format whose specification is available to the general public, that is suitable for revising the document straightforwardly with generic text editors or (for images composed of pixels) generic paint programs or (for drawings) some widely available drawing editor, and that is suitable for input to text formatters or for automatic translation to a variety of formats suitable for input to text formatters.
A copy made in an otherwise Transparent file format whose markup, or absence of markup, has been arranged to thwart or discourage subsequent modification by readers is not Transparent.
An image format is not Transparent if used for any substantial amount of text.
A copy that is not "Transparent" is called "Opaque".</p><p>Examples of suitable formats for Transparent copies include plain ASCII without markup, Texinfo input format, LaTeX input format, SGML or XML using a publicly available DTD, and standard-conforming simple HTML, PostScript or PDF designed for human modification.
Examples of transparent image formats include PNG, XCF and JPG.
Opaque formats include proprietary formats that can be read and edited only by proprietary word processors, SGML or XML for which the DTD and/or processing tools are not generally available, and the machine-generated HTML, PostScript or PDF produced by some word processors for output purposes only.</p><p>The "Title Page" means, for a printed book, the title page itself, plus such following pages as are needed to hold, legibly, the material this License requires to appear in the title page.
For works in formats which do not have any title page as such, "Title Page" means the text near the most prominent appearance of the work’s title, preceding the beginning of the body of the text.</p><p>A section "Entitled XYZ" means a named subunit of the Document whose title either is precisely XYZ or contains XYZ in parentheses following text that translates XYZ in another language.
(Here XYZ stands for a specific section name mentioned below, such as "Acknowledgements", "Dedications", "Endorsements", or "History".) To "Preserve the Title" of such a section when you modify the Document means that it remains a section "Entitled XYZ" according to this definition.</p><p>The Document may include Warranty Disclaimers next to the notice which states that this License applies to the Document.
These Warranty Disclaimers are considered to be included by reference in this License, but only as regards disclaiming warranties: any other implication that these Warranty Disclaimers may have is void and has no effect on the meaning of this License.</p><h4><a id="id-2-verbatim-copying"></a>2. VERBATIM COPYING</h4><p>You may copy and distribute the Document in any medium, either commercially or noncommercially, provided that this License, the copyright notices, and the license notice saying this License applies to the Document are reproduced in all copies, and that you add no other conditions whatsoever to those of this License.
You may not use technical measures to obstruct or control the reading or further copying of the copies you make or distribute.
However, you may accept compensation in exchange for copies.
If you distribute a large enough number of copies you must also follow the conditions in section 3.</p><p>You may also lend copies, under the same conditions stated above, and you may publicly display copies.</p><h4><a id="id-3-copying-in-quantity"></a>3. COPYING IN QUANTITY</h4><p>If you publish printed copies (or copies in media that commonly have printed covers) of the Document, numbering more than 100, and the Document’s license notice requires Cover Texts, you must enclose the copies in covers that carry, clearly and legibly, all these Cover Texts: Front-Cover Texts on the front cover, and Back-Cover Texts on the back cover.
Both covers must also clearly and legibly identify you as the publisher of these copies.
The front cover must present the full title with all words of the title equally prominent and visible.
You may add other material on the covers in addition.
Copying with changes limited to the covers, as long as they preserve the title of the Document and satisfy these conditions, can be treated as verbatim copying in other respects.</p><p>If the required texts for either cover are too voluminous to fit legibly, you should put the first ones listed (as many as fit reasonably) on the actual cover, and continue the rest onto adjacent pages.</p><p>If you publish or distribute Opaque copies of the Document numbering more than 100, you must either include a machine-readable Transparent copy along with each Opaque copy, or state in or with each Opaque copy a computer-network location from which the general network-using public has access to download using public-standard network protocols a complete Transparent copy of the Document, free of added material.
If you use the latter option, you must take reasonably prudent steps, when you begin distribution of Opaque copies in quantity, to ensure that this Transparent copy will remain thus accessible at the stated location until at least one year after the last time you distribute an Opaque copy (directly or through your agents or retailers) of that edition to the public.</p><p>It is requested, but not required, that you contact the authors of the Document well before redistributing any large number of copies, to give them a chance to provide you with an updated version of the Document.</p><h4><a id="id-4-modifications"></a>4. MODIFICATIONS</h4><p>You may copy and distribute a Modified Version of the Document under the conditions of sections 2 and 3 above, provided that you release the Modified Version under precisely this License, with the Modified Version filling the role of the Document, thus licensing distribution and modification of the Modified Version to whoever possesses a copy of it.
In addition, you must do these things in the Modified Version:</p><div class="orderedlist"><ol class="orderedlist" type="A"><li class="listitem"><p>Use in the Title Page (and on the covers, if any) a title distinct from that of the Document, and from those of previous versions (which should, if there were any, be listed in the History section of the Document). You may use the same title as a previous version if the original publisher of that version gives permission.</p></li><li class="listitem"><p>List on the Title Page, as authors, one or more persons or entities responsible for authorship of the modifications in the Modified Version, together with at least five of the principal authors of the Document (all of its principal authors, if it has fewer than five), unless they release you from this requirement.</p></li><li class="listitem"><p>State on the Title page the name of the publisher of the Modified Version, as the publisher.</p></li><li class="listitem"><p>Preserve all the copyright notices of the Document.</p></li><li class="listitem"><p>Add an appropriate copyright notice for your modifications adjacent to the other copyright notices.</p></li><li class="listitem"><p>Include, immediately after the copyright notices, a license notice giving the public permission to use the Modified Version under the terms of this License, in the form shown in the Addendum below.</p></li><li class="listitem"><p>Preserve in that license notice the full lists of Invariant Sections and required Cover Texts given in the Document’s license notice.</p></li><li class="listitem"><p>Include an unaltered copy of this License.</p></li><li class="listitem"><p>Preserve the section Entitled "History", Preserve its Title, and add to it an item stating at least the title, year, new authors, and publisher of the Modified Version as given on the Title Page. If there is no section Entitled "History" in the Document, create one stating the title, year, authors, and publisher of the Document as given on its Title Page, then add an item describing the Modified Version as stated in the previous sentence.</p></li><li class="listitem"><p>Preserve the network location, if any, given in the Document for public access to a Transparent copy of the Document, and likewise the network locations given in the Document for previous versions it was based on. These may be placed in the "History" section. You may omit a network location for a work that was published at least four years before the Document itself, or if the original publisher of the version it refers to gives permission.</p></li><li class="listitem"><p>For any section Entitled "Acknowledgements" or "Dedications", Preserve the Title of the section, and preserve in the section all the substance and tone of each of the contributor acknowledgements and/or dedications given therein.</p></li><li class="listitem"><p>Preserve all the Invariant Sections of the Document, unaltered in their text and in their titles. Section numbers or the equivalent are not considered part of the section titles.</p></li><li class="listitem"><p>Delete any section Entitled "Endorsements". Such a section may not be included in the Modified Version.</p></li><li class="listitem"><p>Do not retitle any existing section to be Entitled "Endorsements" or to conflict in title with any Invariant Section.</p></li><li class="listitem"><p>Preserve any Warranty Disclaimers.</p></li></ol></div><p>If the Modified Version includes new front-matter sections or appendices that qualify as Secondary Sections and contain no material copied from the Document, you may at your option designate some or all of these sections as invariant.
To do this, add their titles to the list of Invariant Sections in the Modified Version’s license notice.
These titles must be distinct from any other section titles.</p><p>You may add a section Entitled "Endorsements", provided it contains nothing but endorsements of your Modified Version by various parties—​for example, statements of peer review or that the text has been approved by an organization as the authoritative definition of a standard.</p><p>You may add a passage of up to five words as a Front-Cover Text, and a passage of up to 25 words as a Back-Cover Text, to the end of the list of Cover Texts in the Modified Version.
Only one passage of Front-Cover Text and one of Back-Cover Text may be added by (or through arrangements made by) any one entity.
If the Document already includes a cover text for the same cover, previously added by you or by arrangement made by the same entity you are acting on behalf of, you may not add another; but you may replace the old one, on explicit permission from the previous publisher that added the old one.</p><p>The author(s) and publisher(s) of the Document do not by this License give permission to use their names for publicity for or to assert or imply endorsement of any Modified Version.</p><h4><a id="id-5-combining-documents"></a>5. COMBINING DOCUMENTS</h4><p>You may combine the Document with other documents released under this License, under the terms defined in section 4 above for modified versions, provided that you include in the combination all of the Invariant Sections of all of the original documents, unmodified, and list them all as Invariant Sections of your combined work in its license notice, and that you preserve all their Warranty Disclaimers.</p><p>The combined work need only contain one copy of this License, and multiple identical Invariant Sections may be replaced with a single copy.
If there are multiple Invariant Sections with the same name but different contents, make the title of each such section unique by adding at the end of it, in parentheses, the name of the original author or publisher of that section if known, or else a unique number.
Make the same adjustment to the section titles in the list of Invariant Sections in the license notice of the combined work.</p><p>In the combination, you must combine any sections Entitled "History" in the various original documents, forming one section Entitled "History"; likewise combine any sections Entitled "Acknowledgements", and any sections Entitled "Dedications". You must delete all sections Entitled "Endorsements".</p><h4><a id="id-6-collections-of-documents"></a>6. COLLECTIONS OF DOCUMENTS</h4><p>You may make a collection consisting of the Document and other documents released under this License, and replace the individual copies of this License in the various documents with a single copy that is included in the collection, provided that you follow the rules of this License for verbatim copying of each of the documents in all other respects.</p><p>You may extract a single document from such a collection, and distribute it individually under this License, provided you insert a copy of this License into the extracted document, and follow this License in all other respects regarding verbatim copying of that document.</p><h4><a id="id-7-aggregation-with-independent-works"></a>7. AGGREGATION WITH INDEPENDENT WORKS</h4><p>A compilation of the Document or its derivatives with other separate and independent documents or works, in or on a volume of a storage or distribution medium, is called an "aggregate" if the copyright resulting from the compilation is not used to limit the legal rights of the compilation’s users beyond what the individual works permit.
When the Document is included in an aggregate, this License does not apply to the other works in the aggregate which are not themselves derivative works of the Document.</p><p>If the Cover Text requirement of section 3 is applicable to these copies of the Document, then if the Document is less than one half of the entire aggregate, the Document’s Cover Texts may be placed on covers that bracket the Document within the aggregate, or the electronic equivalent of covers if the Document is in electronic form.
Otherwise they must appear on printed covers that bracket the whole aggregate.</p><h3><a id="id-8-translation"></a>8. TRANSLATION</h3><p>Translation is considered a kind of modification, so you may distribute translations of the Document under the terms of section 4.
Replacing Invariant Sections with translations requires special permission from their copyright holders, but you may include translations of some or all Invariant Sections in addition to the original versions of these Invariant Sections.
You may include a translation of this License, and all the license notices in the Document, and any Warranty Disclaimers, provided that you also include the original English version of this License and the original versions of those notices and disclaimers.
In case of a disagreement between the translation and the original version of this License or a notice or disclaimer, the original version will prevail.</p><p>If a section in the Document is Entitled "Acknowledgements", "Dedications", or "History", the requirement (section 4) to Preserve its Title (section 1) will typically require changing the actual title.</p><h4><a id="id-9-termination"></a>9. TERMINATION</h4><p>You may not copy, modify, sublicense, or distribute the Document except as expressly provided for under this License.
Any other attempt to copy, modify, sublicense or distribute the Document is void, and will automatically terminate your rights under this License.
However, parties who have received copies, or rights, from you under this License will not have their licenses terminated so long as such parties remain in full compliance.</p><h4><a id="id-10-future-revisions-of-this-license"></a>10. FUTURE REVISIONS OF THIS LICENSE</h4><p>The Free Software Foundation may publish new, revised versions of the GNU Free Documentation License from time to time.
Such new versions will be similar in spirit to the present version, but may differ in detail to address new problems or concerns.
See <a class="link" href="http://www.gnu.org/copyleft/" target="_top">http://www.gnu.org/copyleft/</a>.</p><p>Each version of the License is given a distinguishing version number.
If the Document specifies that a particular numbered version of this License "or any later version" applies to it, you have the option of following the terms and conditions either of that specified version or of any later version that has been published (not as a draft) by the Free Software Foundation.
If the Document does not specify a version number of this License, you may choose any version ever published (not as a draft) by the Free Software Foundation.</p><h4><a id="id-addendum-how-to-use-this-license-for-your-documents"></a>ADDENDUM: How to use this License for your documents</h4><pre class="screen">Copyright (c) YEAR YOUR NAME.
   Permission is granted to copy, distribute and/or modify this document
   under the terms of the GNU Free Documentation License, Version 1.2
   or any later version published by the Free Software Foundation;
   with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
   A copy of the license is included in the section entitled “GNU
   Free Documentation License”.</pre><p>If you have Invariant Sections, Front-Cover Texts and Back-Cover Texts, replace the “
with…​Texts.”
line with this:</p><pre class="screen">with the Invariant Sections being LIST THEIR TITLES, with the
   Front-Cover Texts being LIST, and with the Back-Cover Texts being LIST.</pre><p>If you have Invariant Sections without Cover Texts, or some other combination of the three, merge those two alternatives to suit the situation.</p><p>If your document contains nontrivial examples of program code, we recommend releasing these examples in parallel under your choice of free software license, such as the GNU General Public License, to permit their use in free software.</p></div></div></div></body></html>